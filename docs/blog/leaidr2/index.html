<!DOCTYPE html>
<html lang="en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="generator" content="Hugo 0.82.0" />
	
	<link rel="icon" href="/images/logo.png">
	
	<title>Even Easier-to-Use R Package for School District Shapefiles | %&gt;% dreams</title>
	
	

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Even Easier-to-Use R Package for School District Shapefiles"/>
<meta name="twitter:description" content="
















An update to {leaidr}, an R package for U.S. school district shapefiles.
"/>

	<meta property="og:title" content="Even Easier-to-Use R Package for School District Shapefiles" />
<meta property="og:description" content="
















An update to {leaidr}, an R package for U.S. school district shapefiles.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ivelasq.rbind.io/blog/leaidr2/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-08-30T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-08-30T00:00:00&#43;00:00" />



	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
	 crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
	<link href="/css/medium.css" rel="stylesheet">
	<link href="/css/additional.css" rel="stylesheet">

	
	
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container pr-0">
        
        <a class="navbar-brand" href="https://ivelasq.rbind.io//">

            
            <img src="/images/logo.png" alt="logo">
            
        </a>
        

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/">About Me</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/blog">Blog</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/static/portfolio">Portfolio</a>
                </li>
                
            </ul>
        </div>
        
    </div>
</nav>


        <div class="site-content">   
            <div class="container">
<div class="mainheading">
    <h1 class="sitetitle">%&gt;% dreams</h1>
    <p class="lead">
         Isabella Velásquez
    </p>
</div><div class="main-content">
        
        <div class="container">
            <div class="row">
                
                <div class="col-md-2 pl-0"><div class="share sticky-top sticky-top-offset">
    <p>Share</p>
    <ul>
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://twitter.com/intent/tweet?text=Even%20Easier-to-Use%20R%20Package%20for%20School%20District%20Shapefiles&url=https%3a%2f%2fivelasq.rbind.io%2fblog%2fleaidr2%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=435');return false;">
        <i class="fab fa-twitter"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://facebook.com/sharer.php?u=https%3a%2f%2fivelasq.rbind.io%2fblog%2fleaidr2%2f" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
        <i class="fab fa-facebook-f"></i>
        </a>
        </li>

        <li class="ml-1 mr-1">
        <a target="_blank" href="https://www.xing.com/spi/shares/new?url=https%3a%2f%2fivelasq.rbind.io%2fblog%2fleaidr2%2f" onclick="window.open(this.href, 'xing-share', 'width=550,height=435');return false;">
        <i class="fab fa-xing"></i>
        </a>
        </li>        
    </ul>

    
</div>
</div>
                                
                <div class="col-md-9 flex-first flex-md-unordered">
                    <div class="mainheading">
                        	
                        
                        
                        
                        <div class="row post-top-meta">
                            <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right">
                                <img class="author-thumb" src="/images/thumbnail.png" alt="Isabella Velásquez">
                            </div>
                            <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left">
                                <a target="_blank" class="link-dark">Isabella Velásquez</a><br>
                                <span class="author-description">
                                    Author<br>
                                    <i class="far fa-star"></i>
                                    Aug 30, 2020
                                    <i class="far fa-clock clock"></i>
                                    5 min read
                                </span>					
                            </div>
                        </div>			
                        	
                        
                                                
                        
                        <h1 class="posttitle">Even Easier-to-Use R Package for School District Shapefiles</h1> 
                    </div>

                    
                    
                    
                    

                    
                    <div class="article-post">
                        <div id="leaidr-update" class="section level2">
<h2>leaidr Update</h2>
<p>A few months ago, I created <a href="https://github.com/ivelasq/leaidr">{leaidr}</a> for easier download of U.S. school district shapefiles. <a href="https://github.com/datalorax">Daniel Anderson</a> went through and greatly improved the package, making it even easier to download and use the shapefiles (thanks Dan!).</p>
<p>Now, instead of having to run <code>lea_prep()</code>, you can download the shapefiles from Dan’s Github repository like so:</p>
<pre class="r"><code>library(leaidr)

tn &lt;- lea_get(&quot;tn&quot;)</code></pre>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: &quot;/private/var/folders/pj/nmg9b8_93dq4kwt8nt2d4cj40000gn/T/Rtmp4UN0aO/47&quot;, layer: &quot;47&quot;
## with 158 features
## It has 18 fields</code></pre>
<pre class="r"><code>tn %&gt;% 
  sf::st_as_sf() %&gt;% 
  ggplot2::ggplot() +
  ggplot2::geom_sf()</code></pre>
<p><img src="/blog/leaidr2_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>And, if you use <code>lea_get()</code> (i.e., with <code>state = NULL</code>), you’ll get the shapefiles for the whole U.S. back via ROpenSci’s {piggyback}.</p>
<p>So much easier and better!</p>
<p>Because Dan helped make the package so great, I wanted to add on and showcase what can be done with it! So, today’s post is jam-packed with choices…</p>
<ul>
<li><a href="#create-a-beautiful-map-in-mapbox">Create a Beautiful Map in Mapbox</a></li>
<li><a href="#create-a-shiny-app-with-your-beautiful-map">Create a Shiny App with Your Beautiful Maps</a></li>
<li><a href="#add-a-shiny-app-to-the-package">Add A Shiny App to the Package</a></li>
</ul>
</div>
<div id="create-a-beautiful-map-in-mapbox" class="section level2">
<h2>Create a Beautiful Map in Mapbox</h2>
<p>Asmae Toumi wrote a <a href="https://asmae-toumi.netlify.app/posts/2020-08-10-how-to-make-web-ready-us-county-level-maps/">blog post</a> on how to make maps using R and Mapbox. So, I figured: why not announce the new and improved {leaidr} functions to create a beautiful Mapbox map??</p>
<p>This walkthrough will go a little deeper with Mapbox, as I am an extreme beginner and had to do a lot of investigating to figure out how to use it.</p>
<p>I suggest first reading through Asmae’s tutorial as there are a few things you need to do before being able to run the below: download the {mapboxapi} package, create a Mapbox account, and install Tippecanoe.</p>
<div id="load-the-libraries" class="section level3">
<h3>Load the Libraries</h3>
<p>Here are the libraries you will need:</p>
<pre class="r"><code>library(tidyverse)

# remotes::install_github(&quot;walkerke/mapboxapi&quot;)
library(mapboxapi)

# if you haven&#39;t installed the package yet
# devtools::install_github(&quot;ivelasq/leaidr&quot;)
library(leaidr)

library(rmapshaper)
library(mapdeck)</code></pre>
</div>
<div id="download-the-data" class="section level3">
<h3>Download the Data</h3>
<p>Download your shapefiles. If you want to make a choropleth map, also read in the data that you will append to your shapefiles and merge them together by a common ID. (Sorry for using a local file!)</p>
<pre class="r"><code>shp &lt;- # leaidr shapefiles
  lea_get(c(&quot;or&quot;, &quot;wa&quot;)) %&gt;% 
  sf::st_as_sf()

dat &lt;- # data to append 
  read_csv(&quot;/Users/shortessay/Downloads/ccd_lea_141_1819_l_1a_091019/ccd_lea_141_1819_l_1a_091019.csv&quot;) %&gt;%
  filter(ST %in% c(&quot;OR&quot;, &quot;WA&quot;))

northwest &lt;-
  shp %&gt;%
  select(GEOID, geometry) %&gt;%
  sp::merge(dat, by.x = &quot;GEOID&quot;, by.y = &quot;LEAID&quot;)</code></pre>
</div>
<div id="create-the-tileset" class="section level3">
<h3>Create the Tileset</h3>
<p>Now, following the original tutorial, we use Tippecanoe to optimize the shapefiles and data and then upload the “tiles” to Mapbox.</p>
<pre class="r"><code>tippecanoe(
  input = northwest,
  output = &quot;nw.mbtiles&quot;,
  layer_name = &quot;northwest&quot;)

upload_tiles(input = &quot;nw.mbtiles&quot;,
             username = &quot;ivelasq3&quot;, 
             tileset_id = &quot;northwest&quot;,
             multipart = TRUE)</code></pre>
</div>
<div id="style-the-tiles" class="section level3">
<h3>Style the Tiles</h3>
<p>This is the part that I had to figure out on the Mapbox website. <a href="https://docs.mapbox.com/help/tutorials/choropleth-studio-gl-pt-1/">This</a> walkthrough was helpful. Once you have uploaded the tiles using <code>upload_tiles()</code>, you should see them available under “Custom tileset” at the bottom of this webpage: <a href="https://studio.mapbox.com/tilesets/" class="uri">https://studio.mapbox.com/tilesets/</a>.</p>
<p><img src="https://ivelasq.rbind.io/images/mapbox_files/1.png" /></p>
<p>Then, go to Styles on this webpage: <a href="https://studio.mapbox.com/" class="uri">https://studio.mapbox.com/</a>. Click “New Style” and choose the template you want, then Customize.</p>
<p><img src="https://ivelasq.rbind.io/images/mapbox_files/2.png" /></p>
<p>To add your tileset, go to Layers, click the Plus sign, then under “Source”, find your uploaded tileset or add the tileset by the ID given by <code>upload_tiles()</code>.</p>
<p><img src="https://ivelasq.rbind.io/images/mapbox_files/3.png" /></p>
<p>I zoomed to where my tiles are located (Oregon and Washington) and started editing. <a href="https://docs.mapbox.com/help/tutorials/choropleth-studio-gl-pt-1/#data-driven-styling">This section of the walkthrough</a> explains how to create a choropleth map, where each geography has a different color according to a value.</p>
<p>Once done styling, I clicked “Publish” on the top right of Mapbox Studio.</p>
</div>
<div id="using-map-in-r" class="section level3">
<h3>Using Map in R</h3>
<p>To get the information to bring it back into R and be able to use the map in a Shiny app, I clicked “Share” and scrolled to find the Style ID.</p>
<p><img src="https://ivelasq.rbind.io/images/mapbox_files/4.png" /></p>
<p>I copied the Share URL to include in the function below. For the location parameter, I used the latitude/longitude listed in the browser URL. I played around with the zoom level until I found one I liked.</p>
<pre class="r"><code>mapdeck(token = Sys.getenv(&quot;MAPBOX_PUBLIC_TOKEN&quot;),
        style = &quot;mapbox://styles/ivelasq3/ckehhzzld3l3p19mht1n8hksj&quot;,
        zoom = 4,
        location = c(-120.161, 45.843))</code></pre>
<div id="htmlwidget-1" style="width:672px;height:480px;" class="mapdeck html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"access_token":"","style":"mapbox://styles/ivelasq3/ckehhzzld3l3p19mht1n8hksj","pitch":0,"zoom":4,"location":[-120.161,45.843],"bearing":0,"max_zoom":20,"min_zoom":0,"max_pitch":60,"min_pitch":0,"show_view_state":false,"repeat_view":false},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="create-a-shiny-app-with-your-beautiful-map" class="section level2">
<h2>Create a Shiny App with Your Beautiful Map</h2>
<p>Once you have the <code>mapdeck()</code> function all set up, you can use it in a Shiny app. <a href="https://github.com/greghuang8/Geovis/blob/master/shinyApp.R">Here’s</a> some reference code that I found useful for using <code>renderMapdeck()</code>. Thank you Greg Huang!</p>
<p>This is an example of a very bare bones Shiny app. For the UI, use <code>mapdeckOutput()</code>:</p>
<pre class="r"><code>library(tidyverse)
library(shiny)
library(mapdeck)

ui &lt;- fluidPage(
  mapdeckOutput(outputId = &quot;createMap&quot;)
)</code></pre>
<p>And for the server, paste the <code>mapdeck()</code> function in <code>renderMapdeck()</code>:</p>
<pre class="r"><code>server &lt;- function(input, output) {

  output$createMap &lt;- renderMapdeck({
    mapdeck(token = Sys.getenv(&quot;MAPBOX_PUBLIC_TOKEN&quot;),
            style = &quot;mapbox://styles/ivelasq3/ckehhzzld3l3p19mht1n8hksj&quot;,
            zoom = 4,
            location = c(-120.161, 45.843))
  })
}</code></pre>
<p>I uploaded the bare bones app <a href="https://ivelasq.shinyapps.io/leaidr/">here</a>.</p>
</div>
<div id="add-a-shiny-app-to-the-package" class="section level2">
<h2>Add A Shiny App to the Package</h2>
<p>Now, say you would like to add the Shiny app to your package as well as upload to shinyapps.io / instead of uploading to shinyapps.io. Thankfully, Dean Attali has a <a href="https://deanattali.com/2015/04/21/r-package-shiny-app/">great walkthrough</a> on how to do this!</p>
<ol style="list-style-type: decimal">
<li>Add {shiny} to your dependencies in your <code>DESCRIPTION</code> file (I do this with <code>usethis::use_package("shiny")</code>).</li>
<li>Create a folder called <code>inst</code> in your package with another folder for the Shiny example, and your UI/server file(s) within.</li>
<li>Create an R file to run your example (I used <code>usethis::use_r("runExample.R")</code>) to create this file.</li>
<li>Don’t forget to document! <code>devtools::document()</code></li>
</ol>
<p>So, if you were to install and load {leaidr}, you can run <code>leaidr::runExample()</code> to launch the Shiny app. To see what the files look like, check out the Github repo files <a href="https://github.com/ivelasq/leaidr/tree/master/inst/shiny-examples/mapbox">here</a>.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>In conclusion, {leaidr} can help you map your data as long as you have school district LEAID’s or names in there somewhere. I hope that it helps you in your education data projects!</p>
</div>

                    </div>
                    
                    
                    <div class="after-post-tags">
                        <ul class="tags">
                        
                        <li>
                        <a href="/tags/package-development">package-development</a>
                        </li>
                        
                        <li>
                        <a href="/tags/spatial">spatial</a>
                        </li>
                        
                        <li>
                        <a href="/tags/maps">maps</a>
                        </li>
                        
                        <li>
                        <a href="/tags/mapbox">mapbox</a>
                        </li>
                        
                        <li>
                        <a href="/tags/shiny">shiny</a>
                        </li>
                        
                        <li>
                        <a href="/tags/dataedu">dataedu</a>
                        </li>
                        
                        </ul>
                    </div>
                    
                    
                    
                    <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
                    
                        <a class="d-block col-md-6" href="https://ivelasq.rbind.io/blog/get-tweet-likes/"> &laquo; Browse and Search Liked Tweets Using R</a>
                    
                    
                        <a class="d-block col-md-6 text-lg-right" href="https://ivelasq.rbind.io/blog/tidying-census-data/">What It Takes to Tidy Census Data &raquo;</a>
                    
                    <div class="clearfix"></div>
                    </div>
                    
                </div>
                
            </div>
        </div>
        
        
    </div>


            </div>
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
			<div class="d-md-flex align-items-center justify-content-center h-100">
				<h2 class="d-md-block d-none align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
			</div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
			
			<a class="mt-1 mb-1" href="/tags/bookdown">bookdown</a>
			
			<a class="mt-1 mb-1" href="/tags/cran">cran</a>
			
			<a class="mt-1 mb-1" href="/tags/dataedu">dataedu</a>
			
			<a class="mt-1 mb-1" href="/tags/ggplot2">ggplot2</a>
			
			<a class="mt-1 mb-1" href="/tags/graduate-school">graduate-school</a>
			
			<a class="mt-1 mb-1" href="/tags/import-gpx">import-gpx</a>
			
			<a class="mt-1 mb-1" href="/tags/import-pdf">import-pdf</a>
			
			<a class="mt-1 mb-1" href="/tags/import-xls">import-xls</a>
			
			<a class="mt-1 mb-1" href="/tags/mapbox">mapbox</a>
			
			<a class="mt-1 mb-1" href="/tags/maps">maps</a>
			
			<a class="mt-1 mb-1" href="/tags/package-development">package-development</a>
			
			<a class="mt-1 mb-1" href="/tags/pair-programming">pair-programming</a>
			
			<a class="mt-1 mb-1" href="/tags/residuals">residuals</a>
			
			<a class="mt-1 mb-1" href="/tags/scrape">scrape</a>
			
			<a class="mt-1 mb-1" href="/tags/shiny">shiny</a>
			
			<a class="mt-1 mb-1" href="/tags/spatial">spatial</a>
			
			<a class="mt-1 mb-1" href="/tags/summary-statistics">summary-statistics</a>
			
			<a class="mt-1 mb-1" href="/tags/tidy">tidy</a>
			
			<a class="mt-1 mb-1" href="/tags/twitter-data">twitter-data</a>
			
			<a class="mt-1 mb-1" href="/tags/visualization">visualization</a>
			
		</div>
	</div>
</div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Isabella Velásquez - This is my personal website. Nothing here is endorsed by my employer or any organizations of which I am a part. Content on this site is provided under a Creative Commons (CC-BY) 4.0 license. You may re-use this content as long as you indicate my authorship and provide a link back to the original material. Source code of the site is provided under the MIT license and may be reused without restriction. Many thanks to Dr. Noam Ross for the language included here!
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" rel="noopener" href="https://www.wowthemes.net">Mediumish Theme by Wowthemes</a> | <a target="_blank" rel="noopener" href="https://www.tiffanymcknight.com/">Website Artwork by Tiffany McKnight</a>
            </div>
        </div>
    </div>
</footer>


        </div>


<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script src="/js/mediumish.js"></script>

    </body>
</html>
