<!DOCTYPE html>
<html lang="en-us"><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="generator" content="Hugo 0.82.0" />
	
	<link rel="icon" href="/images/logo.png">
	
	<title>Transforming PDF&#39;s into Useful Tables | %&gt;% dreams</title>
	
	

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Transforming PDF&#39;s into Useful Tables"/>
<meta name="twitter:description" content="



Blog post on importing, tidying, and visualizing SNAP expenditure data.
"/>

	<meta property="og:title" content="Transforming PDF&#39;s into Useful Tables" />
<meta property="og:description" content="



Blog post on importing, tidying, and visualizing SNAP expenditure data.
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ivelasq.rbind.io/blog/snap-expenditures/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2018-12-16T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2018-12-16T00:00:00&#43;00:00" />



	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
	 crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet">
	<link href="/css/medium.css" rel="stylesheet">
	<link href="/css/additional.css" rel="stylesheet">

	
	
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
    <div class="container pr-0">
        
        <a class="navbar-brand" href="https://ivelasq.rbind.io//">

            
            <img src="/images/logo.png" alt="logo">
            
        </a>
        

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        
        <div class="collapse navbar-collapse" id="navbarMediumish">
            
            <ul class="navbar-nav ml-auto">
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/">About Me</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/blog">Blog</a>
                </li>
                 
                <li class="nav-item ">
                    <a class="nav-link" href="/static/portfolio">Portfolio</a>
                </li>
                
            </ul>
        </div>
        
    </div>
</nav>


        <div class="site-content">   
            <div class="container">
<div class="mainheading">
    <h1 class="sitetitle">%&gt;% dreams</h1>
    <p class="lead">
         Isabella Velásquez
    </p>
</div><div class="main-content">
        
        <div class="container">
            <div class="row">
                
                <div class="col-md-2 pl-0"><div class="share sticky-top sticky-top-offset">
    <p>Share</p>
    <ul>
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://twitter.com/intent/tweet?text=Transforming%20PDF%27s%20into%20Useful%20Tables&url=https%3a%2f%2fivelasq.rbind.io%2fblog%2fsnap-expenditures%2f" onclick="window.open(this.href, 'twitter-share', 'width=550,height=435');return false;">
        <i class="fab fa-twitter"></i>
        </a>
        </li>
        
        <li class="ml-1 mr-1">
        <a target="_blank" href="https://facebook.com/sharer.php?u=https%3a%2f%2fivelasq.rbind.io%2fblog%2fsnap-expenditures%2f" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
        <i class="fab fa-facebook-f"></i>
        </a>
        </li>

        <li class="ml-1 mr-1">
        <a target="_blank" href="https://www.xing.com/spi/shares/new?url=https%3a%2f%2fivelasq.rbind.io%2fblog%2fsnap-expenditures%2f" onclick="window.open(this.href, 'xing-share', 'width=550,height=435');return false;">
        <i class="fab fa-xing"></i>
        </a>
        </li>        
    </ul>

    
</div>
</div>
                                
                <div class="col-md-9 flex-first flex-md-unordered">
                    <div class="mainheading">
                        	
                        
                        
                        
                        <div class="row post-top-meta">
                            <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0 md-nopad-right">
                                <img class="author-thumb" src="/images/thumbnail.png" alt="Isabella Velásquez">
                            </div>
                            <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left md-nopad-left">
                                <a target="_blank" class="link-dark">Isabella Velásquez</a><br>
                                <span class="author-description">
                                    Author<br>
                                    <i class="far fa-star"></i>
                                    Dec 16, 2018
                                    <i class="far fa-clock clock"></i>
                                    7 min read
                                </span>					
                            </div>
                        </div>			
                        	
                        
                                                
                        
                        <h1 class="posttitle">Transforming PDF&#39;s into Useful Tables</h1> 
                    </div>

                    
                    
                    
                    

                    
                    <div class="article-post">
                        <p>Way back in 2016, the USDA released a <a href="https://www.fns.usda.gov/snap/foods-typically-purchased-supplemental-nutrition-assistance-program-snap-households">study</a> entitled “Foods Typically Purchased by Supplemental Nutrition Assistance Program (SNAP) Households,” including a summary, final report, and appendices. Per the USDA’s description:</p>
<blockquote>
<p>This study uses calendar year 2011 point-of-sale transaction data from a leading grocery retailer to examine the food choices of SNAP and non-SNAP households.</p>
</blockquote>
<p>At the time though, I was most interested in looking at the <a href="https://fns-prod.azureedge.net/sites/default/files/ops/SNAPFoodsTypicallyPurchased-Appendices.pdf">appendices data</a> - <em>263</em> pages full of tables detailing the commodities and categories of food bought by both families served and not served by SNAP. Unfortunately, these wonderful data are in PDF format, with ‘fancy’ Excel formatting (merged cells, unnecessary column names), where the formatting varies depending on which appendix you are looking at.</p>
<p>I <a href="mailto:SNAPHQ-WEB@fns.usda.gov">emailed</a> SNAP HQ to ask if they had the raw data available in CSV’s and was told simply:</p>
<blockquote>
<p>Thank you for your inquiry. Unfortunately we do not have the data tables in a CSV file.</p>
</blockquote>
<p>At the time, my R skills were pretty rudimentary and I couldn’t figure out how to easily and efficiently pull the data into usable tables. Two years later and with a little more experience with R and scraping and cleaning ugly files, I decided to try again using the wonderful {tidyverse} and {tabulizer} packages.</p>
<pre class="r"><code>library(tidyverse)
library(tabulizer)
library(broom)</code></pre>
<p>Use <code>tabulizer::extract_tables()</code> to extract the data from the <a href="https://fns-prod.azureedge.net/sites/default/files/ops/SNAPFoodsTypicallyPurchased-Appendices.pdf">appendices PDF</a>. Once you extract the tables, you are left with a list (which is slightly more manageable than the original PDFs).</p>
<pre class="r"><code>snap_pdf &lt;-
  extract_tables(&quot;https://fns-prod.azureedge.net/sites/default/files/ops/SNAPFoodsTypicallyPurchased-Appendices.pdf&quot;)</code></pre>
<p>Using the {purrr} package, create a data frame from the lists while simultaneously removing the unnecessary rows.</p>
<pre class="r"><code>snap_df &lt;- 
  snap_pdf %&gt;%
  map(as_tibble) %&gt;%
  map_df(~ slice(., -2)) # slicing because of the unnecessary rows
  
head(snap_df)</code></pre>
<pre><code>## # A tibble: 6 x 9
##   V1          V2    V3                       V4    V5    V6    V7    V8    V9   
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;                    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 &quot;&quot;          &quot;&quot;    SNAP Household Expendit… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 2 &quot;Soft drin… &quot;&quot;    1 $357.7 5.44% 2 $1,263… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 3 &quot;Fluid mil… &quot;&quot;    2 $253.7 3.85% 1 $1,270… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 4 &quot;Beef:grin… &quot;&quot;    3 $201.0 3.05% 6 $621.1… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 5 &quot;Bag snack… &quot;&quot;    4 $199.3 3.03% 5 $793.9… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
## 6 &quot;Cheese&quot;    &quot;&quot;    5 $186.4 2.83% 3 $948.9… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;</code></pre>
<p>Due to the original formatting of the PDFs, there’s a bunch of cleaning to be done to make the list into a usable table. Using <code>slice()</code>, I choose only the rows from Appendix 1. I manually put in the number of entries (238) because I didn’t know how to calculate this using code. If you have ideas, let me know!</p>
<pre class="r"><code>snap_appendix1 &lt;-
  snap_df %&gt;% 
  slice(1:238) # Appendix A has 238 rows</code></pre>
<p>Now comes the fun part (yay data cleaning!). When looking at the data frame, the data for each commodity are all mushed together in two separate columns (V2 and V3), but only one column or the other. Then there are a bunch of empty columns (V4 through V9), probably created from the funky original formatting. The data all begin with numbers as well. First things first - put all the data in a single column. Then, remove all the empty rows in the newly created <code>col_dat</code> column.</p>
<pre class="r"><code>snap_appendix1_cleaned &lt;-
  snap_appendix1 %&gt;%
  mutate(col_dat = case_when(grepl(&quot;[0-9]&quot;, V2) ~ V2, # create a column that contains all the data
                           grepl(&quot;[0-9]&quot;, V3) ~ V3,
                           TRUE ~ &quot;&quot;)) %&gt;% 
  filter(col_dat != &quot;&quot;) # some rows are empty

head(snap_appendix1_cleaned)</code></pre>
<pre><code>## # A tibble: 6 x 10
##   V1        V2    V3           V4    V5    V6    V7    V8    V9    col_dat      
##   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;        
## 1 Soft dri… &quot;&quot;    1 $357.7 5.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  1 $357.7 5.4…
## 2 Fluid mi… &quot;&quot;    2 $253.7 3.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  2 $253.7 3.8…
## 3 Beef:gri… &quot;&quot;    3 $201.0 3.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  3 $201.0 3.0…
## 4 Bag snac… &quot;&quot;    4 $199.3 3.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  4 $199.3 3.0…
## 5 Cheese    &quot;&quot;    5 $186.4 2.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  5 $186.4 2.8…
## 6 Baked br… &quot;&quot;    6 $163.7 2.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  6 $163.7 2.4…</code></pre>
<p>Now the numeric data we want is wonderfully in a single column, so we can select the columns <code>V1</code> and <code>col_dat</code>.</p>
<pre class="r"><code>snap_appendix1_cleaned &lt;-
  snap_appendix1_cleaned %&gt;% 
  select(V1, col_dat)

head(snap_appendix1_cleaned)</code></pre>
<pre><code>## # A tibble: 6 x 2
##   V1                  col_dat                        
##   &lt;chr&gt;               &lt;chr&gt;                          
## 1 Soft drinks         1 $357.7 5.44% 2 $1,263.3 4.01%
## 2 Fluid milk products 2 $253.7 3.85% 1 $1,270.3 4.03%
## 3 Beef:grinds         3 $201.0 3.05% 6 $621.1 1.97%  
## 4 Bag snacks          4 $199.3 3.03% 5 $793.9 2.52%  
## 5 Cheese              5 $186.4 2.83% 3 $948.9 3.01%  
## 6 Baked breads        6 $163.7 2.49% 4 $874.8 2.78%</code></pre>
<p>All the numeric data is still mushed in column <code>col_dat</code>, so using <code>tidyr::separate()</code> we can split the values because they are all separated by spaces. Referencing the original PDF, we descriptively rename the columns (and rename the commodity column <code>V1</code> as well). The numeric values have retained their original formatting, with dollar signs and commas and percentage signs, oh my! We can sub out those unnecessary characters and transform those columns into truly numeric values.</p>
<pre class="r"><code>snap_appendix1_cleaned &lt;-
  snap_appendix1_cleaned %&gt;%
  separate(col_dat, &quot; &quot;,
           into = c(&quot;snap_rank&quot;, &quot;snap_dollars_in_millions&quot;, &quot;snap_pct_total_expenditures&quot;, &quot;nonsnap_rank&quot;, &quot;nonsnap_dollars_in_millions&quot;, &quot;nonsnap_pct_total_expenditures&quot;)) %&gt;%
  rename(commodity = V1) %&gt;%
  mutate_at(vars(snap_rank:nonsnap_pct_total_expenditures), list(~ as.numeric(gsub(&quot;,|%|\\$&quot;, &quot;&quot;, .))))

head(snap_appendix1_cleaned)</code></pre>
<pre><code>## # A tibble: 6 x 7
##   commodity      snap_rank snap_dollars_in_mi… snap_pct_total_expe… nonsnap_rank
##   &lt;chr&gt;              &lt;dbl&gt;               &lt;dbl&gt;                &lt;dbl&gt;        &lt;dbl&gt;
## 1 Soft drinks            1                358.                 5.44            2
## 2 Fluid milk pr…         2                254.                 3.85            1
## 3 Beef:grinds            3                201                  3.05            6
## 4 Bag snacks             4                199.                 3.03            5
## 5 Cheese                 5                186.                 2.83            3
## 6 Baked breads           6                164.                 2.49            4
## # … with 2 more variables: nonsnap_dollars_in_millions &lt;dbl&gt;,
## #   nonsnap_pct_total_expenditures &lt;dbl&gt;</code></pre>
<p>Last but not least, we convert all the columns with percentages into actual percentages by dividing by 100.</p>
<pre class="r"><code>snap_appendix1_cleaned &lt;-
  snap_appendix1_cleaned %&gt;%
  mutate_at(vars(contains(&quot;pct&quot;)), list(~ ./100))

head(snap_appendix1_cleaned)</code></pre>
<pre><code>## # A tibble: 6 x 7
##   commodity      snap_rank snap_dollars_in_mi… snap_pct_total_expe… nonsnap_rank
##   &lt;chr&gt;              &lt;dbl&gt;               &lt;dbl&gt;                &lt;dbl&gt;        &lt;dbl&gt;
## 1 Soft drinks            1                358.               0.0544            2
## 2 Fluid milk pr…         2                254.               0.0385            1
## 3 Beef:grinds            3                201                0.0305            6
## 4 Bag snacks             4                199.               0.0303            5
## 5 Cheese                 5                186.               0.0283            3
## 6 Baked breads           6                164.               0.0249            4
## # … with 2 more variables: nonsnap_dollars_in_millions &lt;dbl&gt;,
## #   nonsnap_pct_total_expenditures &lt;dbl&gt;</code></pre>
<p>Tada! Now we have a clean dataset from the original not-very-usable PDFs.</p>
<p>Another goal is to at some point do a full analysis of what these data show. My hope is that now some of it is available, others can create and share amazing analysis with it. For the purposes of this blogpost, here are some quick ggplots comparing the rank of commodities between families served by SNAP and those who are not.</p>
<pre class="r"><code>snap_appendix1_cleaned %&gt;% # quick correlation plot
  ggplot(aes(x = snap_rank, y = nonsnap_rank)) +
  geom_point(color = &quot;#00C3DA&quot;) +
  theme_iv() # custom theme</code></pre>
<p><img src="/blog/snap-expenditures_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;" /></p>
<pre class="r"><code>snap_lm &lt;- lm(snap_rank ~ nonsnap_rank, data = snap_appendix1_cleaned)
snap_res &lt;- augment(snap_lm)

snap_res %&gt;% # quick residual plot
  ggplot(aes(x = .fitted, y = .resid)) +
  geom_point(color = &quot;#00C3DA&quot;) +
  theme_iv() # custom theme</code></pre>
<p><img src="/blog/snap-expenditures_files/figure-html/unnamed-chunk-11-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>I’d love to collaborate with others to finish up this project and find more efficient ways of cleaning these data. The repo with the code and final dataset is <a href="https://github.com/ivelasq/snap">here</a>. More to come!</p>
<p><em>Liked this article? I’d love for you to retweet!</em></p>
<center>
{{% tweet "1074704678858973184" %}}
</center>

                    </div>
                    
                    
                    <div class="after-post-tags">
                        <ul class="tags">
                        
                        <li>
                        <a href="/tags/import-pdf">import-pdf</a>
                        </li>
                        
                        <li>
                        <a href="/tags/tidy">tidy</a>
                        </li>
                        
                        <li>
                        <a href="/tags/visualization">visualization</a>
                        </li>
                        
                        <li>
                        <a href="/tags/residuals">residuals</a>
                        </li>
                        
                        </ul>
                    </div>
                    
                    
                    
                    <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
                    
                        <a class="d-block col-md-6" href="https://ivelasq.rbind.io/blog/average-hike/"> &laquo; Taking A Peek into My Hiking Data</a>
                    
                    
                        <a class="d-block col-md-6 text-lg-right" href="https://ivelasq.rbind.io/blog/why-disaggregate-data/">Disaggregating Minneapolis Public Schools Data &raquo;</a>
                    
                    <div class="clearfix"></div>
                    </div>
                    
                </div>
                
            </div>
        </div>
        
        
    </div>


            </div>
<div class="jumbotron fortags">
	<div class="d-md-flex h-100">
		<div class="col-md-4 transpdark align-self-center text-center h-100">
			<div class="d-md-flex align-items-center justify-content-center h-100">
				<h2 class="d-md-block d-none align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2>
			</div>
		</div>
		<div class="col-md-8 p-5 align-self-center text-center">
			
			<a class="mt-1 mb-1" href="/tags/bookdown">bookdown</a>
			
			<a class="mt-1 mb-1" href="/tags/cran">cran</a>
			
			<a class="mt-1 mb-1" href="/tags/dataedu">dataedu</a>
			
			<a class="mt-1 mb-1" href="/tags/ggplot2">ggplot2</a>
			
			<a class="mt-1 mb-1" href="/tags/graduate-school">graduate-school</a>
			
			<a class="mt-1 mb-1" href="/tags/import-gpx">import-gpx</a>
			
			<a class="mt-1 mb-1" href="/tags/import-pdf">import-pdf</a>
			
			<a class="mt-1 mb-1" href="/tags/import-xls">import-xls</a>
			
			<a class="mt-1 mb-1" href="/tags/mapbox">mapbox</a>
			
			<a class="mt-1 mb-1" href="/tags/maps">maps</a>
			
			<a class="mt-1 mb-1" href="/tags/package-development">package-development</a>
			
			<a class="mt-1 mb-1" href="/tags/pair-programming">pair-programming</a>
			
			<a class="mt-1 mb-1" href="/tags/residuals">residuals</a>
			
			<a class="mt-1 mb-1" href="/tags/scrape">scrape</a>
			
			<a class="mt-1 mb-1" href="/tags/shiny">shiny</a>
			
			<a class="mt-1 mb-1" href="/tags/spatial">spatial</a>
			
			<a class="mt-1 mb-1" href="/tags/summary-statistics">summary-statistics</a>
			
			<a class="mt-1 mb-1" href="/tags/tidy">tidy</a>
			
			<a class="mt-1 mb-1" href="/tags/twitter-data">twitter-data</a>
			
			<a class="mt-1 mb-1" href="/tags/visualization">visualization</a>
			
		</div>
	</div>
</div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-6 text-center text-lg-left">
                &copy; Copyright Isabella Velásquez - This is my personal website. Nothing here is endorsed by my employer or any organizations of which I am a part. Content on this site is provided under a Creative Commons (CC-BY) 4.0 license. You may re-use this content as long as you indicate my authorship and provide a link back to the original material. Source code of the site is provided under the MIT license and may be reused without restriction. Many thanks to Dr. Noam Ross for the language included here!
            </div>
            <div class="col-md-6 col-sm-6 text-center text-lg-right">    
                <a target="_blank" rel="noopener" href="https://www.wowthemes.net">Mediumish Theme by Wowthemes</a> | <a target="_blank" rel="noopener" href="https://www.tiffanymcknight.com/">Website Artwork by Tiffany McKnight</a>
            </div>
        </div>
    </div>
</footer>


        </div>


<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script src="/js/mediumish.js"></script>

    </body>
</html>
