<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>%>% dreams</title>
<link>https://ivelasq.rbind.io/index.html</link>
<atom:link href="https://ivelasq.rbind.io/index.xml" rel="self" type="application/rss+xml"/>
<description>Isabella Velásquez Personal Website</description>
<generator>quarto-99.9.9</generator>
<lastBuildDate>Tue, 18 Jan 2022 06:00:00 GMT</lastBuildDate>
<item>
  <title>Understanding the native R pipe |></title>
  <link>https://ivelasq.rbind.io/blog/understanding-the-r-pipe/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/understanding-the-r-pipe/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Blue and yellow dots making up the night sky"></p>
<p></p><p></p>
</figure>
</div>
<p>A while back, I wrote <a href="https://mobile.twitter.com/ivelasq3/status/1404947187155574787">this tweet</a> showing many (not all!) of the ways one might search for a particular set of columns in a data frame using R. Several of these approaches used the {magrittr} pipe (<code>%&gt;%</code>) and the native R pipe (<code>|&gt;</code>), the latter of which has been available since R version 4.1.0. The {magrittr} and native R pipes work in different ways and one’s mental model of each requires some maintenance. This is the story of how I learned to understand the native R pipe.</p>
<section id="how-laziness-sparked-this-post" class="level2">
<h2 class="anchored" data-anchor-id="how-laziness-sparked-this-post">How laziness sparked this post</h2>
<p>When I am feeling lazy, I use base R for quick plots:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">plot</span>(mtcars<span class="sc" style="color: #5E5E5E;">$</span>hp, mtcars<span class="sc" style="color: #5E5E5E;">$</span>mpg)</span></code></pre></div>
<p>Because that clearly saves a lot of time compared to the {ggplot2} alternative 😄:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;">library</span>(ggplot2)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;">library</span>(magrittr)</span>
<span id="cb2-3"></span>
<span id="cb2-4">mtcars <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> hp, <span class="at" style="color: #677623;">y =</span> mpg)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;">geom_point</span>()</span></code></pre></div>
<p>One day, I was feeling <em>extra</em> lazy, so I tried using the new native R pipe <code>|&gt;</code>:</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">mtcars <span class="sc" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;">plot</span>(hp, mpg)</span>
<span id="cb3-2"><span class="co" style="color: #5E5E5E;">#&gt; Error in get(as.character(FUN), mode = "function", envir = envir) :</span></span>
<span id="cb3-3"><span class="co" style="color: #5E5E5E;">#&gt; object 'mpg' of mode 'function' was not found</span></span></code></pre></div>
<p>Oh no! Why an error?</p>
<p>It was a complete misunderstanding of the native R pipe. I thought piping the data with the native R pipe would replace the need for the <code>data$column</code> notation. Turns out, that is not what the native R pipe does at all. So, this attempt to be lazy culminated in an adventu<strong>R</strong>e to figure out why that doesn’t work and what works instead.</p>
</section>
<section id="how-the-magrittr-pipe-works" class="level2">
<h2 class="anchored" data-anchor-id="how-the-magrittr-pipe-works">How the {magrittr} pipe <code>%&gt;%</code> works</h2>
<p>First, let’s examine the pipe that you might be more familiar with (if you use the {tidyverse} dialect): the <code>%&gt;%</code> forward pipe from the {magrittr} package.</p>
<p>Without any dot syntax (<code>.</code>), the {magrittr} pipe <code>%&gt;%</code> is an <a href="https://en.wikipedia.org/wiki/Infix_notation">infix operator</a> that pipes (moves) what is written on the left-hand side (LHS) of the pipe into the first argument of the function on the right-hand side (RHS) of the pipe. Since R is prone to expressions with many nested parentheses, piping allows one to reason about code from left to right (as when writing in English), instead of right to left with many nested parentheses (see example below).</p>
<center>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
Before I learned case_when() 👀 <a href="https://t.co/khJpueqob2">pic.twitter.com/khJpueqob2</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1466915834002128901?ref_src=twsrc%5Etfw">December 3, 2021</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
<p>From the {magrittr} documentation, the pipe’s usage is thus: <code>LHS %&gt;% RHS</code>. It might be easier to think of a ‘pipe’ as one of the famous ‘warp pipes’ from Super Mario Bros.&nbsp;— it warps Mario from the LHS into the first argument of the RHS function!</p>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/understanding-the-r-pipe/mario.gif" class="img-fluid figure-img"></p>
<p></p><p></p>
</figure>
</div>
</center>
<p>So:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">mtcars2 <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb4-2">  mtcars <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-3">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">hi_mpg =</span> dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">if_else</span>(mpg <span class="sc" style="color: #5E5E5E;">&gt;</span> <span class="dv" style="color: #AD0000;">25</span>, <span class="st" style="color: #20794D;">"high"</span>, <span class="st" style="color: #20794D;">"low"</span>))</span></code></pre></div>
<p>Is equivalent to:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">mtcars2 <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb5-2">  dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">mutate</span>(mtcars, <span class="at" style="color: #677623;">hi_mpg =</span> dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">if_else</span>(mpg <span class="sc" style="color: #5E5E5E;">&gt;</span> <span class="dv" style="color: #AD0000;">25</span>, <span class="st" style="color: #20794D;">"high"</span>, <span class="st" style="color: #20794D;">"low"</span>))</span></code></pre></div>
<p>And,</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">mtcars <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">plot</span>(hp, mpg)</span></code></pre></div>
<p>Is equivalent to:</p>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;">plot</span>(mtcars, hp, mpg)</span>
<span id="cb7-2"></span>
<span id="cb7-3"><span class="co" style="color: #5E5E5E;"># or, more explicitly</span></span>
<span id="cb7-4"><span class="fu" style="color: #4758AB;">plot</span>(<span class="at" style="color: #677623;">x =</span> mtcars, <span class="at" style="color: #677623;">y =</span> hp, <span class="at" style="color: #677623;">type =</span> mpg)</span></code></pre></div>
<p>Which does not work and gives us an error message, because the first two arguments of <code>plot()</code> should be objects for the x and y axes (<code>mtcars</code> is an odd x-axis but technically works), and the third argument is for the type of plot (<code>mpg</code> definitely doesn’t work there).</p>
<p>If you want the LHS to be passed somewhere other than the first argument with the {magrittr} pipe, you can use its dot syntax (<code>.</code>): <code>y %&gt;% f(x, .)</code> is equivalent to <code>f(x, y)</code>.</p>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">mtcars <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;">~</span> hp, <span class="at" style="color: #677623;">data =</span> .)</span></code></pre></div>
<p>Is equivalent to:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;">lm</span>(mpg <span class="sc" style="color: #5E5E5E;">~</span> hp, <span class="at" style="color: #677623;">data =</span> mtcars)</span></code></pre></div>
<p>So, how do we get the {magrittr} pipe to work with <code>plot()</code>? We can use the dot syntax as a placeholder for the data frame. However, this also does not work:</p>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">mtcars <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">plot</span>(.<span class="sc" style="color: #5E5E5E;">$</span>hp, .<span class="sc" style="color: #5E5E5E;">$</span>mpg)</span>
<span id="cb10-2"><span class="co" style="color: #5E5E5E;">#&gt; Error in match.fun(panel) :</span></span>
<span id="cb10-3"><span class="co" style="color: #5E5E5E;">#&gt; '.$mpg' is not a function, character or symbol</span></span></code></pre></div>
<p>Why? The error gives a hint that something is wrong with the <code>.$mpg</code> step.<sup>1</sup> By default, the {magrittr} pipe passes the LHS into the first argument of the RHS, so the call giving the error above is equivalent to writing:</p>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;">plot</span>(mtcars, mtcars<span class="sc" style="color: #5E5E5E;">$</span>hp, mtcars<span class="sc" style="color: #5E5E5E;">$</span>mpg)</span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="co" style="color: #5E5E5E;"># or, more explicitly</span></span>
<span id="cb11-4"><span class="fu" style="color: #4758AB;">plot</span>(<span class="at" style="color: #677623;">x =</span> mtcars, <span class="at" style="color: #677623;">y =</span> mtcars<span class="sc" style="color: #5E5E5E;">$</span>hp, <span class="at" style="color: #677623;">type =</span> mtcars<span class="sc" style="color: #5E5E5E;">$</span>mpg)</span></code></pre></div>
<p>Which does not work nor is what we intended (we want to have <code>mtcars$hp</code> on the x-axis, and <code>mtcars$mpg</code> on the y-axis). The way to get the {magrittr} pipe to do what we want with <code>plot()</code> is to use its curly brace <code>{}</code> syntax. By wrapping the RHS in curly braces, we can override the rule where the LHS is passed to the first argument:</p>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">mtcars <span class="sc" style="color: #5E5E5E;">%&gt;%</span> {<span class="fu" style="color: #4758AB;">plot</span>(.<span class="sc" style="color: #5E5E5E;">$</span>hp, .<span class="sc" style="color: #5E5E5E;">$</span>mpg)}</span></code></pre></div>
<p>This works! It’s equivalent to having written:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><span class="fu" style="color: #4758AB;">plot</span>(mtcars<span class="sc" style="color: #5E5E5E;">$</span>hp, mtcars<span class="sc" style="color: #5E5E5E;">$</span>mpg)</span></code></pre></div>
<p>OK! Now, we can apply what we’ve learned to the native R pipe. Right? …Right?</p>
<center>
<img src="https://ivelasq.rbind.io/blog/understanding-the-r-pipe/padme.jpg" class="img-fluid" alt="Meme of Anakin and Padme with Anakin saying he understands the magrittr pipe, Padme asking if that means he understands the native pipe, and Anakin’s smirk implying that nope">
</center>
</section>
<section id="actually-i-think-we-need-a-detour-to-explain-anonymous-lambda-functions-before-we-can-explain-how-works" class="level2">
<h2 class="anchored" data-anchor-id="actually-i-think-we-need-a-detour-to-explain-anonymous-lambda-functions-before-we-can-explain-how-works">ACTUALLY I THINK WE NEED A DETOUR TO EXPLAIN ANONYMOUS (LAMBDA) FUNCTIONS BEFORE WE CAN EXPLAIN HOW <code>|&gt;</code> WORKS</h2>
<p>Why anonymous? Because they are not named functions from a package or written by you and stored in a function object. Anonymous functions are created on-the-fly, applied immediately, and don’t persist after they’ve been used: <code>function(x) {}</code>.</p>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="cf" style="color: #00769E;">function</span>(x) {</span>
<span id="cb14-2">  x[<span class="fu" style="color: #4758AB;">which.max</span>(x<span class="sc" style="color: #5E5E5E;">$</span>mpg), ]</span>
<span id="cb14-3">}</span></code></pre></div>
<p>What does this do? It creates an anonymous function (also known as a lambda function) if it is not saved to an object.</p>
<p>Introduced in R 4.1, the shortcut for anonymous functions <code>\(x) {}</code> is the same as <code>function(x) {}</code>:</p>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="co" style="color: #5E5E5E;"># equivalent to the above</span></span>
<span id="cb15-2">\(x) {</span>
<span id="cb15-3">  x[<span class="fu" style="color: #4758AB;">which.max</span>(x<span class="sc" style="color: #5E5E5E;">$</span>mpg), ]</span>
<span id="cb15-4">}</span></code></pre></div>
<p>What you gain from writing an anonymous function is that you get to direct traffic by explicitly stating the inputs and how they will be used in the function. Going back to our discussion of pipes, you get to direct exactly where the LHS of the pipe goes in the RHS.</p>
</section>
<section id="how-the-native-r-pipe-works" class="level2">
<h2 class="anchored" data-anchor-id="how-the-native-r-pipe-works">How the native R pipe works</h2>
<p>Like the {magrittr} pipe <code>%&gt;%</code>, the native R pipe <code>|&gt;</code> pipes the LHS into the first argument of the function on the RHS: <code>LHS |&gt; RHS</code>.</p>
<p>You can write:</p>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1">mtcars <span class="sc" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;">sqrt</span>() <span class="sc" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;">head</span>()</span></code></pre></div>
<p>Which is equivalent to:</p>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><span class="fu" style="color: #4758AB;">head</span>(<span class="fu" style="color: #4758AB;">sqrt</span>(mtcars))</span></code></pre></div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
An important note
</div>
</div>
<div class="callout-body-container callout-body">
<p>On the RHS of <code>|&gt;</code>, you need to include the function as a function call, which means appending an <code>()</code> at the end of the function name, rather than just its name. For example, the square root function is called by writing <code>sqrt()</code>. If you try to run <code>mtcars |&gt; sqrt</code> without the <code>()</code> at the end, you will get an error: <code>Error: The pipe operator requires a function call as RHS</code>.</p>
</div>
</div>
<p>So, the native R pipe pipes the LHS into the first argument of the function on the RHS (with an extra requirement of needing a function call on the RHS). <strong>But that’s all!</strong> If you want to do anything <em>beyond</em> piping the LHS into the first argument of the RHS function, then you need the special anonymous function syntax introduced above.</p>
<p>A gotcha here is that we also needed to write parentheses around the anonymous function, such that a pseudocode version of the above is <code>mtcars |&gt; (anonymous-function-definition)()</code>. The reason for this is so that the second set of <code>()</code> properly points to the complex expression inside the first set of <code>()</code> as the function being called.<sup>2</sup><sup>3</sup></p>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1">mtcars <span class="sc" style="color: #5E5E5E;">|&gt;</span> (\(x) {</span>
<span id="cb18-2">   x[<span class="fu" style="color: #4758AB;">which.max</span>(x<span class="sc" style="color: #5E5E5E;">$</span>mpg), ]</span>
<span id="cb18-3">})()</span></code></pre></div>
<p>Thinking back to what we learned about the {magrittr} pipe <code>%&gt;%</code>, you might be tempted to use the dot syntax (<code>.</code>). A final important note is that the dot syntax does not work with the native R pipe <code>|&gt;</code> since the dot syntax is a feature of {magrittr} and not of base R. For example, this works:</p>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1">mtcars <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">plot</span>(.<span class="sc" style="color: #5E5E5E;">$</span>hp)</span></code></pre></div>
<p>But this doesn’t because there is no support for the dot syntax with the native R pipe:</p>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1">mtcars <span class="sc" style="color: #5E5E5E;">|&gt;</span> <span class="fu" style="color: #4758AB;">plot</span>(.<span class="sc" style="color: #5E5E5E;">$</span>hp)</span>
<span id="cb20-2"><span class="co" style="color: #5E5E5E;">#&gt; Error in pairs.default(data.matrix(x), ...) : object '.' not found</span></span></code></pre></div>
<p>However, if you create an anonymous function, you can decide what the input argument names are, whether <code>.</code>, <code>x</code>, <code>data</code>, anything! So, if you are tied to the dot syntax in {magrittr}, you can ‘bootstrap’ your own dot syntax with <code>\(.) {}</code>.</p>
<p>In sum, the native R pipe does not support the dot syntax unless you explicitly define your own.</p>
</section>
<section id="getting-to-the-solution" class="level2">
<h2 class="anchored" data-anchor-id="getting-to-the-solution">Getting to the solution</h2>
<p>Finally, we get to the solution: to get the native R pipe to do what we wanted to do with <code>plot()</code>, we need to use an anonymous function and bootstrap the dot syntax (or any other argument name) for ourselves:</p>
<div class="sourceCode" id="cb21" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><span class="co" style="color: #5E5E5E;"># verbosely</span></span>
<span id="cb21-2">mtcars <span class="sc" style="color: #5E5E5E;">|&gt;</span> (<span class="cf" style="color: #00769E;">function</span>(.) <span class="fu" style="color: #4758AB;">plot</span>(.<span class="sc" style="color: #5E5E5E;">$</span>hp, .<span class="sc" style="color: #5E5E5E;">$</span>mpg))()</span>
<span id="cb21-3"></span>
<span id="cb21-4"><span class="co" style="color: #5E5E5E;"># using the anonymous function shortcut, emulating the dot syntax</span></span>
<span id="cb21-5">mtcars <span class="sc" style="color: #5E5E5E;">|&gt;</span> (\(.) <span class="fu" style="color: #4758AB;">plot</span>(.<span class="sc" style="color: #5E5E5E;">$</span>hp, .<span class="sc" style="color: #5E5E5E;">$</span>mpg))()</span>
<span id="cb21-6"></span>
<span id="cb21-7"><span class="co" style="color: #5E5E5E;"># or if you prefer x to .</span></span>
<span id="cb21-8">mtcars <span class="sc" style="color: #5E5E5E;">|&gt;</span> (\(x) <span class="fu" style="color: #4758AB;">plot</span>(x<span class="sc" style="color: #5E5E5E;">$</span>hp, x<span class="sc" style="color: #5E5E5E;">$</span>mpg))()</span>
<span id="cb21-9"></span>
<span id="cb21-10"><span class="co" style="color: #5E5E5E;"># or if you prefer to be explicit with argument names</span></span>
<span id="cb21-11">mtcars <span class="sc" style="color: #5E5E5E;">|&gt;</span> (\(data) <span class="fu" style="color: #4758AB;">plot</span>(data<span class="sc" style="color: #5E5E5E;">$</span>hp, data<span class="sc" style="color: #5E5E5E;">$</span>mpg))()</span></code></pre></div>
<p>That’s it! 🎉 It can be done, but the initial attempt to be lazy ended up taking much more time than originally expected. As the saying goes, ‘a pipe in time saves nine.’</p>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/understanding-the-r-pipe/mario2.gif" class="img-fluid figure-img"></p>
<p></p><p></p>
</figure>
</div>
</center>
</section>
<section id="the-true-lazy-way" class="level2">
<h2 class="anchored" data-anchor-id="the-true-lazy-way">The true lazy way</h2>
<p>This was an exploration of how the <code>%&gt;%</code> and <code>|&gt;</code> pipes work, but we also have another option! The {magrittr} <strong>exposition pipe</strong> <code>%$%</code> ‘exposes’ the names in the LHS to the RHS expression.</p>
<p>So, the winner for lazy {magrittr} users like myself is:</p>
<div class="sourceCode" id="cb22" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1">mtcars <span class="sc" style="color: #5E5E5E;">%$%</span> <span class="fu" style="color: #4758AB;">plot</span>(hp, mpg)</span></code></pre></div>
<p>No dot syntax, no curly braces, no anonymous functions, no terminal function call, just a pipe and column names! It effectively emulates how <code>plot()</code> would work if it were a {tidyverse} function.</p>
<p>Really though, all pipe users are winners here! As shown in the alignment chart tweet, we have many options of doing what we want to do with R.</p>
<center>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
I couldn't resist getting in on the fun, updated for R &gt;= 4.1, created using {gt}! h/t <a href="https://twitter.com/skyetetra?ref_src=twsrc%5Etfw"><span class="citation" data-cites="skyetetra">@skyetetra</span></a> <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://twitter.com/hashtag/tidyverse?src=hash&amp;ref_src=twsrc%5Etfw">#tidyverse</a> <a href="https://twitter.com/hashtag/magrittr?src=hash&amp;ref_src=twsrc%5Etfw">#magrittr</a> <a href="https://twitter.com/hashtag/alignmentchart?src=hash&amp;ref_src=twsrc%5Etfw">#alignmentchart</a> <br><br>Repo here: <a href="https://t.co/gjGWLKYYG5">https://t.co/gjGWLKYYG5</a> <a href="https://t.co/1Ez6eQKkGd">pic.twitter.com/1Ez6eQKkGd</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1404947187155574787?ref_src=twsrc%5Etfw">June 15, 2021</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
</section>
<section id="more-resources" class="level2">
<h2 class="anchored" data-anchor-id="more-resources">More resources</h2>
<ul>
<li><a href="https://magrittr.tidyverse.org/reference/pipe.html">{magrittr} forward pipe operator help documentation</a> (or <code>?"%&gt;%"</code> in your R console)</li>
<li><a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/pipeOp.html">Forward pipe operator help documentation</a> (or <code>?pipeOp</code> in your R console)</li>
<li><a href="https://adv-r.hadley.nz/functions.html">Functions chapter in Advanced R</a></li>
</ul>
</section>
<section id="extra-credit-for-those-who-made-it-this-far" class="level2">
<h2 class="anchored" data-anchor-id="extra-credit-for-those-who-made-it-this-far">Extra credit for those who made it this far</h2>
<p>How would you do this with the proposed native R pipe-bind <code>=&gt;</code> syntax? Respond to my <a href="https://twitter.com/ivelasq3">tweet</a> about this blog post once you have the answer!</p>
<center>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
New blog post 👩🏻‍💻📝 Understanding the native R pipe |&gt;<br><br>In this post, I attempted the native R <a href="https://twitter.com/hashtag/pipeoperator?src=hash&amp;ref_src=twsrc%5Etfw">#pipeoperator</a> and was warped into the RHS, and emerged from my misadventuRe having learned all about the <a href="https://twitter.com/hashtag/magrittr?src=hash&amp;ref_src=twsrc%5Etfw">#magrittr</a> and <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> pipes.<br><br>Post: <a href="https://t.co/VOC1C6WGvl">https://t.co/VOC1C6WGvl</a> <a href="https://t.co/IDAHvwyE4K">pic.twitter.com/IDAHvwyE4K</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1483554890152439811?ref_src=twsrc%5Etfw">January 18, 2022</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
</section>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>The author thanks Gustavo E. for his comments on the first draft of this blog post.</p>


</section>

<div id="quarto-appendix" class="default"><section class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Running the same line without that argument, <code>mtcars %&gt;% plot(.$hp)</code>, does run without an error (but is not the plot that we want since it is using <code>mtcars</code> as the first argument, as mentioned above).↩︎</p></li>
<li id="fn2"><p>Curly braces for the first expression, <code>{}()</code>, work too: <code>mtcars |&gt; {\(x) {x[which.max(x$mpg),]}}()</code>. See Ronak Shah’s reply in this <a href="https://stackoverflow.com/questions/67633022/what-are-the-differences-between-rs-new-native-pipe-and-the-magrittr-pipe/67638063#67638063">StackOverflow thread</a> for an example.↩︎</p></li>
<li id="fn3"><p>Or for more on this, see Q2 and its answer in the ‘Functions’ chapter of <a href="https://advanced-r-solutions.rbind.io/functions.html">Advanced R Solutions</a>.↩︎</p></li>
</ol>
</section></div> ]]></description>
  <category>learn</category>
  <guid>https://ivelasq.rbind.io/blog/understanding-the-r-pipe/index.html</guid>
  <pubDate>Tue, 18 Jan 2022 06:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/understanding-the-r-pipe/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Creating a dataset from an image using reticulate in R Markdown</title>
  <link>https://ivelasq.rbind.io/blog/reticulate-data-recreation/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/reticulate-data-recreation/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Jungle with green trees and a red sun"></p>
<p></p><p></p>
</figure>
</div>
<p>Last week, a paper started making the Twitter rounds. <a href="https://www.biorxiv.org/content/10.1101/2020.07.30.228916v1.full.pdf">Selective attention in hypothesis-driven data analysis</a> by Professors Itai Yanai and Martin Lerche looked into whether providing specific hypotheses prevented students from fully exploring a dataset. The authors artificially created a dataset that, when plotted, clearly showed the outline of a cartoon gorilla.</p>
<center>
<img src="https://ivelasq.rbind.io/blog/reticulate-data-recreation/main.png" class="img-fluid" alt="Cartoon gorilla and its recreation in ggplot2">
</center>
<p>I will leave you to read the paper to find out the results but something that interested me was the dataset created from the image. The authors mentioned that they used a Python function called ‘getpixel’, manipulated the dataset into groups, and plotted it in {ggplot2}. I am learning the <a href="https://rstudio.github.io/reticulate/">{reticulate}</a> package which allows R to interface with Python and thought this would be a fun exercise to try.</p>
<p>With that, let’s recreate this dataset entirely within R Markdown! In addition to being able to copy/paste the code below, I have also provided it as a project on <a href="https://rstudio.cloud/project/2949291">RStudio Cloud</a> if you’d like to run the whole thing at once.</p>
<section id="install-packages" class="level2">
<h2 class="anchored" data-anchor-id="install-packages">Install packages</h2>
<p>First up is installing the R packages:</p>
<pre><code>```{r}
# Install packages if not already installed
# install.packages(c("tidyverse", "reticulate"))
library(tidyverse)
library(reticulate)
```</code></pre>
<p>In your project, create a folder called “image”. Save the image you would like to convert to a dataset in that folder. To recreate this paper’s dataset, go to <a href="https://classroomclipart.com/clipart-view/Clipart/Black_and_White_Clipart/Animals/gorilla-waving-cartoon-black-white-outline-clipart-914_jpg.htm">this</a> page and download the cartoon gorilla.</p>
<p>The paper mentions the ‘getpixel’ function. With a bit of digging, we find that is from the package <code>pillow</code> (a fork from a package called <code>PIL</code>). Like in R, we need to install the package. In an R Markdown document, I run the functions from {reticulate} below.</p>
<pre><code>```{r}
use_python("/usr/local/bin/python")
# If you haven't installed Python, the line below will prompt you!
py_install("pillow")
```</code></pre>
<p>Since {reticulate} is the package that allows you to call Python, if you do not have Python installed, then you will get a message (which you would reply Y to):</p>
<pre><code>No non-system installation of Python could be found.
Would you like to download and install Miniconda?
Miniconda is an open source environment management system for Python.
See https://docs.conda.io/en/latest/miniconda.html for more details.</code></pre>
</section>
<section id="create-coordinates" class="level2">
<h2 class="anchored" data-anchor-id="create-coordinates">Create coordinates</h2>
<p><a href="https://stackoverflow.com/questions/58398300/find-all-coordinates-of-black-grey-pixels-in-image-using-python">This</a> Stack Overflow thread was very helpful to determine what we need to do with the ‘getpixel’ function in <code>pillow</code>. Again, like in R, we need to call the functions we need but this time, we are doing it in a <code>python</code> chunk.</p>
<pre><code>```{python}
import numpy as np
from PIL import Image
```</code></pre>
<p>Then, we point to the image and create coordinates pixels for the outline of the cartoon. We can set a threshold level for which pixels to keep/discard.</p>
<pre><code>```{python}
# Thanks to Bart Huntley for pointing out a typo previously in this chunk!
im = Image.open("/cloud/project/image/gorilla.jpg")
pixels = np.asarray(im)

# Set threshold level
threshold_level = 50

# Find coordinates of all pixels below threshold
coords = np.column_stack(np.where(pixels &lt; threshold_level))
```</code></pre>
</section>
<section id="bring-back-into-r" class="level2">
<h2 class="anchored" data-anchor-id="bring-back-into-r">Bring back into R</h2>
<p>This results in a NumPy ndarray called <code>coords</code> that contains the coordinates of the pixels of the outline. That’s great but… it’s in Python! How do we bring it back into R?</p>
<p>The <a href="https://ugoproto.github.io/ugo_r_doc/pdf/reticulate.pdf">{reticulate} Cheat Sheet</a> was very helpful in figuring this out. The section “Python in R Markdown” shows that you can use the <code>py</code> object to access objects created in Python chunks from R chunks.</p>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/reticulate-data-recreation/Screen%20Shot%202021-09-27%20at%2011.40.55%20PM.png" class="img-fluid figure-img" alt="Python in R Markdown cheat sheet"></p>
<p></p><p></p>
</figure>
</div>
</center>

<p>Knowing that, we can create an R object from coords using <code>py</code>. Next, we follow the steps outlined in the paper for the data preparation.</p>
<pre><code>```{r}
coords &lt;-
  as.data.frame(py$coords) %&gt;%
  sample_n(1768) %&gt;%
  mutate(bmi = V2 * 17 + 15,
         steps = 15000 - V1 * 15000/max(V1)) %&gt;%
  mutate(randvar = rnorm(n(), mean = 0, sd = 10),
         randi = steps * (1 + randvar),
         gender = case_when(randi &lt; median(steps) ~ "Female",
                            TRUE ~ "Male"))
```</code></pre>
<p>If we’d like to see the distribution of data by male/female, we can use <code>count()</code>.</p>
<pre><code>```{r}
coords %&gt;%
  count(gender)
```</code></pre>
</section>
<section id="create-plots" class="level2">
<h2 class="anchored" data-anchor-id="create-plots">Create plots</h2>
<p>Now for the fun part - visualizing the plots (spoiler: one should always do this before starting an analysis)!</p>
<pre><code>```{r}
coords %&gt;%
  ggplot(aes(x = bmi,
              y = steps)) +
  geom_point() +
  theme_void() +
  xlim(0, 15000)
```</code></pre>
<center>
<img src="https://ivelasq.rbind.io/blog/reticulate-data-recreation/index.png" class="img-fluid" alt="ggplot2 image of pixel cartoon gorilla">
</center>
<pre><code>```{r}
coords %&gt;%
  ggplot(aes(x = bmi,
             y = steps,
             color = gender)) +
  geom_point() +
  theme_void() +
  xlim(0, 15000)
```</code></pre>
<p>With that, we’ve seamlessly gone from Python to R and created a dataset leveraging the power of both languages. Thanks to Professors Yanai and Lerche for their publication!</p>
<center>
<img src="https://ivelasq.rbind.io/blog/reticulate-data-recreation/index2.png" class="img-fluid" alt="ggplot2 image of pixel cartoon gorilla with random dots colored by gender">
</center>
<center>
<em>Liked this post? I’d love for you to retweet!</em>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
Did you see the paper where a dataset was created from a cartoon and thought, how do I create that using <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a>? This blog post walks through using reticulate to use <a href="https://twitter.com/hashtag/Python?src=hash&amp;ref_src=twsrc%5Etfw">#Python</a> and ggplot2 in the same R markdown notebook 😎🐍 <a href="https://t.co/4CbXzRd3PN">https://t.co/4CbXzRd3PN</a> <a href="https://t.co/Kq4WsaKHMk">pic.twitter.com/Kq4WsaKHMk</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1443216191858769922?ref_src=twsrc%5Etfw">September 29, 2021</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>learn</category>
  <guid>https://ivelasq.rbind.io/blog/reticulate-data-recreation/index.html</guid>
  <pubDate>Tue, 28 Sep 2021 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/reticulate-data-recreation/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Why I’m excited to join RStudio, told through a blogdown metadata project</title>
  <link>https://ivelasq.rbind.io/blog/why-rstudio/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/why-rstudio/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Olive trees against a blue background  and a bright sun"></p>
<p></p><p></p>
</figure>
</div>
<p>I am excited to announce that I’ve joined the RStudio Marketing team! I will be creating content on the <a href="https://blog.rstudio.com/">RStudio Blog</a> that will announce news and share stories from the company, users, and partners. I just started this week and, ready to jump in, I decided that I’d like to deep dive into previous blog posts.</p>
<p>The RStudio blog is written using <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> and each blog entry contains metadata in the YAML header. Since there are hundreds of blog entries, I decided to use R to quickly pull all this information into an analyzable data frame. While figuring out how to do this, I was reminded of why I am so excited to join RStudio in the first place (and if you want to jump straight into the code, click here!)</p>
<section id="the-awesomeness-that-is-the-r-community" class="level2">
<h2 class="anchored" data-anchor-id="the-awesomeness-that-is-the-r-community">The awesomeness that is the R community</h2>
<p>As I started the task of pulling the YAML information, I remembered a blogpost from <a href="https://twitter.com/grrrck">Garrick Aden-Buie</a> called <a href="https://www.garrickadenbuie.com/blog/find-blogdown-tags/">Find, count and list tags in all blogdown posts</a> (thanks, Garrick!). The post taught me about <code>blogdown:::scan_yaml()</code> which was exactly what I needed to get the information from all the YAML headers in the files.</p>
<p>The members of the R Community, including others at RStudio, are incredibly collaborative and helpful, and I hope to be able to contribute to others’ learning as well.</p>
</section>
<section id="rstudio-tools-rock" class="level2">
<h2 class="anchored" data-anchor-id="rstudio-tools-rock">RStudio tools rock</h2>
<p>I remember when my older brother introduced me to the tidyverse in graduate school after I had been struggling to understand how to program in R. I was amazed by its usability and functionality and it enabled me to learn more, learn quicker, and learn better. I’ve been fortunate enough to use RStudio tools for my work, like <a href="https://shiny.rstudio.com/">Shiny</a> and <a href="https://www.shinyapps.io/">shinyapps.io</a>, and each time appreciated the thoughtful and deep work that RStudio does with its services and products.</p>
<p>How great is it that the blogdown team anticipated the need to look at a blog’s metadata and already created a function that scans the YAML?! And that we can create a blog using R? And doing so is excellently <a href="https://bookdown.org/yihui/blogdown/">documented</a>?</p>
<p>In addition, below you will see many different <a href="https://www.tidyverse.org/">tidyverse</a> packages (dplyr, here, tibble, tidyr) being used as well. The seamless integration of R packages, tools, and services makes projects like this one possible and easy.</p>
</section>
<section id="so-much-to-write-about" class="level2">
<h2 class="anchored" data-anchor-id="so-much-to-write-about">So much to write about</h2>
<p>If you check out the <a href="https://blog.rstudio.com/tags/">tags</a> from the RStudio blog, you will see so many topics. APIs! BI tools! Package development! Interoperability! RStudio is working on so many things, open source and enterprise, and it is thrilling to be part of an organization that advocates for <a href="https://blog.rstudio.com/2021/05/12/code-first-data-science-for-the-enterprise2/">code-first</a> development, thrives in a diverse and supportive community, and thinks creatively about what challenges to tackle next.</p>
</section>
<section id="a-new-chapter-in-my-rstudio-journey" class="level2">
<h2 class="anchored" data-anchor-id="a-new-chapter-in-my-rstudio-journey">A new chapter in my RStudio journey</h2>
<p>I am proud to join an organization that I’ve long admired and hope that my contributions in this realm of RStudio’s business will promote the uptake of amazing RStudio products, and the crucial work RStudio does in free open-source software, data science education, and other spaces as a Public Benefit Corporation. I look forward to working alongside my colleagues at RStudio to achieve the company’s vision.</p>
<p>And with that… I give you, the code!</p>
</section>
<section id="the-code" class="level2">
<h2 class="anchored" data-anchor-id="the-code">The code</h2>
<section id="pulling-yaml-metadata-for-each-blog-post" class="level3">
<h3 class="anchored" data-anchor-id="pulling-yaml-metadata-for-each-blog-post">Pulling YAML metadata for each blog post</h3>
<p>I intended to create a data frame from a blogdown where every row represents a blog entry, and where we will have columns for (1) its title, (2), its author(s), (3) associated tags, and (4) associated categories. If you are using this code on your blogdown, you can change them to whichever YAML fields you would like.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># Load libraries</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-3"></span>
<span id="cb1-4"><span class="co" style="color: #5E5E5E;"># Find the folder with the blog posts</span></span>
<span id="cb1-5">blogdown_content_path <span class="ot" style="color: #00769E;">&lt;-</span> here<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"content"</span>, <span class="st" style="color: #20794D;">"post"</span>)</span>
<span id="cb1-6"></span>
<span id="cb1-7"><span class="co" style="color: #5E5E5E;"># Scan yaml of all posts (make sure the blogdown project is open)</span></span>
<span id="cb1-8">meta_list <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb1-9">  blogdown<span class="sc" style="color: #5E5E5E;">:::</span><span class="fu" style="color: #4758AB;">scan_yaml</span>(blogdown_content_path)</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;"># Create a data frame that pulls out the title, date, categories, and tags for each entry</span></span>
<span id="cb1-12">meta_df <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">tibble</span>(</span>
<span id="cb1-13">  <span class="at" style="color: #677623;">title =</span> <span class="fu" style="color: #4758AB;">map_chr</span>(meta_list, <span class="st" style="color: #20794D;">"title"</span>),</span>
<span id="cb1-14">  <span class="at" style="color: #677623;">date =</span> <span class="fu" style="color: #4758AB;">map</span>(meta_list, <span class="st" style="color: #20794D;">"date"</span>),</span>
<span id="cb1-15">  <span class="at" style="color: #677623;">categories =</span> <span class="fu" style="color: #4758AB;">map</span>(meta_list, <span class="st" style="color: #20794D;">"categories"</span>),</span>
<span id="cb1-16">  <span class="at" style="color: #677623;">tags =</span> <span class="fu" style="color: #4758AB;">map</span>(meta_list, <span class="st" style="color: #20794D;">"tags"</span>))</span></code></pre></div>
<p>In this case, there are entries where there is a vector within categories or tags - this is because a single blog post can have multiple categories or tags (see example <a href="https://blog.rstudio.com/2021/08/30/rstudio-connect-2021-08-custom-branding/">here</a>, which has “rstudio connect” and “featured” as categories).</p>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/why-rstudio/cells.png" class="img-fluid figure-img" alt="Cell names"></p>
<p></p><p></p>
</figure>
</div>
</center>
<p>The following code separates the tags or categories with multiple values so that each value has its own column using a <code>pivot_longer()</code> followed by <code>unnest()</code>, then re-pivots the table to wide format using <code>pivot_wider()</code>.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">meta_df_clean <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb2-2">  meta_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-3">  <span class="co" style="color: #5E5E5E;"># Put the fields with multiple options into one column called variable</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="at" style="color: #677623;">cols =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"categories"</span>, <span class="st" style="color: #20794D;">"tags"</span>),</span>
<span id="cb2-5">               <span class="at" style="color: #677623;">names_to =</span> <span class="st" style="color: #20794D;">"variable"</span>,</span>
<span id="cb2-6">               <span class="at" style="color: #677623;">values_to =</span> <span class="st" style="color: #20794D;">"value"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-7">  <span class="co" style="color: #5E5E5E;"># Split out the fields with multiple options into individual rows</span></span>
<span id="cb2-8">  <span class="fu" style="color: #4758AB;">unnest</span>(<span class="at" style="color: #677623;">cols =</span> value) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-9">  <span class="co" style="color: #5E5E5E;"># For each blog entry, give each category or tag a number</span></span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;">group_by</span>(title, variable) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">id =</span> <span class="fu" style="color: #4758AB;">row_number</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-12">  <span class="co" style="color: #5E5E5E;"># Pivot back to wide format</span></span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;">pivot_wider</span>(<span class="at" style="color: #677623;">names_from =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"id"</span>, <span class="st" style="color: #20794D;">"variable"</span>),</span>
<span id="cb2-14">              <span class="at" style="color: #677623;">names_glue =</span> <span class="st" style="color: #20794D;">"{variable}_{id}"</span>,</span>
<span id="cb2-15">              <span class="at" style="color: #677623;">values_from =</span> value)</span></code></pre></div>
<p>And that’s it! Now we have a data frame with each row denoting a blog entry, with its associated metadata.</p>
<p>Thank you so much for reading this article and I look forward to seeing you on the <a href="https://blog.rstudio.com">RStudio blog</a> or <a href="https://twitter.com/ivelasq3">Twitter</a>.</p>
<center>
<em>Liked this post? I’d love for you to retweet!</em>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
Here's how to pull the YAML for your blogdown posts using <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a>; figuring out how to do this was a great example of why I am excited to join RStudio 🥳<br><br>blogpost with code: <a href="https://t.co/RdI4zEwfX8">https://t.co/RdI4zEwfX8</a><br>h/t to <a href="https://twitter.com/grrrck?ref_src=twsrc%5Etfw"><span class="citation" data-cites="grrrck">@grrrck</span></a> 's post on finding tags in blogdown: <a href="https://t.co/p85frQbAiG">https://t.co/p85frQbAiG</a> <a href="https://t.co/bWwH2rsIYf">pic.twitter.com/bWwH2rsIYf</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1437402771947458565?ref_src=twsrc%5Etfw">September 13, 2021</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
</section>
 ]]></description>
  <category>analysis</category>
  <guid>https://ivelasq.rbind.io/blog/why-rstudio/index.html</guid>
  <pubDate>Mon, 13 Sep 2021 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/why-rstudio/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Politely scraping Wikipedia tables</title>
  <link>https://ivelasq.rbind.io/blog/politely-scraping/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/politely-scraping/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Bunches of purple violets with a white background"></p>
<p></p><p></p>
</figure>
</div>
<p><a href="https://en.wikipedia.org/wiki/Main_Page">Wikipedia</a> is such an amazing website, and also a fantastic source of data for analysis projects. I often find myself <a href="https://en.wikipedia.org/wiki/Web_scraping">scraping</a> Wikipedia’s tables for information and then cleaning and using the data for whatever I am working on.</p>
<p>However, scraping a website can create issues if not done properly. Though not required, I like to use the <a href="https://github.com/dmi3kno/polite">{polite} package</a> to introduce myself to the website and ask for permission to scrape.</p>
<p>Recently, I submitted the <a href="https://en.wikipedia.org/wiki/List_of_national_independence_days#List">Wikipedia table on independence days around the world</a> to <a href="https://github.com/rfordatascience/tidytuesday">TidyTuesday</a> - resulting in many beautiful and creative visualizations from the R Community! This post walks through how to “politely” scrape the table and pull it into a flat data frame so that it’s ready for use.</p>
<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load packages</h2>
<p>There are several packages needed for this walkthrough:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># To clean data</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(lubridate)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(janitor)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;"># To scrape data</span></span>
<span id="cb1-7"><span class="fu" style="color: #4758AB;">library</span>(rvest)</span>
<span id="cb1-8"><span class="fu" style="color: #4758AB;">library</span>(httr)</span>
<span id="cb1-9"><span class="fu" style="color: #4758AB;">library</span>(polite)</span></code></pre></div>
</section>
<section id="scrape-table" class="level2">
<h2 class="anchored" data-anchor-id="scrape-table">Scrape table</h2>
<p>First, we save the web page with the table that we would like as <code>url</code>:</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">url <span class="ot" style="color: #00769E;">&lt;-</span> <span class="st" style="color: #20794D;">"https://en.wikipedia.org/wiki/List_of_national_independence_days"</span></span></code></pre></div>
<p>Next, we use <code>polite::bow()</code> to introduce ourselves to the host, Wikipedia. This reads the rules from <code>robots.txt</code> and makes sure we follow them. The object (<code>url_bow</code> in this case) is saved as an object of class <code>polite</code>.</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">url_bow <span class="ot" style="color: #00769E;">&lt;-</span> polite<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">bow</span>(url)</span>
<span id="cb3-2">url_bow</span></code></pre></div>
<p>Next, we actually ‘scrape’ (pull the content of) the web page using <code>polite::scrape()</code>. This needs an object of class <code>polite</code> (created with <code>bow()</code> from before).</p>
<p>Since we politely scraped the entire web page, we want to use {rvest} to specify what exact content we’d like to pull out. We can do this using <code>html_nodes()</code>.</p>
<p>How do we know which node we want? There are probably other ways of doing this. As a Firefox and Mac user, I click Cmd + Shift + C which opens up the Developer Tools so that I can select a specific element from the web page. I hover over the table to determine what the HTML is called, in this case, <code>table.wikitable</code>.</p>
<center>
<img src="https://ivelasq.rbind.io/blog/politely-scraping/webpage.png" class="img-fluid" alt="Screenshot of Google's Inspector tool on Wikipedia">
</center>
<p>This object is saved as an HTML table which is great, but a data frame would be preferable for analysis. So the final step is to use <code>rvest::html_table()</code> to read this table as something with which we can use tidyverse tools. The parameter <code>fill = TRUE</code> allows you to fill empty rows with <code>NA</code>.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">ind_html <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb4-2">  polite<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">scrape</span>(url_bow) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  <span class="co" style="color: #5E5E5E;"># scrape web page</span></span>
<span id="cb4-3">  rvest<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">html_nodes</span>(<span class="st" style="color: #20794D;">"table.wikitable"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># pull out specific table</span></span>
<span id="cb4-4">  rvest<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">html_table</span>(<span class="at" style="color: #677623;">fill =</span> <span class="cn" style="color: #8f5902;">TRUE</span>) </span></code></pre></div>
</section>
<section id="flatten-table" class="level2">
<h2 class="anchored" data-anchor-id="flatten-table">Flatten table</h2>
<p>You will notice that <code>ind_html</code> is saved as a single object (a list) in which each element is a data frame. If we want to convert it to a flat data frame, we can specify that we want the content from only the first element <code>[[1]]</code>. We can then use <code>janitor::clean_names()</code> for nice, standardized column names.</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">ind_tab <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb5-2">  ind_html[[<span class="dv" style="color: #AD0000;">1</span>]] <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">clean_names</span>()</span></code></pre></div>
<p>That’s it! Now we’ve “politely” scraped the Wikipedia table into an analysis-ready data frame.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>Additional steps to clean the file can be found in my <a href="https://github.com/ivelasq/data-visualization-portfolio/blob/main/independence-days/independence_days.R">GitHub repo</a>. After doing so, I submitted to #TidyTuesday by submitting an <a href="https://github.com/rfordatascience/tidytuesday/issues">issue</a> on their page. Then they approved and shared the dataset!</p>
<p>This was a very quick walkthrough. I recommend Ryo Nakagawara’s <a href="https://ryo-n7.github.io/2020-05-14-webscrape-soccer-data-with-R/">blog post on politely scraping websites</a>, especially if you would like (1) more in-depth explanations of what {polite} does and (2) more complex scraping examples.</p>
<p>Which Wikipedia table will you analyze next?</p>
<center>
<em>Liked this post? I’d love for you to retweet!</em>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
📢 A short blog post on how to "politely" scrape a Wikipedia table using <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a>. Which page will you scrape next?!<a href="https://t.co/cTIy8UIFKm">https://t.co/cTIy8UIFKm</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1420022159947096065?ref_src=twsrc%5Etfw">July 27, 2021</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>analysis</category>
  <category>learn</category>
  <guid>https://ivelasq.rbind.io/blog/politely-scraping/index.html</guid>
  <pubDate>Tue, 27 Jul 2021 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/politely-scraping/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Getting started in #rtistry</title>
  <link>https://ivelasq.rbind.io/blog/rtistry-intro/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Abstract pink flowerswith red centers on a background of an orange spiral with brown background"></p>
<p></p><p></p>
</figure>
</div>
<p>Artists in the R community have been using the <a href="https://twitter.com/hashtag/rtistry"><code>#rtistry</code></a> hashtag to demonstrate their gorgeous, dynamic art using only the R programming language. Their creations are amazing and they inspired me to try out generative art this dreary Sunday.</p>
<p>I am proud to showcase my first #rtistry plot ever! Kinda reminds me of <a href="https://www.reddit.com/r/nostalgia/comments/66s0hc/kid_pix/">KidPix</a> (remember KidPix?!). I wanted to share how I did it and welcome any feedback or advice, as this is totally new and I’m not even sure if I am doing it right?</p>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/rtistry2.png" class="img-fluid figure-img" alt="Generative art showing a repeated parametric equation"></p>
<p></p><p></p>
</figure>
</div>
</center>
<p><br> As always, we start with the packages we will use:</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># Load packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(viridis)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(ggdark)</span></code></pre></div>
</div>
<section id="write-a-parametric-equation" class="level2">
<h2 class="anchored" data-anchor-id="write-a-parametric-equation">Write a parametric equation</h2>
<p>First up is figuring out the function you will use to create the plot. I decided to go with a parametric equation for my first <code>#rtistry</code> plot. A parametric equation of a curve expresses the coordinates of points of the curve as functions of a variable. <a href="https://lifethroughamathematicianseyes.wordpress.com/2014/11/13/parametric-equations/">This blog post</a> explains the concept very clearly and also has various examples of wonderful parametric equations.</p>
<p>Why parametric equations? First, even simple equations can create beautiful symmetries. Second, they are easy to modify to find the <em>perfect</em> plot.</p>
<p>The simplest parametric equation uses cosine and sine to make the unit circle:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1">circleFun <span class="ot" style="color: #00769E;">&lt;-</span> <span class="cf" style="color: #00769E;">function</span>(<span class="at" style="color: #677623;">center =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">0</span>), <span class="at" style="color: #677623;">diameter =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #677623;">npoints =</span> <span class="dv" style="color: #AD0000;">100</span>){</span>
<span id="cb2-2">    r <span class="ot" style="color: #00769E;">=</span> diameter <span class="sc" style="color: #5E5E5E;">/</span> <span class="dv" style="color: #AD0000;">2</span></span>
<span id="cb2-3">    tt <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">seq</span>(<span class="dv" style="color: #AD0000;">0</span>,<span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">*</span>pi,<span class="at" style="color: #677623;">length.out =</span> npoints)</span>
<span id="cb2-4">    xx <span class="ot" style="color: #00769E;">&lt;-</span> center[<span class="dv" style="color: #AD0000;">1</span>] <span class="sc" style="color: #5E5E5E;">+</span> r <span class="sc" style="color: #5E5E5E;">*</span> <span class="fu" style="color: #4758AB;">cos</span>(tt)</span>
<span id="cb2-5">    yy <span class="ot" style="color: #00769E;">&lt;-</span> center[<span class="dv" style="color: #AD0000;">2</span>] <span class="sc" style="color: #5E5E5E;">+</span> r <span class="sc" style="color: #5E5E5E;">*</span> <span class="fu" style="color: #4758AB;">sin</span>(tt)</span>
<span id="cb2-6">    <span class="fu" style="color: #4758AB;">return</span>(<span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #677623;">x =</span> xx, <span class="at" style="color: #677623;">y =</span> yy))</span>
<span id="cb2-7">}</span>
<span id="cb2-8"></span>
<span id="cb2-9">dat <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;">circleFun</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>), <span class="fl" style="color: #AD0000;">2.3</span>, <span class="at" style="color: #677623;">npoints =</span> <span class="dv" style="color: #AD0000;">100</span>)</span>
<span id="cb2-11"></span>
<span id="cb2-12"><span class="fu" style="color: #4758AB;">ggplot</span>(dat,<span class="fu" style="color: #4758AB;">aes</span>(x, y)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;">geom_path</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" alt="Circle plot" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s write a function to create a parametric equation. I based this equation on the aforementioned blog post equations. The parameters are:</p>
<ul>
<li>center: the center of the equation</li>
<li>npoints: the number of points used to evaluate the function.</li>
<li>c1, c2, c3, c4: the coefficients for the equation</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1">genFun <span class="ot" style="color: #00769E;">&lt;-</span> <span class="cf" style="color: #00769E;">function</span>(<span class="at" style="color: #677623;">center =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">0</span>), <span class="at" style="color: #677623;">npoints =</span> <span class="dv" style="color: #AD0000;">500</span>, <span class="at" style="color: #677623;">c1 =</span> <span class="fl" style="color: #AD0000;">2.5</span>, <span class="at" style="color: #677623;">c2 =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span>, <span class="at" style="color: #677623;">c3 =</span> <span class="fl" style="color: #AD0000;">4.28</span>, <span class="at" style="color: #677623;">c4 =</span> <span class="fl" style="color: #AD0000;">2.3</span>){</span>
<span id="cb3-2">    t <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">seq</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">*</span>pi, <span class="at" style="color: #677623;">length.out =</span> npoints)</span>
<span id="cb3-3">    xx <span class="ot" style="color: #00769E;">&lt;-</span> center[<span class="dv" style="color: #AD0000;">1</span>] <span class="sc" style="color: #5E5E5E;">+</span> c1<span class="sc" style="color: #5E5E5E;">*</span>(<span class="fu" style="color: #4758AB;">sin</span>(c2<span class="sc" style="color: #5E5E5E;">*</span>t)<span class="sc" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;">sin</span>(c2<span class="sc" style="color: #5E5E5E;">*</span>t))<span class="sc" style="color: #5E5E5E;">*</span>(<span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">^</span><span class="fu" style="color: #4758AB;">cos</span>(<span class="fu" style="color: #4758AB;">cos</span>(c3<span class="sc" style="color: #5E5E5E;">*</span>c4<span class="sc" style="color: #5E5E5E;">*</span>t)))</span>
<span id="cb3-4">    yy <span class="ot" style="color: #00769E;">&lt;-</span> center[<span class="dv" style="color: #AD0000;">2</span>] <span class="sc" style="color: #5E5E5E;">+</span> c1<span class="sc" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;">sin</span>(<span class="fu" style="color: #4758AB;">sin</span>(c2<span class="sc" style="color: #5E5E5E;">*</span>t))<span class="sc" style="color: #5E5E5E;">*</span>(<span class="fu" style="color: #4758AB;">cos</span>(c3<span class="sc" style="color: #5E5E5E;">*</span>c4<span class="sc" style="color: #5E5E5E;">*</span>t)<span class="sc" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;">cos</span>(c3<span class="sc" style="color: #5E5E5E;">*</span>c4<span class="sc" style="color: #5E5E5E;">*</span>t))</span>
<span id="cb3-5">    a <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #677623;">x =</span> xx, <span class="at" style="color: #677623;">y =</span> yy)</span>
<span id="cb3-6">    </span>
<span id="cb3-7">    <span class="fu" style="color: #4758AB;">return</span>(a)</span>
<span id="cb3-8">}</span></code></pre></div>
</div>
<p>Playing around with the function, we see how the graph gets smoother with more points and how the shape changes with different coefficients.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1">dat <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;">genFun</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>,<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>), <span class="at" style="color: #677623;">npoints =</span> <span class="dv" style="color: #AD0000;">100</span>)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;">aes</span>(x, y)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;">geom_path</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" alt="Different shapes of a parametric equation" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1">dat <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;">genFun</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>,<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>), <span class="at" style="color: #677623;">npoints =</span> <span class="dv" style="color: #AD0000;">500</span>, <span class="at" style="color: #677623;">c1 =</span> <span class="dv" style="color: #AD0000;">5</span>, <span class="at" style="color: #677623;">c2 =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">3</span>, <span class="at" style="color: #677623;">c3 =</span> <span class="dv" style="color: #AD0000;">5</span>, <span class="at" style="color: #677623;">c4 =</span> <span class="dv" style="color: #AD0000;">2</span>)</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;">aes</span>(x, y)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;">geom_path</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" alt="Different shapes of a parametric equation" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="create-variation-within-the-graph" class="level2">
<h2 class="anchored" data-anchor-id="create-variation-within-the-graph">Create variation within the graph</h2>
<p>Now that we have a basic shape, let’s play around with different aspects of the graph:</p>
<ul>
<li>geoms</li>
<li>Aesthetic specifications</li>
<li>Repetition</li>
</ul>
<section id="geoms" class="level3">
<h3 class="anchored" data-anchor-id="geoms">geoms</h3>
<p>We started off with <code>geom_path</code> but can play around with other geoms too. Here it is with <code>geom_line</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1">dat <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;">genFun</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>,<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>), <span class="at" style="color: #677623;">npoints =</span> <span class="dv" style="color: #AD0000;">5000</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;">ggplot</span>(dat, <span class="fu" style="color: #4758AB;">aes</span>(x, y)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;">geom_line</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" alt="Parametric equation with an abstract look" width="672"></p>
</figure>
</div>
</div>
</div>
<p>And with <code>geom_point</code>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1234</span>)</span>
<span id="cb7-2"></span>
<span id="cb7-3">dat <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;">genFun</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>,<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>), <span class="at" style="color: #677623;">npoints =</span> <span class="dv" style="color: #AD0000;">500</span>)</span>
<span id="cb7-5"></span>
<span id="cb7-6">dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(x, y)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;">geom_point</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" alt="Parametric equation with dots" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="aesthetic-specifications" class="level3">
<h3 class="anchored" data-anchor-id="aesthetic-specifications">Aesthetic specifications</h3>
<p>The {ggplot2} package has several aesthetic specifications available for plots. A full list can be found <a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html">here</a>.</p>
<p>We’re going to go ahead and get rid of all the background using <code>theme_void()</code>.</p>
<section id="size" class="level4">
<h4 class="anchored" data-anchor-id="size">Size</h4>
<p>Let’s go with <code>geom_point</code>. In this case, we can start playing around with the aesthetics to see what would look interesting. With <code>geom_point</code>, you can edit the sizes of the points, so we create a column with random point sizes to create some variation.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1111</span>)</span>
<span id="cb8-2"></span>
<span id="cb8-3">dat <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb8-4">  <span class="fu" style="color: #4758AB;">genFun</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">1</span>,<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>), <span class="at" style="color: #677623;">npoints =</span> <span class="dv" style="color: #AD0000;">5000</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">rand_w =</span> <span class="fu" style="color: #4758AB;">sample</span>(<span class="fu" style="color: #4758AB;">n</span>())<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">3000</span>)</span>
<span id="cb8-6"></span>
<span id="cb8-7">dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(x, y)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #677623;">size =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_w) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-10">  <span class="fu" style="color: #4758AB;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" alt="Parametric equation with dots closer together" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="shape" class="level4">
<h4 class="anchored" data-anchor-id="shape">Shape</h4>
<p>We could also change the shape of each of the points, but I liked the circles more:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1">dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(x, y)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #677623;">size =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_w,</span>
<span id="cb9-4">             <span class="at" style="color: #677623;">shape =</span> <span class="dv" style="color: #AD0000;">8</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" alt="Parametric equation with xes instead of dots" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="opacity" class="level4">
<h4 class="anchored" data-anchor-id="opacity">Opacity</h4>
<p>We could also change the opacity of the points:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1234</span>)</span>
<span id="cb10-2"></span>
<span id="cb10-3">dat <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb10-4">  dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">rand_o =</span> <span class="fu" style="color: #4758AB;">sample</span>(<span class="fu" style="color: #4758AB;">n</span>())<span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">5000</span>)</span>
<span id="cb10-6"></span>
<span id="cb10-7">dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(x, y)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-9">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #677623;">size =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_w,</span>
<span id="cb10-10">             <span class="at" style="color: #677623;">alpha =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_o) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-11">  <span class="fu" style="color: #4758AB;">theme_void</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" alt="Parametric equation with mixed opacity" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="color" class="level4">
<h4 class="anchored" data-anchor-id="color">Color</h4>
<p>We can also create a column for random numbers to ascribe colors to each point. I decided to use the magma color palette from the {viridis} package because it is so vibrant. Now that we’re not using only black points, we can use <code>dark_theme_void()</code> from the {ggdark} package for a fully black background.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1234</span>)</span>
<span id="cb11-2"></span>
<span id="cb11-3">dat <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb11-4">  dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">rand_c =</span> <span class="fu" style="color: #4758AB;">sample</span>(<span class="fu" style="color: #4758AB;">n</span>()))</span>
<span id="cb11-6"></span>
<span id="cb11-7">dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-8">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(x, y,  <span class="at" style="color: #677623;">color =</span> rand_c)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #677623;">size =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_w,</span>
<span id="cb11-10">             <span class="at" style="color: #677623;">alpha =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_o) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-11">  <span class="fu" style="color: #4758AB;">scale_color_viridis</span>(<span class="at" style="color: #677623;">option =</span> <span class="st" style="color: #20794D;">"magma"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-12">  <span class="fu" style="color: #4758AB;">dark_theme_void</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-13">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>) <span class="co" style="color: #5E5E5E;"># remove legend</span></span></code></pre></div>
<div class="cell-output-stderr">
<pre><code>Inverted geom defaults of fill and color/colour.
To change them back, use invert_geom_defaults().</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" alt="Parametric equation with various colors on a black background" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="repetition" class="level3">
<h3 class="anchored" data-anchor-id="repetition">Repetition</h3>
<p>Notice we added <code>rand_w</code>, <code>rand_o</code>, and <code>rand_c</code> so that we can randomly change up the size, opacity, and color of the plot. Let’s go back to our original generative function and them as parameters. Now we can change them without having to add them to the data frame externally from the function. (Apologies for the switching back and forth from dplyr to base R!)</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb13-1">genFun <span class="ot" style="color: #00769E;">&lt;-</span> <span class="cf" style="color: #00769E;">function</span>(<span class="at" style="color: #677623;">center =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">0</span>), <span class="at" style="color: #677623;">npoints =</span> <span class="dv" style="color: #AD0000;">500</span>, <span class="at" style="color: #677623;">c1 =</span> <span class="fl" style="color: #AD0000;">2.5</span>, <span class="at" style="color: #677623;">c2 =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">5</span>, <span class="at" style="color: #677623;">c3 =</span> <span class="fl" style="color: #AD0000;">4.28</span>, <span class="at" style="color: #677623;">c4 =</span> <span class="fl" style="color: #AD0000;">2.3</span>, <span class="at" style="color: #677623;">size_denom =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #677623;">opacity_denom =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #677623;">color_denom =</span> <span class="dv" style="color: #AD0000;">1</span>){</span>
<span id="cb13-2">    t <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">seq</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">*</span>pi, <span class="at" style="color: #677623;">length.out =</span> npoints)</span>
<span id="cb13-3">    xx <span class="ot" style="color: #00769E;">&lt;-</span> center[<span class="dv" style="color: #AD0000;">1</span>] <span class="sc" style="color: #5E5E5E;">+</span> c1<span class="sc" style="color: #5E5E5E;">*</span>(<span class="fu" style="color: #4758AB;">sin</span>(c2<span class="sc" style="color: #5E5E5E;">*</span>t)<span class="sc" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;">sin</span>(c2<span class="sc" style="color: #5E5E5E;">*</span>t))<span class="sc" style="color: #5E5E5E;">*</span>(<span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">^</span><span class="fu" style="color: #4758AB;">cos</span>(<span class="fu" style="color: #4758AB;">cos</span>(c3<span class="sc" style="color: #5E5E5E;">*</span>c4<span class="sc" style="color: #5E5E5E;">*</span>t)))</span>
<span id="cb13-4">    yy <span class="ot" style="color: #00769E;">&lt;-</span> center[<span class="dv" style="color: #AD0000;">2</span>] <span class="sc" style="color: #5E5E5E;">+</span> c1<span class="sc" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;">sin</span>(<span class="fu" style="color: #4758AB;">sin</span>(c2<span class="sc" style="color: #5E5E5E;">*</span>t))<span class="sc" style="color: #5E5E5E;">*</span>(<span class="fu" style="color: #4758AB;">cos</span>(c3<span class="sc" style="color: #5E5E5E;">*</span>c4<span class="sc" style="color: #5E5E5E;">*</span>t)<span class="sc" style="color: #5E5E5E;">*</span><span class="fu" style="color: #4758AB;">cos</span>(c3<span class="sc" style="color: #5E5E5E;">*</span>c4<span class="sc" style="color: #5E5E5E;">*</span>t))</span>
<span id="cb13-5">    rand_w <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">sample</span>(<span class="dv" style="color: #AD0000;">0</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">20</span>, npoints, <span class="at" style="color: #677623;">replace =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)<span class="sc" style="color: #5E5E5E;">/</span>size_denom</span>
<span id="cb13-6">    rand_o <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">sample</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">100</span>, npoints, <span class="at" style="color: #677623;">replace =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)<span class="sc" style="color: #5E5E5E;">/</span>opacity_denom</span>
<span id="cb13-7">    rand_c <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">sample</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">100</span>, npoints, <span class="at" style="color: #677623;">replace =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)<span class="sc" style="color: #5E5E5E;">/</span>color_denom</span>
<span id="cb13-8">    a <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">data.frame</span>(<span class="at" style="color: #677623;">x =</span> xx, <span class="at" style="color: #677623;">y =</span> yy, <span class="at" style="color: #677623;">rand_w =</span> rand_w, <span class="at" style="color: #677623;">rand_o =</span> rand_o, <span class="at" style="color: #677623;">rand_c =</span> rand_c)</span>
<span id="cb13-9">    </span>
<span id="cb13-10">    <span class="fu" style="color: #4758AB;">return</span>(a)</span>
<span id="cb13-11">}</span></code></pre></div>
</div>
<p>Now playing around with the new parameters, I decided to go with this plot:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;">set.seed</span>(<span class="dv" style="color: #AD0000;">1111</span>)</span>
<span id="cb14-2"></span>
<span id="cb14-3">dat <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb14-4">  <span class="fu" style="color: #4758AB;">genFun</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">0</span>), <span class="at" style="color: #677623;">npoints =</span> <span class="dv" style="color: #AD0000;">5000</span>, <span class="at" style="color: #677623;">c1 =</span> <span class="dv" style="color: #AD0000;">5</span>, <span class="at" style="color: #677623;">c2 =</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">3</span>, <span class="at" style="color: #677623;">c3 =</span> <span class="dv" style="color: #AD0000;">5</span>, <span class="at" style="color: #677623;">c4 =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #677623;">size_denom =</span> <span class="fl" style="color: #AD0000;">1.5</span>, <span class="at" style="color: #677623;">opacity_denom =</span> <span class="dv" style="color: #AD0000;">50</span>)</span>
<span id="cb14-5"></span>
<span id="cb14-6">dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-7">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(x, y,  <span class="at" style="color: #677623;">color =</span> rand_c)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-8">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #677623;">size =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_w,</span>
<span id="cb14-9">             <span class="at" style="color: #677623;">alpha =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_o) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-10">  <span class="fu" style="color: #4758AB;">scale_color_viridis</span>(<span class="at" style="color: #677623;">option =</span> <span class="st" style="color: #20794D;">"magma"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-11">  <span class="fu" style="color: #4758AB;">dark_theme_void</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb14-12">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>) <span class="co" style="color: #5E5E5E;"># remove legend</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" alt="Parametric equation with varying dot sizes and colors repeated around the center" width="672"></p>
</figure>
</div>
</div>
</div>
<p>What this allows us to do is change up the generative function and build on our plot. I was interested in rotating the plot around the axis.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb15-1">dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-2">  <span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(x, y,  <span class="at" style="color: #677623;">color =</span> rand_c),</span>
<span id="cb15-4">             <span class="at" style="color: #677623;">size =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_w,</span>
<span id="cb15-5">             <span class="at" style="color: #677623;">alpha =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_o) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-6">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="sc" style="color: #5E5E5E;">-</span>x, <span class="sc" style="color: #5E5E5E;">-</span>y,  <span class="at" style="color: #677623;">color =</span> rand_c),</span>
<span id="cb15-7">             <span class="at" style="color: #677623;">size =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_w,</span>
<span id="cb15-8">             <span class="at" style="color: #677623;">alpha =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_o) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-9">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="sc" style="color: #5E5E5E;">-</span>y, x,  <span class="at" style="color: #677623;">color =</span> rand_c),</span>
<span id="cb15-10">             <span class="at" style="color: #677623;">size =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_w,</span>
<span id="cb15-11">             <span class="at" style="color: #677623;">alpha =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_o) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-12">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="sc" style="color: #5E5E5E;">-</span>y, <span class="sc" style="color: #5E5E5E;">-</span>x,  <span class="at" style="color: #677623;">color =</span> rand_c),</span>
<span id="cb15-13">             <span class="at" style="color: #677623;">size =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_w,</span>
<span id="cb15-14">             <span class="at" style="color: #677623;">alpha =</span> dat<span class="sc" style="color: #5E5E5E;">$</span>rand_o) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-15">  <span class="fu" style="color: #4758AB;">scale_color_viridis</span>(<span class="at" style="color: #677623;">option =</span> <span class="st" style="color: #20794D;">"magma"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-16">  <span class="fu" style="color: #4758AB;">dark_theme_void</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb15-17">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>) <span class="co" style="color: #5E5E5E;"># remove legend</span></span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/rtistry-intro/index_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="co" style="color: #5E5E5E;"># ggsave(here::here("public", "img", "rtistry2.png"), dpi = 320, height = 6, width = 8) + # this sames the image</span></span></code></pre></div>
</div>
<p>Tada! My first ever #rtistry plot.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>This was my attempt to create generative art in R! It was fun to figure out how on earth to even get started and see how the plots change with new parameters on different attempts. I welcome any thoughts and please share your art using the #rtistry hashtag with <a href="https://twitter.com/ivelasq3">me</a>!</p>
<section id="rtists-i-follow" class="level3">
<h3 class="anchored" data-anchor-id="rtists-i-follow">rtists I follow</h3>
<ul>
<li><a href="https://twitter.com/djnavarro">Danielle Navarro</a></li>
<li><a href="https://twitter.com/ijeamaka_a">Ijeamaka A</a></li>
<li><a href="https://twitter.com/geokaramanis">Georgios Karamanis</a></li>
<li><a href="https://twitter.com/toeb18">Tobias Stalder</a></li>
</ul>
</section>
<section id="packages-for-creating-generative-art" class="level3">
<h3 class="anchored" data-anchor-id="packages-for-creating-generative-art">Packages for creating generative art</h3>
<ul>
<li>djnavarro’s <a href="https://github.com/djnavarro/flametree">flametree</a></li>
<li>ijeamaka_a’s <a href="https://github.com/Ijeamakaanyene/contouR">contourR</a></li>
<li>cutterkom’s <a href="https://github.com/cutterkom/generativeart">generativeart</a></li>
</ul>
<center>
<p><em>Liked this article? I’d love for you to retweet!</em></p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
New post! 📣 Interested in using <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> to create KidPix-like <a href="https://twitter.com/hashtag/generativeart?src=hash&amp;ref_src=twsrc%5Etfw">#generativeart</a> 🎨 ? Check out my first foray into <a href="https://twitter.com/hashtag/rtistry?src=hash&amp;ref_src=twsrc%5Etfw">#rtistry</a> using a parametric equation here! 👩🏻‍🎨 <a href="https://t.co/ykkddoK5tm">https://t.co/ykkddoK5tm</a><br><br>reposted due to typo 😅 <a href="https://t.co/V5bFSvDsOR">pic.twitter.com/V5bFSvDsOR</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1391947964013285379?ref_src=twsrc%5Etfw">May 11, 2021</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
</section>
 ]]></description>
  <guid>https://ivelasq.rbind.io/blog/rtistry-intro/index.html</guid>
  <pubDate>Sun, 09 May 2021 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/rtistry-intro/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Exploring other ggplot2 geoms</title>
  <link>https://ivelasq.rbind.io/blog/other-geoms/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/other-geoms/thumbnail-wide.jpg" class="img-fluid figure-img" alt="A person working in fields of colorful tulips with houses in the background"></p>
<p></p><p></p>
</figure>
</div>
<p>R users are incredibly fortunate to work in an open-source community that creates and shares resources that make our work even better. The {ggplot2} package comes with incredibly useful geoms (geometric objects) to create visualizations. A full list of these can be found in the <a href="https://ggplot2.tidyverse.org/reference/">reference documents</a> for {ggplot2}. These include:</p>
<ul>
<li><code>geom_bar</code> and <code>geom_col</code> for barcharts</li>
<li><code>geom_histogram</code> for histograms</li>
<li><code>geom_point</code> for scatterplots</li>
</ul>
<p>In addition, other amazing folks in the R Community have created geoms that can be used with {ggplot2} and similarly use the tidyverse framework. This is fantastic for many reasons, but some include being able to add themes, facets, titles, and other components just like with any <code>ggplot</code>. Here are a few geoms that I’ve tried out with examples!</p>
<ul>
<li>Streamgraphs using ggstream::geom_stream</li>
<li>Ridgeline plots using ggridges::geom_density_ridges</li>
<li>Sankey diagrams using ggsankey::geom_sankey &amp; ggalluvial::geom_alluvial</li>
<li>Bump charts using ggbump::geom_bump</li>
<li>Waffle charts using waffle::geom_waffle</li>
<li>Beeswarm charts using ggbeeswarm::geom_beeswarm</li>
<li>Mosaic charts using ggmosaic::geom_mosaic</li>
</ul>
<center>
<img src="https://ivelasq.rbind.io/blog/other-geoms/geoms.png" class="img-fluid" alt="Waffle plot, steamgraph, density graph, beeswarm, and mosaic plot">
</center>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>To be able to run this code, be sure to have the tidyverse installed. The {wesanderson} package contains beautiful palettes for visualizations.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># Load required packages</span></span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(wesanderson)</span></code></pre></div>
</div>
</section>
<section id="streamgraphs" class="level2">
<h2 class="anchored" data-anchor-id="streamgraphs">Streamgraphs</h2>
<p>This post includes three of David Sjöberg’s amazing geoms; he created {ggsankey}, {ggstream}, AND {ggbump}. If you haven’t seen his GitHub, please <a href="https://github.com/davidsjoberg">check it out now</a>.</p>
<p>This first geom, <code>geom_stream()</code>, creates a streamplot (which I’ve also seen called stream graphs). The streamplot is an area graph that usually centers around a central axis and allows us to see large fluctuations over time. More information on streamplot can be found <a href="https://en.wikipedia.org/wiki/Streamgraph">here</a>.</p>
<p>{ggstream} also has other options available to customize the streamgraphs, such as creating an area chart. Check out the repo <a href="https://github.com/davidsjoberg/ggstream">here</a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;"># remotes::install_github("davidsjoberg/ggstream")</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;">library</span>(ggstream)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;">ggplot</span>(blockbusters, <span class="fu" style="color: #4758AB;">aes</span>(year, box_office, <span class="at" style="color: #677623;">fill =</span> genre)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-5">  <span class="fu" style="color: #4758AB;">geom_stream</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">wes_palette</span>(<span class="st" style="color: #20794D;">"Darjeeling2"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-7">  <span class="fu" style="color: #4758AB;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/other-geoms/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ridgeline-plots" class="level2">
<h2 class="anchored" data-anchor-id="ridgeline-plots">Ridgeline plots</h2>
<p>The {ggridges} package by Claus O. Wilke package also has a variety of geoms; check out the repo <a href="https://github.com/wilkelab/ggridges">here</a>. Ridgeline plots show the distribution of a numeric value for different groups and can look like mountain ranges. The <a href="https://www.meetup.com/rladies-seattle/">R-Ladies Seattle</a> hex sticker was created using ridgelines (very appropriate for the mountainous Washington!).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;"># install.packages("ggridges")</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;">library</span>(ggridges)</span>
<span id="cb3-3"> </span>
<span id="cb3-4"><span class="fu" style="color: #4758AB;">ggplot</span>(blockbusters, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> box_office, <span class="at" style="color: #677623;">y =</span> genre, <span class="at" style="color: #677623;">fill =</span> genre)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;">geom_density_ridges</span>(<span class="at" style="color: #677623;">scale =</span> <span class="dv" style="color: #AD0000;">4</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">wes_palette</span>(<span class="st" style="color: #20794D;">"Darjeeling2"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/other-geoms/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sankey-diagrams" class="level2">
<h2 class="anchored" data-anchor-id="sankey-diagrams">Sankey diagrams</h2>
<p>Another geom by David Sjöberg is <code>geom_sankey()</code>, repo <a href="https://github.com/davidsjoberg/ggsankey">here</a>. This geom creates <a href="https://en.wikipedia.org/wiki/Sankey_diagram">Sankey diagrams</a> and <a href="https://en.wikipedia.org/wiki/Alluvial_diagram">alluvial plots</a>, which show flow and transfers in a system or throughout time. These plots are VERY popular on the subreddit <a href="https://www.reddit.com/r/dataisbeautiful/">dataisbeautiful</a> (check it out on Mondays to see some examples).</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;"># devtools::install_github("davidsjoberg/ggsankey")</span></span>
<span id="cb4-2"><span class="fu" style="color: #4758AB;">library</span>(ggsankey)</span>
<span id="cb4-3"></span>
<span id="cb4-4">example_dat <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb4-5">  mtcars <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;">make_long</span>(cyl, vs, am, gear, carb) <span class="co" style="color: #5E5E5E;"># function in ggsankey to format data correctly</span></span>
<span id="cb4-7"></span>
<span id="cb4-8"><span class="fu" style="color: #4758AB;">ggplot</span>(example_dat,</span>
<span id="cb4-9">       <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> x, </span>
<span id="cb4-10">               <span class="at" style="color: #677623;">next_x =</span> next_x, </span>
<span id="cb4-11">               <span class="at" style="color: #677623;">node =</span> node, </span>
<span id="cb4-12">               <span class="at" style="color: #677623;">next_node =</span> next_node,</span>
<span id="cb4-13">               <span class="at" style="color: #677623;">fill =</span> <span class="fu" style="color: #4758AB;">factor</span>(node))) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-14">   <span class="fu" style="color: #4758AB;">geom_sankey</span>(<span class="at" style="color: #677623;">flow.alpha =</span> .<span class="dv" style="color: #AD0000;">6</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-15">  <span class="fu" style="color: #4758AB;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/other-geoms/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Another package for alluvial charts is {ggalluvial} by Jason Cory Brunson, with its repo <a href="https://corybrunson.github.io/ggalluvial/">here</a>. The data can be in more familiar formats than what is required for {ggsankey}.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;"># install.packages("ggalluvial")</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">library</span>(ggalluvial)</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">as.data.frame</span>(UCBAdmissions),</span>
<span id="cb5-5">       <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">y =</span> Freq, <span class="at" style="color: #677623;">axis1 =</span> Gender, <span class="at" style="color: #677623;">axis2 =</span> Dept)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;">geom_alluvium</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">fill =</span> Admit), <span class="at" style="color: #677623;">width =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">12</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">wes_palette</span>(<span class="st" style="color: #20794D;">"Darjeeling2"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/other-geoms/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bump-charts" class="level2">
<h2 class="anchored" data-anchor-id="bump-charts">Bump charts</h2>
<p>One last one by David Sjöberg is the amazing {ggbump}, repo <a href="https://github.com/davidsjoberg/ggbump">here</a>. Bump plots help show change in rank over time.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;"># devtools::install_github("davidsjoberg/ggbump")</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;">library</span>(ggbump)</span>
<span id="cb6-3"></span>
<span id="cb6-4">blockbusters2 <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb6-5">  blockbusters <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;">filter</span>(genre <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Action"</span>, <span class="st" style="color: #20794D;">"Comedy"</span>, <span class="st" style="color: #20794D;">"Drama"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;">group_by</span>(year) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">rank =</span> <span class="fu" style="color: #4758AB;">rank</span>(box_office))</span>
<span id="cb6-9"></span>
<span id="cb6-10"><span class="fu" style="color: #4758AB;">ggplot</span>(blockbusters2, <span class="fu" style="color: #4758AB;">aes</span>(year, rank, <span class="at" style="color: #677623;">color =</span> genre)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-11">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #677623;">size =</span> <span class="dv" style="color: #AD0000;">7</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-12">  <span class="fu" style="color: #4758AB;">geom_bump</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;">scale_color_manual</span>(<span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">wes_palette</span>(<span class="st" style="color: #20794D;">"Darjeeling2"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/other-geoms/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="waffle-charts" class="level2">
<h2 class="anchored" data-anchor-id="waffle-charts">Waffle charts</h2>
<p>For waffle charts, which are handy visualizations that show completion or parts of a whole, there is hrbrmstr’s {waffle}. The repo is <a href="https://github.com/hrbrmstr/waffle">here</a>. Check out the ability to bring in other {ggplot2} functions, like <code>facet_wrap</code>. {waffle} also allows you to create pictograms using <code>geom_pictogram</code>, which replaces the squares in the ‘waffle’ with pictures.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="co" style="color: #5E5E5E;"># install.packages("waffle", repos = "https://cinc.rud.is")</span></span>
<span id="cb7-2"><span class="fu" style="color: #4758AB;">library</span>(waffle)</span>
<span id="cb7-3"></span>
<span id="cb7-4"><span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">as_tibble</span>(Titanic), <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">fill =</span> Sex, <span class="at" style="color: #677623;">values =</span> n)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;">geom_waffle</span>(<span class="at" style="color: #677623;">n_rows =</span> <span class="dv" style="color: #AD0000;">20</span>, <span class="at" style="color: #677623;">color =</span> <span class="st" style="color: #20794D;">"white"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-6">  <span class="fu" style="color: #4758AB;">facet_wrap</span>(<span class="sc" style="color: #5E5E5E;">~</span> Survived, <span class="at" style="color: #677623;">ncol =</span> <span class="dv" style="color: #AD0000;">1</span>)  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">wes_palette</span>(<span class="st" style="color: #20794D;">"Darjeeling2"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/other-geoms/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="beeswarm-charts" class="level2">
<h2 class="anchored" data-anchor-id="beeswarm-charts">Beeswarm charts</h2>
<p>Beeswarm charts, similar to jitter plots in {ggplot2}, plot individual points showing distributions without allowing the points to overlap too much. Erik Clarke’s repo for {ggbeeswarm} is <a href="https://github.com/eclarke/ggbeeswarm">here</a>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;"># install.packages("ggbeeswarm")</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;">library</span>(ggbeeswarm)</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;">ggplot</span>(blockbusters, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> genre, <span class="at" style="color: #677623;">y =</span> box_office, <span class="at" style="color: #677623;">color =</span> genre)) <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb8-5">  <span class="fu" style="color: #4758AB;">geom_quasirandom</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;">scale_color_manual</span>(<span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">wes_palette</span>(<span class="st" style="color: #20794D;">"Darjeeling2"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/other-geoms/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="mosaic-charts" class="level2">
<h2 class="anchored" data-anchor-id="mosaic-charts">Mosaic charts</h2>
<p>Mosaic charts are incredibly helpful when displaying proportions of (multiple) categories. The {ggmosaic} package by Haley Jeppson (repo <a href="https://github.com/haleyjeppson/ggmosaic">here</a>) uses <code>geom_mosaic</code> to create these visualizations.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="co" style="color: #5E5E5E;"># devtools::install_github("haleyjeppson/ggmosaic")</span></span>
<span id="cb9-2"><span class="fu" style="color: #4758AB;">library</span>(ggmosaic)</span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">as.data.frame</span>(UCBAdmissions)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;">geom_mosaic</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> <span class="fu" style="color: #4758AB;">product</span>(Admit, Dept), <span class="at" style="color: #677623;">fill =</span> Gender, <span class="at" style="color: #677623;">weight =</span> Freq)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">wes_palette</span>(<span class="st" style="color: #20794D;">"Darjeeling2"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/other-geoms/index_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="other-geoms" class="level2">
<h2 class="anchored" data-anchor-id="other-geoms">Other geoms</h2>
<p>I know there exist a ton of other geoms that work with {ggplot2} out there. Just as I was writing this blogpost, I discovered {gghilbertstrings}! What other gg packages or geoms do you know of? Let me know on <a href="https://twitter.com/ivelasq3">Twitter</a> and I’ll list them here!</p>
<center>
<p><em>Liked this post? I’d love for you to retweet!</em></p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
New post 🚀 Into the ggplot2niverse! 🚀 We love geom_point, geom_bar, and the built-in geoms in <a href="https://twitter.com/hashtag/ggplot2?src=hash&amp;ref_src=twsrc%5Etfw">#ggplot2</a> but have you used <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> pkgs with other geoms that use the <a href="https://twitter.com/hashtag/tidyverse?src=hash&amp;ref_src=twsrc%5Etfw">#tidyverse</a> like geom_sankey and geom_waffle? 🐝🧇 See them here &amp; let me know others <br>👉 <a href="https://t.co/orHyDMeVdd">https://t.co/orHyDMeVdd</a> <a href="https://t.co/DxKUxIJI08">pic.twitter.com/DxKUxIJI08</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1376681492030558211?ref_src=twsrc%5Etfw">March 29, 2021</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>learn</category>
  <guid>https://ivelasq.rbind.io/blog/other-geoms/index.html</guid>
  <pubDate>Sun, 28 Mar 2021 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/other-geoms/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Preparing a manuscript for publication using bookdown</title>
  <link>https://ivelasq.rbind.io/blog/bookdown-manuscript/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/bookdown-manuscript/thumbnail-wide.png" class="img-fluid figure-img" alt="Rough ocean waves crashing at a rock"></p>
<p></p><p></p>
</figure>
</div>
<p>My co-authors <a href="https://twitter.com/RyanEs">Ryan</a>, <a href="https://twitter.com/efreer20">Emily</a>, <a href="https://twitter.com/kierisi">Jesse</a>, <a href="https://twitter.com/jrosenberg6432">Josh</a>, and <a href="https://twitter.com/ivelasq3">I</a> published our book last year, but <a href="https://datascienceineducation.com/">Data Science in Education Using R</a> is also available online as a bookdown on a website, available to all.</p>
<p><a href="https://www.bookdown.org/">{bookdown}</a> is an R package that facilitates writing books and long-form articles/reports with R Markdown. <a href="">R Markdown</a> is a file format that allows you to write using markdown, a language for formatted text, and integrate R code, analyses, and visualizations. By using R Markdown, my co-authors and I were able to collaborate using familiar scripts, share and run code, and edit our manuscript for publication. By using {bookdown}, we were able to publish these R Markdown files to the web so people could access our book as we were writing it.</p>
<p>We have written <a href="https://education.rstudio.com/blog/2020/10/ds-in-edu/">a</a> <a href="https://rviews.rstudio.com/2020/05/26/community-and-collaboration-writing-our-book-in-the-open/">few</a> <a href="https://rviews.rstudio.com/2020/07/01/open-source-authorship-of-data-science-in-education-using-r/">times</a> about the open and collaborative nature of this work. This article will walk through the more technical aspects of using {bookdown} from our beginners’ standpoint. We hope it highlights the lessons we learned along the way. To peek at the actual files of our book, check out the <a href="https://github.com/data-edu/data-science-in-education">GitHub repo</a>.</p>
<p>So without further ado, here are some tips about {bookdown} that may be helpful on your book manuscript creation:</p>
<ul>
<li>Learning R Markdown and {bookdown}</li>
<li>Snooping on others’ GitHub files</li>
<li>Caching Code Chunks</li>
<li>Figuring out your publisher’s requirements</li>
<li>Determining how to collaborate</li>
</ul>
<section id="learning-r-markdown-and-bookdown" class="level2">
<h2 class="anchored" data-anchor-id="learning-r-markdown-and-bookdown">Learning R Markdown and {bookdown}</h2>
<p>The first place to start to learn {bookdown} is Yihui Xie’s <a href="https://bookdown.org/yihui/bookdown/">bookdown: Authoring Books and Technical Documents with R Markdown</a>. In addition to going into {bookdown}, it provides some information on R Markdown and how to use it as well.</p>
<p>If you are new to R Markdown, Yihui, J. J. Allaire, and Garrett Grolemund wrote a definitive guide, available <a href="https://bookdown.org/yihui/rmarkdown/">here</a>.</p>
<p>These books offer great guidance on {bookdown} and R Markdown, but below are some details if you want to get started with a minimal example of a bookdown.</p>
<section id="ok-you-installed-bookdown.-now-what" class="level3">
<h3 class="anchored" data-anchor-id="ok-you-installed-bookdown.-now-what">OK, you installed {bookdown}. Now what?</h3>
<p>You may notice that a lot of tutorials have you start using {bookdown} with a <a href="https://github.com/rstudio/bookdown-demo/blob/master/index.Rmd">demo project</a>. This is certainly one way to start - exploring the demo project and changing things to see how your book changes when it’s re-rendered. As far as I know, there is no standard template to begin a bookdown. The bare minimum of what you need is an <code>index.Rmd</code> file, your other R Markdown files, a <code>_bookdown.yml</code> file, and <code>_output.yml</code>.</p>
<section id="index.rmd" class="level4">
<h4 class="anchored" data-anchor-id="index.rmd">index.Rmd</h4>
<p>In your project folder, start with an <code>index.Rmd</code> file with title, author, site, and output in the YAML header of the file (the YAML header is the top part of the R Markdown file, see <a href="https://github.com/data-edu/data-science-in-education/blob/master/index.Rmd">here</a> between the <code>---</code>).</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb1-1"><span class="pp" style="color: #AD0000;">---</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">title</span><span class="kw" style="color: #00769E;">:</span><span class="at" style="color: #677623;"> </span><span class="st" style="color: #20794D;">"Test Book"</span></span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">author</span><span class="kw" style="color: #00769E;">:</span><span class="at" style="color: #677623;"> </span><span class="st" style="color: #20794D;">"Me"</span></span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">site</span><span class="kw" style="color: #00769E;">:</span><span class="at" style="color: #677623;"> bookdown::bookdown_site</span></span>
<span id="cb1-5"><span class="fu" style="color: #4758AB;">output</span><span class="kw" style="color: #00769E;">:</span><span class="at" style="color: #677623;"> bookdown::gitbook</span></span>
<span id="cb1-6"><span class="pp" style="color: #AD0000;">---</span></span></code></pre></div>
<p>Below the YAML header, you can use regular R Markdown syntax. Start it off with a first-level header. If you do not want it to be numbered, write <code>{-}</code> beside the header.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;"># Welcome {-}</span></span></code></pre></div>
<p>This will be the <em>first page</em> of your rendered book.</p>
</section>
<section id="other-r-markdown-files" class="level4">
<h4 class="anchored" data-anchor-id="other-r-markdown-files">Other R Markdown files</h4>
<p>Besides <code>index.Rmd</code>, other R Markdown files will make up the chapters of your book. <a href="https://bookdown.org/yihui/bookdown/usage.html">By default, bookdown merges all Rmd files by the order of filenames, e.g., 01-intro.Rmd will appear before 02-literature.Rmd</a>. As referenced in Yihui’s book, we named our files with a number first (see <a href="https://github.com/data-edu/data-science-in-education">here</a>].</p>
<p>Some tips:</p>
<p>We recommend each R Markdown file have only <em>one</em> first-level header; otherwise, your chapters will be cut off at any first-level header if you use the K-M rendering approach (see <a href="https://bookdown.org/yihui/bookdown/new-session.html">here</a>). Do not use the same first-level header in the same bookdown!</p>
</section>
<section id="bookdown.yml" class="level4">
<h4 class="anchored" data-anchor-id="bookdown.yml">_bookdown.yml</h4>
<p>Hey, did you notice there’s an underscore in the file name? I didn’t and spent an hour trying to figure out why the book wouldn’t render. So another tip, underscores are important :)</p>
<p>The <code>_bookdown.yml file</code> does not need much. Critical is the <code>book_filename</code> - we used <code>main.Rmd</code>. Here, you also specify the rendering method you would like (mentioned above), and also whether you want to delete the merged file (we recommend yes).</p>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb3-1"><span class="fu" style="color: #4758AB;">book_filename</span><span class="kw" style="color: #00769E;">:</span><span class="at" style="color: #677623;"> </span><span class="st" style="color: #20794D;">"bookdown-demo"</span></span>
<span id="cb3-2"><span class="fu" style="color: #4758AB;">delete_merged_file</span><span class="kw" style="color: #00769E;">:</span><span class="at" style="color: #677623;"> </span><span class="ch" style="color: #20794D;">true</span></span>
<span id="cb3-3"><span class="fu" style="color: #4758AB;">new_session</span><span class="kw" style="color: #00769E;">:</span><span class="at" style="color: #677623;"> </span><span class="ch" style="color: #20794D;">yes</span></span></code></pre></div>
<p>Besides this, you can add labels to figures and chapters, add scripts to run before each R Markdown file, change the order of your chapters manually (remember, by default it will be index.Rmd then by alphabetical order), and a lot more - but all of that is optional.</p>
</section>
<section id="output.yml" class="level4">
<h4 class="anchored" data-anchor-id="output.yml">_output.yml</h4>
<p>Oh heyy, another underscore!</p>
<p>This file will output your file according to what is specified. It’s also how figure height/width is specified, allows you to specify the TOC, etc. But really, if you want a bookdown all it needs is to know what you want your output to be.</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode yml code-with-copy"><code class="sourceCode yaml"><span id="cb4-1"><span class="at" style="color: #677623;">bookdown::gitbook</span></span></code></pre></div>
</section>
</section>
<section id="rendering-the-book" class="level3">
<h3 class="anchored" data-anchor-id="rendering-the-book">Rendering the book</h3>
<p>OKAY! So you have your files and the bare minimum of what you need to create a bookdown. To see it, go ahead and run:</p>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">bookdown<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">serve_book</span>()</span></code></pre></div>
<p>So now you have a bookdown! And you eagerly look at your accomplishment and it is great. But how do we find out what else we can do with {bookdown}?</p>
</section>
</section>
<section id="snooping-on-others-github-files" class="level2">
<h2 class="anchored" data-anchor-id="snooping-on-others-github-files">Snooping on others’ GitHub files</h2>
<p>When I do not know how to do something in R, I look at people who I want to emulate and snoop on their GitHub repository pages. It is so incredibly handy (and wonderful) that others post their code for all to see.</p>
<p>This is how we learned just how to even start using bookdown (copying people’s files, seeing what happened when we ran them), but also the creative ways that others went about customizing their books.</p>
<p>While there’s an <a href="https://bookdown.org/home/archive/">archive</a> of many books using {bookdown}, here are some specific works we used during our bookdown development:</p>
<ul>
<li>Forecasting: Principles and Practice by Rob J Hyndman and George Athanasopoulos (<a href="https://otexts.com/fpp2/">book</a>, <a href="https://github.com/nealxun/Forecasting_Principle_and_Practices">repo</a>) for customizing CSS on a bookdown with custom fonts, colors, etc.</li>
<li>Geocomputation with R by Robin Lovelace, Jakub Nowosad, and Jannes Muenchow (<a href="https://geocompr.robinlovelace.net/">book</a>, <a href="https://github.com/Robinlovelace/geocompr">repo</a>) to learn how to give figures labels.</li>
</ul>
<p>We highly recommend seeing what others have done in the past and trying things out so your book reflects what you would like it to look like!</p>
<section id="customizing-css" class="level3">
<h3 class="anchored" data-anchor-id="customizing-css">Customizing CSS</h3>
<p>Speaking of CSS, this is a nice way to make your bookdown your own. Once you add a <code>css/style.css</code> file in your bookdown repository, you can add <code>css: css/style.css</code> in your <code>_output.yml</code> file. Then, anytime your book renders, it will reference your CSS file. While not explicitly necessary for a manuscript (at least not ours), it is nice to customize one’s work.</p>
<section id="wait-what-if-i-dont-know-css" class="level4">
<h4 class="anchored" data-anchor-id="wait-what-if-i-dont-know-css">Wait, what if I don’t know CSS?</h4>
<p>Do not fret, reader. I also do not know CSS. But thankfully, the <strong>Google Developer Tool</strong> exists.</p>
<p>By right-clicking any part of a web page (including an existing bookdown) in Chrome, you can then click “Inspect Element” to see its HTML file and the hierarchy of the thing you just right-clicked on. Then, by clicking the arrow on the top left of your Inspector pane, you can click on anything to see its HTML file.</p>
<p>This, and a combination of snooping on GitHub, allowed us to find ways to customize our bookdown. <a href="https://github.com/data-edu/data-science-in-education/blob/master/css/style.css">Here</a> is where ours is located and where you can see what is referenced and changed with CSS. For example, this bit of code is saying for the book left-hand pane, when hovering, make the color white and the text <code>#ffbc49</code>.</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb6-1"><span class="fu" style="color: #4758AB;">.book</span> <span class="fu" style="color: #4758AB;">.book-summary</span> ul<span class="fu" style="color: #4758AB;">.summary</span> li a<span class="in" style="color: #5E5E5E;">:hover</span> {</span>
<span id="cb6-2">  <span class="kw" style="color: #00769E;">background-color</span>: <span class="cn" style="color: #8f5902;">#ffffff</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb6-3">  <span class="kw" style="color: #00769E;">color</span>: <span class="cn" style="color: #8f5902;">#ffbc49</span><span class="op" style="color: #5E5E5E;">;</span></span>
<span id="cb6-4">}</span></code></pre></div>
<p>This process takes a lot of trial and error, I will admit. It may be easier to pick up a bit of CSS if you have specific ideas in mind. However, if you need a quick edit of some pages, seeing how others have done it and exploring with the Developer Tools is very handy.</p>
</section>
</section>
</section>
<section id="caching-code-chunks" class="level2">
<h2 class="anchored" data-anchor-id="caching-code-chunks">Caching code chunks</h2>
<p>As mentioned in Yihui’s book, you can <a href="https://bookdown.org/yihui/bookdown/some-tips.html">cache</a> certain code chunks so they do not have to rerun each time you render the book. We found this very handy, as some complex models took some time to run.</p>
<p>Important to note though: if you use <code>set.seed</code>, you will need to include it in every code chunk; setting it in only one code chunk will not mean it is set for all code chunks.</p>
</section>
<section id="figuring-out-your-publishers-requirements" class="level2">
<h2 class="anchored" data-anchor-id="figuring-out-your-publishers-requirements">Figuring out your publisher’s requirements</h2>
<p>Creating a book using R/R Studio/{bookdown} is great because all of these tools are so versatile and we were able to use each one to meet our publisher requirements, minimize manual work, and reduce redundancies.</p>
<p>For example, here’s how {bookdown} helped us do what we had to do:</p>
<ul>
<li><strong>Our manuscript had to be in Word:</strong> we were able to render the bookdown using Word.</li>
<li><strong>Our manuscript needed all tables and figures to be labeled:</strong> we were able to automate this using the <code>.yml</code> files.</li>
<li><strong>Our figures had to be of a certain size and dimension:</strong> we were also able to automate this using the <code>.yml</code> files.</li>
<li><strong>We needed to send all of our figures separately from the manuscript:</strong> they are all saved separately due to the rendering function of {bookdown}.</li>
<li><strong>We needed a bibliography:</strong> we were able to create a bibliography of works and packages, all automated with {bookdown}.</li>
</ul>
<p>Because of R:</p>
<ul>
<li><strong>All tables had to be in Word format</strong>: at the time, we hadn’t seen this from <a href="https://cran.r-project.org/web/packages/gtsummary/vignettes/rmarkdown.html">{gtsummary}</a>, and we spent quite a bit of time trying to use {gt} for our tables before realizing that we wouldn’t be able to output using Word. We then switched to {sjPlot}, which got us exactly what we needed.</li>
</ul>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/bookdown-manuscript/gt.png" class="img-fluid figure-img" alt="Table of various table print engines, the functions for creating the tables, and whether they're supported in HTML, PDF, RTF, or Word."></p>
<p></p><p></p>
</figure>
</div>
</center>
<ul>
<li><strong>Our bibliography had to be in APA format:</strong> thanks to a file that Josh had (saved <a href="https://github.com/data-edu/data-science-in-education/blob/master/apa_pl.csl">here</a>), all we had to do was save that file and add <code>biblio-style: "apalike"</code> to our <code>index.Rmd</code> file for everything to show up in the format we needed.</li>
</ul>
<p>And, thanks to R Studio:</p>
<ul>
<li>We were able to spell-check files within the IDE!</li>
<li>We used its handy search function to create the index.</li>
</ul>
<p>So, we recommend gathering all of your publisher’s requirements and then mapping them to the different tools at your disposal. This saves a lot of time and headache when it’s finally time to send over the final manuscript.</p>
</section>
<section id="determining-how-to-collaborate" class="level2">
<h2 class="anchored" data-anchor-id="determining-how-to-collaborate">Determining how to collaborate</h2>
<p>Since my co-authors and I all knew GitHub, we decided to use GitHub to write the book. This was great because it was a transparent way of writing the book (non-authors added issues and contributed as they saw fit). We were able to go back in time if needed to fix errors or see what had been changed.</p>
<p>We had to decide how updating the book would work. Ultimately, we decided that one person would be in charge of rendering the book - this helped reduce any code conflicts. However, there may be other ways of working that would be better for you.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In conclusion, we chose to use {bookdown} to create a book manuscript because we wanted to be transparent in our work, leverage R and its many tools, and be as efficient as possible when writing a book across five people. Despite some technical lift (and a lot of trial and error), it eventually resulted in a smooth workflow for our group. Thanks to the many resources and code available out there, we were able to learn {bookdown} as we wrote. Thanks to {bookdown}, we output the final manuscript that resulted in our book!</p>
<center>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
New blogpost! 🎉 We created our book's manuscript using <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> and <a href="https://twitter.com/hashtag/bookdown?src=hash&amp;ref_src=twsrc%5Etfw">#bookdown</a>! How did we learn how to do it? #1 tip: snoop on other people's GitHub repos 👀 Read more here: <a href="https://t.co/jSozoz86gj">https://t.co/jSozoz86gj</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1369106413079851012?ref_src=twsrc%5Etfw">March 9, 2021</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>learn</category>
  <guid>https://ivelasq.rbind.io/blog/bookdown-manuscript/index.html</guid>
  <pubDate>Mon, 08 Mar 2021 06:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/bookdown-manuscript/thumbnail.png" medium="image" type="image/png" height="144" width="144"/>
</item>
<item>
  <title>Remote pair programming in R using Visual Studio Code and Live Share</title>
  <dc:creator>Isabella Velásquez</dc:creator>
  <dc:creator>Gustavo E. Velásquez</dc:creator>
  <link>https://ivelasq.rbind.io/blog/vscode-live-share/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/vscode-live-share/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Two ballerina dancers at the barre, one with her leg in the air"></p>
<p></p><p></p>
</figure>
</div>
<ul>
<li>The Problem</li>
<li>State of the Code Editors</li>
<li>Installation</li>
<li>Configuration</li>
<li>Writing an R Package Using VS Code</li>
<li>Live Share Tutorial</li>
<li>Final Thoughts</li>
</ul>
<section id="the-problem" class="level2">
<h2 class="anchored" data-anchor-id="the-problem">The problem</h2>
<p>Way back in the <a href="https://www.urbandictionary.com/define.php?term=The%20Before%20Time">Before Time</a>, my <a href="https://github.com/gvelasq">older brother</a> and I worked together on an R package called <a href="https://ivelasq.github.io/wizehiver">{wizehiver}</a>. To collaborate, we used many tools. We had an email thread (of over 35 emails!) that eventually became two email threads. We tried <a href="https://github.com/ivelasq/wizehiver/issues?q=is%3Aissue+is%3Aclosed">GitHub Issues</a>, but we were in such close communication that the back-and-forth on issues was ineffectual. We also tried <a href="https://en.m.wikipedia.org/wiki/Pair_programming">pair programming</a> but since we lived in separate cities, we did it while one of us would share our screen on Skype. We wished there was a better, more hands-on, and immediate way to collaborate in a source code editor in <a href="https://en.wikipedia.org/wiki/Collaborative_real-time_editor">real-time</a>, similar to how seamless it is to work on Google Docs.</p>
</section>
<section id="state-of-the-code-editors" class="level2">
<h2 class="anchored" data-anchor-id="state-of-the-code-editors">State of the code editors</h2>
<p>The <a href="https://rstudio.com/products/rstudio">RStudio IDE</a> is in our opinion the best IDE for R out there; however, live collaboration using RStudio’s <a href="https://docs.rstudio.com/ide/server-pro/r-sessions.html#project-sharing">Project Sharing</a> feature is limited to those with a paid <a href="https://rstudio.com/pricing">RStudio Server Pro</a> license as of this writing. There are many source code editors out there, and notably <a href="https://atom.io/packages/teletype">Atom</a> and <a href="https://marketplace.visualstudio.com/items?itemName=MS-vsliveshare.vsliveshare">Visual Studio (VS) Code</a> both provide extensions for free, collaborative real-time editing.</p>
<p>We have been following, with increasing <a href="https://github.com/issues?q=vscode+OR+radian+OR+languageserver+OR+vscDebugger+is%3Aissue+author%3Agvelasq">interest</a>, the growing community of developers who have been focused on tools for R in VS Code. There are now several R packages, VS Code extensions, and a command-line R console available, as well as several tutorials dedicated to R in VS Code. Here we set out to see if VS Code could fill the particular gap we identified in our previous work together — the need for seamless remote pair programming. A few of our use cases are:</p>
<ol type="1">
<li><p>We wanted to collaborate on this blog post in a shared <code>.Rmd</code> file which we could edit and knit as we wrote. Ultimately we wrote most of this post on Google Docs before transferring it to a versioned <code>.Rmd</code> on GitHub for finishing touches.</p></li>
<li><p>We wanted to start collaborating on an open-source R package <a href="https://github.com/gvelasq/mutagen">{mutagen}</a> which will (someday) provide useful extensions to <a href="https://dplyr.tidyverse.org/">{dplyr}</a>’s <a href="https://dplyr.tidyverse.org/reference/mutate.html"><code>mutate()</code></a>:</p></li>
</ol>
<center>
<img src="https://ivelasq.rbind.io/blog/vscode-live-share/https:/raw.githubusercontent.com/gvelasq/mutagen/master/man/figures/logo.jpeg" class="img-fluid">
</center>
<p>So far, we only have a hex sticker — <a href="https://twitter.com/search?q=%23hexdrivendevelopment">#hexdrivendevelopment</a> in action!</p>
<center>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
but… I… already… know… how… the… hexsticker… should… look…
</p>
— Thomas Lin Pedersen (<span class="citation" data-cites="thomasp85">@thomasp85</span>) <a href="https://twitter.com/thomasp85/status/1022413631340912640?ref_src=twsrc%5Etfw">July 26, 2018</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
<p>Embarrassingly, our last commit to the package was in December 2019. While it would be convenient to blame the pandemic, it was a mix of being busy and other ‘hobby’ projects. However, having a synchronous way of collaborating—where we could see the package being built in action—would enable us to truly get the project underway. Before we begin the tutorial, first we have a public service announcement: if you would like to see Microsoft devote additional resources to support R in VS Code, please upvote R in this <code>vscode-jupyter</code> <a href="https://github.com/microsoft/vscode-jupyter/issues/1536">issue</a>!</p>
</section>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>We’re going to use <a href="https://brew.sh/">Homebrew</a> to facilitate installation steps on macOS. We only provide instructions for macOS here, but we do provide links for macOS users who prefer to install applications using the point-and-click method, and for Linux and Windows users to find the correct binaries. We also indicate which steps are optional.</p>
<ol type="1">
<li><p>Open Applications &gt; Utilities &gt; Terminal.</p></li>
<li><p>Install <a href="https://brew.sh/">Homebrew</a> using the terminal command below, also provided on the Homebrew landing page. Paste this code into your terminal:</p></li>
</ol>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb1-1"><span class="ex" style="color: null;">/bin/bash</span> <span class="at" style="color: #677623;">-c</span> <span class="st" style="color: #20794D;">"</span><span class="va" style="color: #111111;">$(</span><span class="ex" style="color: null;">curl</span> <span class="at" style="color: #677623;">-fsSL</span> https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh<span class="va" style="color: #111111;">)</span><span class="st" style="color: #20794D;">"</span></span></code></pre></div>
<ol type="1">
<li>(Optional) For our favorite free and open-source terminal on macOS, install <a href="https://iterm2.com/">iTerm2</a> by pasting this into your terminal:</li>
</ol>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb2-1"><span class="ex" style="color: null;">brew</span> install <span class="at" style="color: #677623;">--cask</span> iterm2</span></code></pre></div>
<ol type="1">
<li>If you don’t have them already, you’ll need <a href="https://cloud.r-project.org/">R</a> and <a href="https://rstudio.com/products/rstudio/download/preview/">RStudio Desktop</a>. We’re partial to the preview version of RStudio Desktop which has all the latest features. You can install (and update) them easily from your terminal:</li>
</ol>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb3-1"><span class="ex" style="color: null;">brew</span> install <span class="at" style="color: #677623;">--cask</span> r</span>
<span id="cb3-2"><span class="ex" style="color: null;">brew</span> tap homebrew/cask-versions</span>
<span id="cb3-3"><span class="ex" style="color: null;">brew</span> install <span class="at" style="color: #677623;">--cask</span> rstudio-preview</span></code></pre></div>
<ol type="1">
<li>Install <a href="https://github.com/randy3k/radian"><code>radian</code></a>, a ‘21st century R console’ and the recommended R console for VS Code.</li>
</ol>
<p><em>Update 2021-02-11</em>: Thanks to the efforts of <a href="https://twitter.com/jdblischak"><code>@jdblischak</code></a> and <a href="https://github.com/randy3k"><code>@randy3k</code></a> in this closed <a href="https://github.com/randy3k/radian/issues/244">issue</a>, <code>radian</code> can now be installed with <a href="https://anaconda.org/conda-forge/radian"><code>conda-forge</code></a> instead of only with <a href="https://pypi.org/project/radian/"><code>pip</code></a>. Most data science tutorials recommend using Python with <a href="https://docs.conda.io/projects/conda/en/latest"><code>conda</code></a> environments, so we suspect that our readers will be more familiar with using <code>conda</code> than <code>pip</code>, as we are. If you do choose to use <code>pip</code> (or <a href="https://snarky.ca/why-you-should-use-python-m-pip/"><code>python -m pip</code></a>), beware that <code>pip</code> <a href="https://www.anaconda.com/blog/using-pip-in-a-conda-environment">should be used carefully</a> inside <code>conda</code> environments.</p>
<p>The steps below first install <a href="https://github.com/conda-forge/miniforge">Miniforge</a>, which we prefer to <a href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a> since it sets <code>conda-forge</code> as the default channel, then create an empty <code>conda</code> environment named <code>r-console</code> into which we install <code>radian</code> and <a href="https://anaconda.org/conda-forge/jedi"><code>jedi</code></a>. <code>jedi</code> is an optional package that enables Python autocompletion using the <a href="https://rstudio.github.io/reticulate/">{reticulate}</a> R package. Paste this into your terminal:</p>
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb4-1"><span class="ex" style="color: null;">brew</span> install miniforge</span>
<span id="cb4-2"><span class="ex" style="color: null;">conda</span> create <span class="at" style="color: #677623;">--name</span> r-console</span>
<span id="cb4-3"><span class="ex" style="color: null;">conda</span> activate r-console</span>
<span id="cb4-4"><span class="ex" style="color: null;">conda</span> install radian</span>
<span id="cb4-5"><span class="ex" style="color: null;">conda</span> install jedi <span class="co" style="color: #5E5E5E;"># for {reticulate} python autocompletion</span></span></code></pre></div>
<ol type="1">
<li>In RStudio, install the required R packages for VS Code, namely <a href="https://github.com/REditorSupport/languageserver">{languageserver}</a> from CRAN and the latest GitHub release of <a href="https://github.com/ManuelHentschel/vscDebugger">{vscDebugger}</a>:</li>
</ol>
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"languageserver"</span>)</span>
<span id="cb5-2">remotes<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">install_github</span>(<span class="st" style="color: #20794D;">"ManuelHentschel/vscDebugger"</span>, <span class="at" style="color: #677623;">ref =</span> remotes<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">github_release</span>())</span></code></pre></div>
<p>For the tutorial, make sure that you have the following R packages installed, if you don’t already:</p>
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"devtools"</span>)</span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"dplyr"</span>)</span>
<span id="cb6-3"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"purrr"</span>)</span>
<span id="cb6-4"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"tibble"</span>)</span>
<span id="cb6-5"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"usethis"</span>)</span>
<span id="cb6-6"><span class="fu" style="color: #4758AB;">install.packages</span>(<span class="st" style="color: #20794D;">"vctrs"</span>)</span></code></pre></div>
<ol type="1">
<li>Install <a href="https://code.visualstudio.com/">VS Code</a> by pasting this into your terminal:</li>
</ol>
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb7-1"><span class="ex" style="color: null;">brew</span> install <span class="at" style="color: #677623;">--cask</span> visual-studio-code</span></code></pre></div>
<ol type="1">
<li>Open VS Code and install the following extensions from the Extensions gallery (<code>Shift-Command-X</code>):</li>
</ol>
<!-- -->
<ol type="1">
<li><a href="https://marketplace.visualstudio.com/items?itemName=Ikuyadeu.r">R</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=REditorSupport.r-lsp">R LSP Client</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=RDebugger.r-debugger">R Debugger</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=MS-vsliveshare.vsliveshare">Live Share</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=MS-vsliveshare.vsliveshare-audio">Live Share Audio</a></li>
</ol>
</section>
<section id="configuration" class="level2">
<h2 class="anchored" data-anchor-id="configuration">Configuration</h2>
<ol type="1">
<li>Make sure the <code>r-console</code> environment is still active in your terminal. If it is, your terminal prompt will look like this, or similar:</li>
</ol>
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb8-1"><span class="kw" style="color: #00769E;">(</span><span class="ex" style="color: null;">r-console</span><span class="kw" style="color: #00769E;">)</span> <span class="ex" style="color: null;">~</span> %</span></code></pre></div>
<p>If not, then reactivate the <code>r-console</code> environment:</p>
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb9-1"><span class="ex" style="color: null;">conda</span> activate r-console</span></code></pre></div>
<ol type="1">
<li>Type <code>which radian</code> in your terminal to display the path to the <code>radian</code> executable. Below is what it is on our local machines. Copy the path to your clipboard.</li>
</ol>
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb10-1"><span class="ex" style="color: null;">/usr/local/Caskroom/miniforge/base/envs/r-console/bin/radian</span></span></code></pre></div>
<ol type="1">
<li>Determine whether <code>bash</code> or <code>zsh</code> is your default shell. If you don’t know, type this into your terminal:</li>
</ol>
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb11-1"><span class="bu" style="color: null;">echo</span> <span class="va" style="color: #111111;">$SHELL</span></span></code></pre></div>
<p>Older Macs may still use <code>bash</code>, while newer Macs or those with older Macs who have created new user accounts since upgrading to macOS Catalina will likely run <code>zsh</code>, the <a href="https://scriptingosx.com/2019/06/moving-to-zsh">new default macOS shell</a>.</p>
<ol type="1">
<li>Let’s take VS Code for a spin! An useful feature to know about is that typing <code>code &lt;path/file.ext&gt;</code> in your terminal will open a new or existing file in VS Code at the path you specify. Many more details are available in the help page <code>code -h</code>. Depending on whether your default shell is <code>bash</code> or <code>zsh</code>, type <code>code ~/.bashrc</code> or <code>code ~/.zshrc</code> in your terminal to open your shell configuration file, and paste the path you copied in step 2. above to add an alias to <code>radian</code> and bind it to lowercase <code>r</code>:</li>
</ol>
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb12-1"><span class="bu" style="color: null;">alias</span> r=<span class="st" style="color: #20794D;">"/usr/local/Caskroom/miniforge/base/envs/r-console/bin/radian"</span></span></code></pre></div>
<p>You can paste the alias anywhere in the file, but it is probably best to paste it at the very bottom, and avoid inserting it in any preexisting code blocks (e.g., <code>conda initialize</code> blocks) which may be overwritten. Save your configuration file and restart your terminal for the settings to take effect. Now all you need to open <code>radian</code> is to type <code>r</code> in any terminal (Terminal, iTerm2, RStudio, or VS Code)! Useful <code>radian</code> commands to know are:</p>
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode zsh code-with-copy"><code class="sourceCode zsh"><span id="cb13-1"><span class="fu" style="color: #4758AB;">q()</span> <span class="co" style="color: #5E5E5E;"># to exit R, same as with vanilla R and RStudio</span></span>
<span id="cb13-2"><span class="kw" style="color: #00769E;">;</span>   <span class="co" style="color: #5E5E5E;"># to enter shell mode, exit by pressing backspace on an empty line</span></span>
<span id="cb13-3"><span class="ex" style="color: null;">~</span>   <span class="co" style="color: #5E5E5E;"># to enter {reticulate} python mode, exit by pressing backspace on an empty line</span></span></code></pre></div>
<ol type="1">
<li>To configure your <code>.Rprofile</code>, type <code>code ~/.Rprofile</code> in your terminal, or if you are already set up with <a href="https://usethis.r-lib.org">{usethis}</a> in RStudio, run the R command <a href="https://usethis.r-lib.org/reference/edit.html"><code>usethis::edit_r_profile()</code></a>. At a minimum, you will want to enable <a href="https://rstudio.github.io/rstudioapi">{rstudioapi}</a> <a href="https://github.com/Ikuyadeu/vscode-R/wiki/RStudio-addin-support">emulation</a> in VS Code:</li>
</ol>
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;">options</span>(<span class="at" style="color: #677623;">vsc.rstudioapi =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span></code></pre></div>
<ol type="1">
<li>To configure <code>radian</code>, type <code>code ~/.radian_profile</code> in your terminal which will open up a new blank editor and create a new file named <code>.radian_profile</code> in the home directory. This is our <a href="https://github.com/gvelasq/dotfiles/blob/master/radian/.radian_profile"><code>.radian_profile</code></a>:</li>
</ol>
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><span class="fu" style="color: #4758AB;">options</span>(</span>
<span id="cb15-2">    <span class="at" style="color: #677623;">radian.insert_new_line =</span> <span class="cn" style="color: #8f5902;">FALSE</span>,</span>
<span id="cb15-3">    <span class="at" style="color: #677623;">radian.escape_key_map =</span> <span class="fu" style="color: #4758AB;">list</span>(</span>
<span id="cb15-4">        <span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #677623;">key =</span> <span class="st" style="color: #20794D;">"-"</span>, <span class="at" style="color: #677623;">value =</span> <span class="st" style="color: #20794D;">" &lt;- "</span>),</span>
<span id="cb15-5">        <span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #677623;">key =</span> <span class="st" style="color: #20794D;">"m"</span>, <span class="at" style="color: #677623;">value =</span> <span class="st" style="color: #20794D;">" %&gt;% "</span>)</span>
<span id="cb15-6">    )</span>
<span id="cb15-7">)</span></code></pre></div>
<p>Save <code>~/.radian_profile</code> and restart your terminal for the settings to take effect.</p>
<ol type="1">
<li>Now we’ll configure VS Code settings. Open VS Code, and navigate to <code>settings.json</code> by using the Command Palette (<code>Shift-Command-P</code>) and navigating to <code>Preferences: Open Settings (JSON)</code>. This is our <a href="https://github.com/gvelasq/dotfiles/blob/master/vscode/settings.json"><code>settings.json</code></a>:</li>
</ol>
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb16-1"><span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb16-2">    <span class="er" style="color: #AD0000;">//</span> <span class="er" style="color: #AD0000;">Liveshare</span><span class="fu" style="color: #4758AB;">:</span> <span class="er" style="color: #AD0000;">Prompt</span> <span class="er" style="color: #AD0000;">when</span> <span class="er" style="color: #AD0000;">receiving</span> <span class="er" style="color: #AD0000;">focus</span> <span class="er" style="color: #AD0000;">requests</span></span>
<span id="cb16-3">    <span class="st" style="color: #20794D;">"liveshare.focusBehavior"</span><span class="er" style="color: #AD0000;">:</span> <span class="st" style="color: #20794D;">"prompt"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb16-4">    <span class="er" style="color: #AD0000;">//</span> <span class="er" style="color: #AD0000;">R</span><span class="fu" style="color: #4758AB;">:</span> <span class="er" style="color: #AD0000;">Treat`names.like.this`</span> <span class="er" style="color: #AD0000;">as</span> <span class="er" style="color: #AD0000;">one</span> <span class="er" style="color: #AD0000;">word</span> <span class="er" style="color: #AD0000;">for</span> <span class="er" style="color: #AD0000;">selection</span></span>
<span id="cb16-5">    <span class="st" style="color: #20794D;">"[r]"</span><span class="er" style="color: #AD0000;">:</span> <span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb16-6">        <span class="dt" style="color: #AD0000;">"editor.wordSeparators"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"`~!@#%$^&amp;*()-=+[{]}</span><span class="ch" style="color: #20794D;">\\</span><span class="st" style="color: #20794D;">|;:'</span><span class="ch" style="color: #20794D;">\"</span><span class="st" style="color: #20794D;">,&lt;&gt;/?"</span></span>
<span id="cb16-7">    <span class="fu" style="color: #4758AB;">},</span></span>
<span id="cb16-8">    <span class="er" style="color: #AD0000;">//</span> <span class="er" style="color: #AD0000;">R</span><span class="fu" style="color: #4758AB;">:</span> <span class="er" style="color: #AD0000;">Use</span> <span class="er" style="color: #AD0000;">active</span> <span class="er" style="color: #AD0000;">terminal</span> <span class="er" style="color: #AD0000;">for</span> <span class="er" style="color: #AD0000;">all</span> <span class="er" style="color: #AD0000;">commands</span></span>
<span id="cb16-9">    <span class="st" style="color: #20794D;">"r.alwaysUseActiveTerminal"</span><span class="er" style="color: #AD0000;">:</span> <span class="kw" style="color: #00769E;">true</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb16-10">    <span class="er" style="color: #AD0000;">//</span> <span class="er" style="color: #AD0000;">R</span><span class="fu" style="color: #4758AB;">:</span> <span class="er" style="color: #AD0000;">Use</span> <span class="er" style="color: #AD0000;">bracketed</span> <span class="er" style="color: #AD0000;">paste</span> <span class="er" style="color: #AD0000;">mode</span> <span class="er" style="color: #AD0000;">when</span> <span class="er" style="color: #AD0000;">sending</span> <span class="er" style="color: #AD0000;">code</span> <span class="er" style="color: #AD0000;">to</span> <span class="er" style="color: #AD0000;">console</span> <span class="er" style="color: #AD0000;">(radian)</span></span>
<span id="cb16-11">    <span class="st" style="color: #20794D;">"r.bracketedPaste"</span><span class="er" style="color: #AD0000;">:</span> <span class="kw" style="color: #00769E;">true</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb16-12">    <span class="er" style="color: #AD0000;">//</span> <span class="er" style="color: #AD0000;">R</span><span class="fu" style="color: #4758AB;">:</span> <span class="er" style="color: #AD0000;">R</span> <span class="er" style="color: #AD0000;">or</span> <span class="er" style="color: #AD0000;">radian</span> <span class="er" style="color: #AD0000;">path</span> <span class="er" style="color: #AD0000;">for</span> <span class="er" style="color: #AD0000;">macOS</span></span>
<span id="cb16-13">    <span class="st" style="color: #20794D;">"r.rterm.mac"</span><span class="er" style="color: #AD0000;">:</span> <span class="st" style="color: #20794D;">"/usr/local/Caskroom/miniforge/base/envs/r-console/bin/radian"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb16-14">    <span class="er" style="color: #AD0000;">//</span> <span class="er" style="color: #AD0000;">R</span><span class="fu" style="color: #4758AB;">:</span> <span class="er" style="color: #AD0000;">Enable</span> <span class="er" style="color: #AD0000;">R</span> <span class="er" style="color: #AD0000;">session</span> <span class="er" style="color: #AD0000;">watcher</span> <span class="er" style="color: #AD0000;">(experimental)</span></span>
<span id="cb16-15">    <span class="st" style="color: #20794D;">"r.sessionWatcher"</span><span class="er" style="color: #AD0000;">:</span> <span class="kw" style="color: #00769E;">true</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb16-16">    <span class="er" style="color: #AD0000;">//</span> <span class="er" style="color: #AD0000;">R</span><span class="fu" style="color: #4758AB;">:</span> <span class="er" style="color: #AD0000;">Remove</span> <span class="er" style="color: #AD0000;">hidden</span> <span class="er" style="color: #AD0000;">items</span> <span class="er" style="color: #AD0000;">when</span> <span class="er" style="color: #AD0000;">clearing</span> <span class="er" style="color: #AD0000;">R</span> <span class="er" style="color: #AD0000;">workspace</span></span>
<span id="cb16-17">    <span class="st" style="color: #20794D;">"r.workspaceViewer.removeHiddenItems"</span><span class="er" style="color: #AD0000;">:</span> <span class="kw" style="color: #00769E;">true</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb16-18">    <span class="er" style="color: #AD0000;">//</span> <span class="er" style="color: #AD0000;">Telemetry</span><span class="fu" style="color: #4758AB;">:</span> <span class="er" style="color: #AD0000;">Disable</span> <span class="er" style="color: #AD0000;">Microsoft</span> <span class="er" style="color: #AD0000;">crash</span> <span class="er" style="color: #AD0000;">reporter</span></span>
<span id="cb16-19">    <span class="st" style="color: #20794D;">"telemetry.enableCrashReporter"</span><span class="er" style="color: #AD0000;">:</span> <span class="kw" style="color: #00769E;">false</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb16-20">    <span class="er" style="color: #AD0000;">//</span> <span class="er" style="color: #AD0000;">Telemetry</span><span class="fu" style="color: #4758AB;">:</span> <span class="er" style="color: #AD0000;">Disable</span> <span class="er" style="color: #AD0000;">Microsoft</span> <span class="er" style="color: #AD0000;">telemetry</span></span>
<span id="cb16-21">    <span class="st" style="color: #20794D;">"telemetry.enableTelemetry"</span><span class="er" style="color: #AD0000;">:</span> <span class="kw" style="color: #00769E;">false</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb16-22">    <span class="er" style="color: #AD0000;">//</span> <span class="er" style="color: #AD0000;">Terminal</span><span class="fu" style="color: #4758AB;">:</span> <span class="er" style="color: #AD0000;">Path</span> <span class="er" style="color: #AD0000;">to</span> <span class="er" style="color: #AD0000;">integrated</span> <span class="er" style="color: #AD0000;">shell</span> <span class="er" style="color: #AD0000;">on</span> <span class="er" style="color: #AD0000;">macOS</span></span>
<span id="cb16-23">    <span class="st" style="color: #20794D;">"terminal.integrated.shell.osx"</span><span class="er" style="color: #AD0000;">:</span> <span class="st" style="color: #20794D;">"/bin/zsh"</span></span>
<span id="cb16-24"><span class="fu" style="color: #4758AB;">}</span></span></code></pre></div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>r.rterm.mac</code> field above should be the path to <code>radian</code> if you followed the <code>radian</code> installation instructions above, otherwise it should be the path to your <code>R</code> executable (if you don’t know it, type <code>which R</code> in your terminal). Since we use Homebrew to install the latest <code>zsh</code> using <code>brew install zsh</code>, the path to our <code>zsh</code> is <code>/usr/local/bin/zsh</code>, but we have put <code>/bin/zsh</code> above since that is the default <code>zsh</code> location for most macOS users. You should run <code>which r</code> and <code>which zsh</code> to confirm your local settings are correct.</p>
</div>
</div>
<ol type="1">
<li>Below are some useful <a href="https://github.com/Ikuyadeu/vscode-R/wiki/Keyboard-shortcuts">keyboard shortcuts</a> for <code>keybindings.json</code>, found by using the Command Palette (<code>Shift-Command-P</code>) in VS Code and navigating to <code>Preferences: Open Keyboard Shortcuts (JSON)</code>. This is our <a href="https://github.com/gvelasq/dotfiles/blob/master/vscode/keybindings.json"><code>keybindings.json</code></a>:</li>
</ol>
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb17-1"><span class="ot" style="color: #00769E;">[</span></span>
<span id="cb17-2">    <span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb17-3">        <span class="dt" style="color: #AD0000;">"description"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"View: Show R Workspace"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-4">        <span class="dt" style="color: #AD0000;">"key"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"alt+r"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-5">        <span class="dt" style="color: #AD0000;">"command"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"workbench.view.extension.workspaceViewer"</span></span>
<span id="cb17-6">    <span class="fu" style="color: #4758AB;">}</span><span class="ot" style="color: #00769E;">,</span></span>
<span id="cb17-7">    <span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb17-8">        <span class="dt" style="color: #AD0000;">"description"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"R: Create R Terminal"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-9">        <span class="dt" style="color: #AD0000;">"key"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"alt+`"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-10">        <span class="dt" style="color: #AD0000;">"command"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"r.createRTerm"</span></span>
<span id="cb17-11">    <span class="fu" style="color: #4758AB;">}</span><span class="ot" style="color: #00769E;">,</span></span>
<span id="cb17-12">    <span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb17-13">        <span class="dt" style="color: #AD0000;">"description"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"R: Insert Assignment Operator"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-14">        <span class="dt" style="color: #AD0000;">"key"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"alt+-"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-15">        <span class="dt" style="color: #AD0000;">"command"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"type"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-16">        <span class="dt" style="color: #AD0000;">"when"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"editorLangId == r || editorLangId == rmd &amp;&amp; editorTextFocus"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-17">        <span class="dt" style="color: #AD0000;">"args"</span><span class="fu" style="color: #4758AB;">:</span> <span class="fu" style="color: #4758AB;">{</span> <span class="dt" style="color: #AD0000;">"text"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">" &lt;- "</span> <span class="fu" style="color: #4758AB;">}</span></span>
<span id="cb17-18">    <span class="fu" style="color: #4758AB;">}</span><span class="ot" style="color: #00769E;">,</span></span>
<span id="cb17-19">    <span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb17-20">        <span class="dt" style="color: #AD0000;">"description"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"R: Insert Pipe Operator"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-21">        <span class="dt" style="color: #AD0000;">"key"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"shift+cmd+m"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-22">        <span class="dt" style="color: #AD0000;">"command"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"type"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-23">        <span class="dt" style="color: #AD0000;">"when"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"editorLangId == r || editorLangId == rmd &amp;&amp; editorTextFocus"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-24">        <span class="dt" style="color: #AD0000;">"args"</span><span class="fu" style="color: #4758AB;">:</span> <span class="fu" style="color: #4758AB;">{</span> <span class="dt" style="color: #AD0000;">"text"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">" %&gt;% "</span> <span class="fu" style="color: #4758AB;">}</span></span>
<span id="cb17-25">    <span class="fu" style="color: #4758AB;">}</span><span class="ot" style="color: #00769E;">,</span></span>
<span id="cb17-26">    <span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb17-27">        <span class="dt" style="color: #AD0000;">"description"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"R: Insert Assignment Pipe Operator"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-28">        <span class="dt" style="color: #AD0000;">"key"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"shift+cmd+,"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-29">        <span class="dt" style="color: #AD0000;">"command"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"type"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-30">        <span class="dt" style="color: #AD0000;">"when"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"editorLangId == r || editorLangId == rmd &amp;&amp; editorTextFocus"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-31">        <span class="dt" style="color: #AD0000;">"args"</span><span class="fu" style="color: #4758AB;">:</span> <span class="fu" style="color: #4758AB;">{</span> <span class="dt" style="color: #AD0000;">"text"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">" %&lt;&gt;% "</span> <span class="fu" style="color: #4758AB;">}</span></span>
<span id="cb17-32">    <span class="fu" style="color: #4758AB;">}</span><span class="ot" style="color: #00769E;">,</span></span>
<span id="cb17-33">    <span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb17-34">        <span class="dt" style="color: #AD0000;">"description"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"R: Insert Tee Pipe Operator"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-35">        <span class="dt" style="color: #AD0000;">"key"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"shift+cmd+."</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-36">        <span class="dt" style="color: #AD0000;">"command"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"type"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-37">        <span class="dt" style="color: #AD0000;">"when"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"editorLangId == r || editorLangId == rmd &amp;&amp; editorTextFocus"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-38">        <span class="dt" style="color: #AD0000;">"args"</span><span class="fu" style="color: #4758AB;">:</span> <span class="fu" style="color: #4758AB;">{</span> <span class="dt" style="color: #AD0000;">"text"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">" %T&gt;% "</span> <span class="fu" style="color: #4758AB;">}</span></span>
<span id="cb17-39">    <span class="fu" style="color: #4758AB;">}</span><span class="ot" style="color: #00769E;">,</span></span>
<span id="cb17-40">    <span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb17-41">        <span class="dt" style="color: #AD0000;">"description"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"R: Test Package"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-42">        <span class="dt" style="color: #AD0000;">"key"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"shift+cmd+8"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-43">        <span class="dt" style="color: #AD0000;">"command"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"r.test"</span></span>
<span id="cb17-44">    <span class="fu" style="color: #4758AB;">}</span><span class="ot" style="color: #00769E;">,</span></span>
<span id="cb17-45">    <span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb17-46">        <span class="dt" style="color: #AD0000;">"description"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"R: Document"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-47">        <span class="dt" style="color: #AD0000;">"key"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"shift+cmd+9"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-48">        <span class="dt" style="color: #AD0000;">"command"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"r.document"</span></span>
<span id="cb17-49">    <span class="fu" style="color: #4758AB;">}</span><span class="ot" style="color: #00769E;">,</span></span>
<span id="cb17-50">    <span class="fu" style="color: #4758AB;">{</span></span>
<span id="cb17-51">        <span class="dt" style="color: #AD0000;">"description"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"R: Load All"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-52">        <span class="dt" style="color: #AD0000;">"key"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"shift+cmd+0"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-53">        <span class="dt" style="color: #AD0000;">"command"</span><span class="fu" style="color: #4758AB;">:</span> <span class="st" style="color: #20794D;">"r.loadAll"</span><span class="fu" style="color: #4758AB;">,</span></span>
<span id="cb17-54">    <span class="fu" style="color: #4758AB;">}</span></span>
<span id="cb17-55"><span class="ot" style="color: #00769E;">]</span></span></code></pre></div>
</section>
<section id="writing-an-r-package-using-vs-code" class="level2">
<h2 class="anchored" data-anchor-id="writing-an-r-package-using-vs-code">Writing an R Package using VS Code</h2>
<p>In this section we’re going to set up a toy R package in VS Code, and in the next section we will enable Live Share.</p>
<ol type="1">
<li><p>Open VS Code and use the Command Palette (<code>Shift-Command-P</code>) to navigate to <code>R: Create R Terminal</code>, or use the suggested keyboard shortcut above (<code>Option-`</code>). Note that if you have an editor open and the focus is on the editor, for the shortcut to work you may first need to use <code>Control-`</code> for <code>View: Toggle Integrated Terminal</code> followed by <code>Option-`</code> for <code>R: Create R Terminal</code>. If our configuration above worked for you, these commands should open a terminal instance with the <code>radian</code> console, and the title of the terminal should be <code>1: R Interactive</code> (or <code>2: R Interactive</code> if it’s the second active terminal).</p></li>
<li><p>In the VS Code R console, create a {mutagen} package folder on your Desktop, declare dependencies, and start an R script for a new function <code>cast_integers()</code>:</p></li>
</ol>
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;">library</span>(usethis)</span>
<span id="cb18-2"><span class="fu" style="color: #4758AB;">create_package</span>(<span class="st" style="color: #20794D;">"~/Desktop/mutagen"</span>)</span>
<span id="cb18-3">deps <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"dplyr"</span>, <span class="st" style="color: #20794D;">"purrr"</span>, <span class="st" style="color: #20794D;">"tibble"</span>, <span class="st" style="color: #20794D;">"vctrs"</span>)</span>
<span id="cb18-4">purrr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">walk</span>(deps, use_package)</span>
<span id="cb18-5"><span class="fu" style="color: #4758AB;">use_r</span>(<span class="st" style="color: #20794D;">"cast_integers"</span>)</span></code></pre></div>
<ol type="1">
<li><p>In VS Code, open the {mutagen} folder using File &gt; Open… (<code>Command-O</code>) and selecting the <code>mutagen</code> folder in the Desktop. This will open a new VS Code instance and the title bar will read <code>Welcome — mutagen</code>. The R extension icon will be visible on the sidebar since VS Code will detect the <code>.R</code> file in the folder.</p></li>
<li><p>Use the Explorer icon in the sidebar (<code>Shift-Command-E</code>) and open the <code>cast_integers.R</code> file. Paste the following code into the editor and save the file:</p></li>
</ol>
<div class="sourceCode" id="cb19" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><span class="co" style="color: #5E5E5E;">#' Safely cast numeric columns to integers</span></span>
<span id="cb19-2"><span class="co" style="color: #5E5E5E;">#'</span></span>
<span id="cb19-3"><span class="co" style="color: #5E5E5E;">#' `cast_integers()` casts all eligible numeric columns in a data frame to integers, without data loss, using `vctrs::vec_cast()` for coercion.</span></span>
<span id="cb19-4"><span class="co" style="color: #5E5E5E;">#' @param .data A data frame</span></span>
<span id="cb19-5"><span class="co" style="color: #5E5E5E;">#' @return A tibble. If the input data frame has rownames, these will be preserved in a new rowname column.</span></span>
<span id="cb19-6"><span class="co" style="color: #5E5E5E;">#' @examples (mtcars_integerized &lt;- cast_integers(mtcars))</span></span>
<span id="cb19-7"><span class="co" style="color: #5E5E5E;">#' @export</span></span>
<span id="cb19-8">cast_integers <span class="ot" style="color: #00769E;">&lt;-</span> <span class="cf" style="color: #00769E;">function</span>(.data) {</span>
<span id="cb19-9">    <span class="fu" style="color: #4758AB;">stopifnot</span>(<span class="fu" style="color: #4758AB;">is.data.frame</span>(.data))</span>
<span id="cb19-10">    .data <span class="ot" style="color: #00769E;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">rownames_to_column</span>(.data)</span>
<span id="cb19-11">    .data <span class="ot" style="color: #00769E;">&lt;-</span> tibble<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">as_tibble</span>(.data)</span>
<span id="cb19-12">    int_index <span class="ot" style="color: #00769E;">&lt;-</span> purrr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">map_lgl</span>(</span>
<span id="cb19-13">        .data,</span>
<span id="cb19-14">        <span class="sc" style="color: #5E5E5E;">~</span> <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">inherits</span>(<span class="fu" style="color: #4758AB;">try</span>(vctrs<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">vec_cast</span>(.x, <span class="at" style="color: #677623;">to =</span> <span class="fu" style="color: #4758AB;">integer</span>()), <span class="at" style="color: #677623;">silent =</span> <span class="cn" style="color: #8f5902;">TRUE</span>), <span class="st" style="color: #20794D;">"try-error"</span>)</span>
<span id="cb19-15">    )</span>
<span id="cb19-16">    .data <span class="ot" style="color: #00769E;">&lt;-</span> dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">mutate</span>(</span>
<span id="cb19-17">        .data,</span>
<span id="cb19-18">        dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">across</span>(</span>
<span id="cb19-19">            <span class="at" style="color: #677623;">.cols =</span> <span class="fu" style="color: #4758AB;">any_of</span>(<span class="fu" style="color: #4758AB;">names</span>(<span class="fu" style="color: #4758AB;">which</span>(int_index))),</span>
<span id="cb19-20">            <span class="at" style="color: #677623;">.fns =</span> <span class="sc" style="color: #5E5E5E;">~</span> vctrs<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">vec_cast</span>(.x, <span class="at" style="color: #677623;">to =</span> <span class="fu" style="color: #4758AB;">integer</span>())</span>
<span id="cb19-21">        )</span>
<span id="cb19-22">    )</span>
<span id="cb19-23">    <span class="fu" style="color: #4758AB;">return</span>(.data)</span>
<span id="cb19-24">}</span></code></pre></div>
<ol type="1">
<li>Now create a new R console in VS Code using either the keyboard shortcuts (<code>Control-`</code> to toggle the terminal and <code>Option-`</code> to create an R console) or by opening the Command Palette (<code>Shift-Command-P</code>) and navigating to <code>R: Create R Terminal</code>. Focus your view on the R extension by clicking R the sidebar (<code>Option-R</code>), and now test out the package. Below are a series of R console commands to familiarize you with the package development workflow in VS Code. We will load the package, document it, and create a new object in the R workspace that uses the new function we just loaded onto the package environment. To get familiar with the VS Code user interface, we will also print the object in the console, view it with the data viewer, and check out the help file for our new function.</li>
</ol>
<div class="sourceCode" id="cb20" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><span class="fu" style="color: #4758AB;">library</span>(dplyr)</span>
<span id="cb20-2">devtools<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">load_all</span>() <span class="co" style="color: #5E5E5E;"># or Shift-Command-0 using keyboard shortcuts above</span></span>
<span id="cb20-3">devtools<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">document</span>() <span class="co" style="color: #5E5E5E;"># or Shift-Command-9 using keyboard shortcuts above</span></span>
<span id="cb20-4">mtcars_integerized <span class="ot" style="color: #00769E;">&lt;-</span> mtcars <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="fu" style="color: #4758AB;">cast_integers</span>()</span>
<span id="cb20-5">mtcars_integerized</span>
<span id="cb20-6"><span class="fu" style="color: #4758AB;">View</span>(mtcars_integerized)</span>
<span id="cb20-7">?cast_integers</span></code></pre></div>
</section>
<section id="live-share-tutorial" class="level2">
<h2 class="anchored" data-anchor-id="live-share-tutorial">Live share tutorial</h2>
<p>Now that we’ve started writing our R package in VS Code, it’s time to Live Share! Microsoft has a handy walkthrough <a href="https://docs.microsoft.com/en-us/visualstudio/liveshare/use/vscode">here</a>, but we will explain what we did and detail R project idiosyncrasies that we found.</p>
<p>In order to host a Live Share collaboration session, first you’ll need to sign into Visual Studio Live Share. Click on the <code>Live Share</code> status bar item or press <code>Shift-Command-P</code> and navigate to <code>Live Share: Sign In With Browser</code>. A notification will appear asking you to sign into either a Microsoft or GitHub account using your default web browser.</p>
<p>Once you are signed in, open a folder or file for pair programming. For package development, this would be the project folder for the package (e.g., the {mutagen} folder we created above). Click the <code>Live Share</code> status bar item or type <code>Shift-Command-P</code> and navigate to <code>Live Share: Start Collaboration Session (Share)</code>. An invite link will be copied automatically to your clipboard. You can send this link to your collaborator(s) and allow them to join a new session that shares the contents of the folder. Once a collaborator clicks the link, a notification will prompt you to approve the guest before they can join. Please note that guests do not necessarily need to be signed into to collaborate using Live Share, since anonymous guests are allowed; however, the host will need to be signed in. In fact, <a href="https://docs.microsoft.com/en-us/visualstudio/liveshare/quickstart/browser-join">guests don’t even need to have VS Code installed and can join Live Share from a browser</a>!</p>
<p>Once a guest has joined a collaboration session, all collaborators will immediately be able to see each other’s cursors, edits, and selections in real-time. You can pick a file from the Explorer (<code>Shift-Command-E</code>) and start editing. Both hosts and guests will see edits as they are made.</p>
<p>As we worked on {mutagen} files, we noticed the usual loading of a package in development, via <code>devtools::load_all()</code>, or sourcing an entire file using <code>Shift-Command-S</code> (the VS Code version of RStudio’s <code>Shift-Command-Enter</code>), will not work for the guest. Why? Because the path to the folder directory is different for the host and guest. In our example, instead of the host’s path <code>~/Desktop/mutagen/R/cast_integers.R</code>, the guest’s path was an abbreviated <code>/R/cast_integers.R</code>, which led to errors when loading and sourcing from keyboard shortcuts. However, the guest can still run the code themselves (such as by selecting and running the source code in an R script, or using <code>Command-Enter</code> line by line) as long as they do not try to source the entire package. We did not try to abstract the path-generating rules for the guests’ Live Share instance into new keyboard shortcuts, but this seems like a solvable problem to allow guests to run <code>devtools::load_all()</code> or <code>source()</code> with minor modifications. Another gotcha was the R workspace; we tried to toggle the setting <code>"liveshare.publishWorkspaceInfo": true</code> in <code>settings.json</code>, but it did not let us share the R workspace between host and guest. It appears that for now host and guest(s) can only maintain separate R workspaces, though it would be useful to have the option to share the R s and its objects.</p>
</section>
<section id="final-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-thoughts">Final thoughts</h2>
<p>We’re excited for the future of R programming in VS Code. Live Share is an outstanding innovation for collaborative real-time editing, and is only one of the many amazing features in VS Code. Here we have only scratched the surface of use cases for Live Share. Microsoft keeps a running list of <a href="https://docs.microsoft.com/en-us/visualstudio/liveshare/reference/use-cases">many other Live Share use cases</a>.</p>
<p>We are also huge fans of RStudio and the RStudio IDE. On our wish list for RStudio is that a live collaboration feature be supported in future versions of RStudio Desktop (not only the Pro version) and RStudio Cloud. Having many excellent options is a good thing! In the meantime, it is clear that VS Code is maturing into a capable IDE for R. Live Share is an attractive and free feature that enables real-time collaboration for the masses and that we hope others will enjoy as much as we have.</p>
<center>
<p><em>Liked this post? I’d love for you to retweet!</em></p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
🎉📢🎉 Collaborating in <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a>? Git got you down? Want to code with others remotely, in real-time, and for free (à la Google Docs)? Check out how to set up and use <a href="https://twitter.com/code?ref_src=twsrc%5Etfw"><span class="citation" data-cites="code">@code</span></a> (<a href="https://twitter.com/hashtag/vscode?src=hash&amp;ref_src=twsrc%5Etfw">#vscode</a>) and <a href="https://twitter.com/hashtag/vsliveshare?src=hash&amp;ref_src=twsrc%5Etfw">#vsliveshare</a> for remote <a href="https://twitter.com/hashtag/pairprogramming?src=hash&amp;ref_src=twsrc%5Etfw">#pairprogramming</a> 🤝 in R! 🤯. Tutorial here: <a href="https://t.co/Qbrw71V77Z">https://t.co/Qbrw71V77Z</a> <a href="https://t.co/3sy9hAJea7">pic.twitter.com/3sy9hAJea7</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1357136366568689664?ref_src=twsrc%5Etfw">February 4, 2021</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>programming</category>
  <guid>https://ivelasq.rbind.io/blog/vscode-live-share/index.html</guid>
  <pubDate>Wed, 03 Feb 2021 06:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/vscode-live-share/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Browse and search liked Tweets using R</title>
  <link>https://ivelasq.rbind.io/blog/get-tweet-likes/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/get-tweet-likes/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Abstract blue and white birds repeating on against a white and blue background"></p>
<p></p><p></p>
</figure>
</div>
<p>The other day, I was scrolling through my “liked” Tweets and got maybe 100 deep when I accidentally clicked a hyperlink and had to restart scrolling from the beginning. The experience made me so frustrated that I started looking up easier ways of perusing one’s likes. I found <a href="https://medium.com/@xoelop/how-to-browse-and-search-your-liked-tweets-711fc1b70851">this tutorial</a> that walked through how to pull liked Tweets into a CSV using Python - so I decided to give it a shot using R.</p>
<section id="set-up-your-project" class="level2">
<h2 class="anchored" data-anchor-id="set-up-your-project">Set up your project</h2>
<p>For this tutorial, I set up a project with the following structure. I walk through how to create <code>like.js</code> and <code>like_csv.csv</code> in the walkthrough.</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode md code-with-copy"><code class="sourceCode markdown"><span id="cb1-1">+-- code.R</span>
<span id="cb1-2">+-- data</span>
<span id="cb1-3">|   +-- like.js</span>
<span id="cb1-4">+-- output</span>
<span id="cb1-5">|   +-- likes_csv.csv</span></code></pre></div>
</section>
<section id="getting-liked-tweets" class="level2">
<h2 class="anchored" data-anchor-id="getting-liked-tweets">Getting liked Tweets</h2>
<section id="step-1-download-your-twitter-archive" class="level3">
<h3 class="anchored" data-anchor-id="step-1-download-your-twitter-archive">Step 1: Download your Twitter archive</h3>
<p>Like the Python tutorial, you have to first download your Twitter archive. Go to https://twitter.com/settings/your_twitter_data, enter your password, and “Download Archive”. You will get an email when you can download your data - for me, it took a day.</p>
<p>Once downloaded, open the ZIP file. Save the <code>like.js</code> file in your project’s <code>data</code> folder.</p>
</section>
<section id="step-2-load-the-js-file-and-convert-it-to-a-data-frame" class="level3">
<h3 class="anchored" data-anchor-id="step-2-load-the-js-file-and-convert-it-to-a-data-frame">Step 2: Load the JS file and convert it to a data frame</h3>
<p>Now, start an <code>R</code> script (I called mine <code>code.R</code>). Install (if you haven’t already) and load all the packages.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;">library</span>(rjson)</span>
<span id="cb2-3"><span class="fu" style="color: #4758AB;">library</span>(rtweet)</span></code></pre></div>
</div>
<p>The <code>like.js</code> file is a Javascript file. To convert it to a data frame, first convert to a JSON file by removing the text that makes it Javascript, read in the JSON, and then flatten into a data frame using <code>purrr::flatten_df</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1">js <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">read_file</span>(here<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"data"</span>, <span class="st" style="color: #20794D;">"like.js"</span>))</span>
<span id="cb3-2">json <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">sub</span>(<span class="st" style="color: #20794D;">"window.YTD.like.part0 = "</span>, <span class="st" style="color: #20794D;">""</span>, js)</span>
<span id="cb3-3"> </span>
<span id="cb3-4">likes_raw <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;">fromJSON</span>(json)</span>
<span id="cb3-6"></span>
<span id="cb3-7">likes_df <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb3-8">  likes_raw <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;">flatten_df</span>()</span></code></pre></div>
</div>
<p>Now your likes, their status IDs, and URLs are stored in <code>likes_df</code>.</p>
</section>
<section id="step-3-authenticate-rtweet-and-get-tweet-info" class="level3">
<h3 class="anchored" data-anchor-id="step-3-authenticate-rtweet-and-get-tweet-info">Step 3: Authenticate {rtweet} and get tweet info</h3>
<p>To get the Tweet info, you have to authenticate your Twitter account and get the API keys. Go to your <a href="https://developer.twitter.com/en/portal/projects-and-apps">Twitter Developer Portal</a> to do this. The {rtweet} vignette <a href="https://cran.r-project.org/web/packages/rtweet/vignettes/auth.html">here</a> covers what to do pretty well, but one thing I noticed is now you have to enable “3-legged OAuth” and there, you can add the Callback URL of <code>http://127.0.0.1:1410</code> (otherwise you will get a 401 error when running the code below).</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1">token <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;">create_token</span>(</span>
<span id="cb4-3">    <span class="at" style="color: #677623;">consumer_key =</span> <span class="st" style="color: #20794D;">"PUT API KEY IN QUOTES HERE"</span>,</span>
<span id="cb4-4">    <span class="at" style="color: #677623;">consumer_secret =</span> <span class="st" style="color: #20794D;">"PUT API KEY SECRET IN QUOTES HERE"</span></span>
<span id="cb4-5">  )</span></code></pre></div>
</div>
<p>Once your <code>token</code> is saved, you can use <code>rtweet::lookup_statuses</code> to get the Tweet info.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1">likes_dat <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;">lookup_statuses</span>(likes_df<span class="sc" style="color: #5E5E5E;">$</span>tweetId)</span></code></pre></div>
</div>
<p>There you have it! All your likes and their information are saved in the <code>likes_dat</code> data frame. Here, you can do all of your usual data manipulations - <code>lookup_statuses()</code> results in a LOT of data, so I recommend narrowing it down to the columns you care about using <code>select()</code>.</p>
</section>
<section id="step-4-save-to-a-csv" class="level3">
<h3 class="anchored" data-anchor-id="step-4-save-to-a-csv">Step 4: Save to a CSV</h3>
<p>Saving to a CSV is a bit tricky because <code>lookup_statuses()</code> creates list-columns, which cannot be exported to a CSV.</p>
<p>Here, I’ve selected only the columns <code>status_id</code>, <code>text</code>, and <code>hashtags</code> to look at. <code>hashtags</code> is a list-column because one Tweet may have multiple hashtags, which is then saved as a vector within the column <code>hashtags</code>. To convert it to a data frame, I use <code>unnest()</code>. This creates a data frame with multiple entries for each Tweet, one for each hashtag.</p>
<p>That is too long for me since I want to quickly look through my likes. I then create a hashtag ID for each tweet by grouping by the <code>status_id</code> and assigning each of its hashtags an ID using <code>row_number()</code> and then using <code>pivot_wider()</code> to move each hashtag into its own column.</p>
<p>You will see that some tweets have blank entries while some tweets have many!</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1">likes_csv <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb6-2">  likes_dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;">select</span>(status_id, text, hashtags) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;">unnest</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-5">  <span class="fu" style="color: #4758AB;">group_by</span>(status_id) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">id =</span> <span class="fu" style="color: #4758AB;">row_number</span>()) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-7">  <span class="fu" style="color: #4758AB;">pivot_wider</span>(<span class="at" style="color: #677623;">names_prefix =</span> <span class="st" style="color: #20794D;">"hashtag_"</span>,</span>
<span id="cb6-8">              <span class="at" style="color: #677623;">names_from =</span> id,</span>
<span id="cb6-9">              <span class="at" style="color: #677623;">values_from =</span> hashtags)</span></code></pre></div>
</div>
<p>Now, this is savable in a CSV. You can run the code below if your project has an <code>output</code> folder.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;">write_csv</span>(likes_csv, here<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"output"</span>, <span class="st" style="color: #20794D;">"likes_csv.csv"</span>))</span></code></pre></div>
</div>
<p>Thank you for reading this quick entry in looking through your Twitter likes. I hope this reduces the amount of annoying scrolling you need to do to look through your Tweets! I think there are a lot of opportunities to make this an even easier process - maybe a Shiny app? - but hopefully, this is a good starting point.</p>
<center>
<em>Liked this post? I’d love for you to retweet!</em>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
Are you, too, constantly frustrated there's no way to easily look through your liked Tweets on Twitter? 🐦 😤 You can save all of your liked tweets into a CSV using R and {rtweet}! Quick tutorial here: <a href="https://t.co/etoOaczTwa">https://t.co/etoOaczTwa</a> <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1326550008548585472?ref_src=twsrc%5Etfw">November 11, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
</section>
 ]]></description>
  <guid>https://ivelasq.rbind.io/blog/get-tweet-likes/index.html</guid>
  <pubDate>Tue, 10 Nov 2020 06:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/get-tweet-likes/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>An even easier-to-use R package for school district shapefiles</title>
  <link>https://ivelasq.rbind.io/blog/leaidr2/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/leaidr2/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Abstract painting of black rectangles on a yellow background"></p>
<p></p><p></p>
</figure>
</div>
<section id="an-update-to-leaidr" class="level2">
<h2 class="anchored" data-anchor-id="an-update-to-leaidr">An update to leaidr</h2>
<p>A few months ago, I created <a href="https://github.com/ivelasq/leaidr">{leaidr}</a> for easier download of U.S. school district shapefiles. <a href="https://github.com/datalorax">Daniel Anderson</a> went through and greatly improved the package, making it even easier to download and use the shapefiles (thanks Dan!).</p>
<p>Now, instead of having to run <code>lea_prep()</code>, you can download the shapefiles from Dan’s Github repository like so:</p>
<div class="cell" data-layout-align="center" data-hash="index_cache/html/unnamed-chunk-2_39a8649a452d2d0a34547b5043cdf2e4">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(leaidr)</span>
<span id="cb1-2"></span>
<span id="cb1-3">tn <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">lea_get</span>(<span class="st" style="color: #20794D;">"tn"</span>)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code>OGR data source with driver: ESRI Shapefile 
Source: "/private/var/folders/pj/nmg9b8_93dq4kwt8nt2d4cj40000gn/T/RtmpqlCmYd/47", layer: "47"
with 158 features
It has 18 fields</code></pre>
</div>
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1">tn <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-2">  sf<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">st_as_sf</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-3">  ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-4">  ggplot2<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">geom_sf</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/leaidr2/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" alt="Blank map of Tennessee school districts." width="672"></p>
</figure>
</div>
</div>
</div>
<p>And, if you use <code>lea_get()</code> (i.e., with <code>state = NULL</code>), you’ll get the shapefiles for the whole U.S. back via ROpenSci’s {piggyback}.</p>
<p>So much easier and better!</p>
<p>Because Dan helped make the package so great, I wanted to add on and showcase what can be done with it! So, today’s post is jam-packed with choices…</p>
<ul>
<li>Create a beautiful map in Mapbox</li>
<li>Create a Shiny app with your beautiful map</li>
<li>Add a Shiny app to a package</li>
</ul>
</section>
<section id="create-a-beautiful-map-in-mapbox" class="level2">
<h2 class="anchored" data-anchor-id="create-a-beautiful-map-in-mapbox">Create a beautiful map in Mapbox</h2>
<p>Asmae Toumi wrote a <a href="https://asmae-toumi.netlify.app/posts/2020-08-10-how-to-make-web-ready-us-county-level-maps/">blog post</a> on how to make maps using R and Mapbox. So, I figured: why not announce the new and improved {leaidr} functions to create a beautiful Mapbox map??</p>
<p>This walkthrough will go a little deeper with Mapbox, as I am an extreme beginner and had to do a lot of investigating to figure out how to use it.</p>
<p>I suggest first reading through Asmae’s tutorial as there are a few things you need to do before being able to run the below: download the {mapboxapi} package, create a Mapbox account, and install Tippecanoe.</p>
<section id="load-the-packages" class="level3">
<h3 class="anchored" data-anchor-id="load-the-packages">Load the packages</h3>
<p>Here are the packages you will need:</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb4-2"></span>
<span id="cb4-3"><span class="co" style="color: #5E5E5E;"># remotes::install_github("walkerke/mapboxapi")</span></span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;">library</span>(mapboxapi)</span>
<span id="cb4-5"></span>
<span id="cb4-6"><span class="co" style="color: #5E5E5E;"># if you haven't installed the package yet</span></span>
<span id="cb4-7"><span class="co" style="color: #5E5E5E;"># devtools::install_github("ivelasq/leaidr")</span></span>
<span id="cb4-8"><span class="fu" style="color: #4758AB;">library</span>(leaidr)</span>
<span id="cb4-9"></span>
<span id="cb4-10"><span class="fu" style="color: #4758AB;">library</span>(rmapshaper)</span>
<span id="cb4-11"><span class="fu" style="color: #4758AB;">library</span>(mapdeck)</span></code></pre></div>
</div>
</section>
<section id="download-the-data" class="level3">
<h3 class="anchored" data-anchor-id="download-the-data">Download the data</h3>
<p>Download your shapefiles. If you want to make a choropleth map, also read in the data that you will append to your shapefiles and merge them by a common ID. (Sorry for using a local file!)</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1">shp <span class="ot" style="color: #00769E;">&lt;-</span> <span class="co" style="color: #5E5E5E;"># leaidr shapefiles</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;">lea_get</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"or"</span>, <span class="st" style="color: #20794D;">"wa"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-3">  sf<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">st_as_sf</span>()</span>
<span id="cb5-4"></span>
<span id="cb5-5">dat <span class="ot" style="color: #00769E;">&lt;-</span> <span class="co" style="color: #5E5E5E;"># data to append </span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;">read_csv</span>(<span class="st" style="color: #20794D;">"/Users/shortessay/Downloads/ccd_lea_141_1819_l_1a_091019/ccd_lea_141_1819_l_1a_091019.csv"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;">filter</span>(ST <span class="sc" style="color: #5E5E5E;">%in%</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"OR"</span>, <span class="st" style="color: #20794D;">"WA"</span>))</span>
<span id="cb5-8"></span>
<span id="cb5-9">northwest <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb5-10">  shp <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;">select</span>(GEOID, geometry) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-12">  sp<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">merge</span>(dat, <span class="at" style="color: #677623;">by.x =</span> <span class="st" style="color: #20794D;">"GEOID"</span>, <span class="at" style="color: #677623;">by.y =</span> <span class="st" style="color: #20794D;">"LEAID"</span>)</span></code></pre></div>
</div>
</section>
<section id="create-the-tileset" class="level3">
<h3 class="anchored" data-anchor-id="create-the-tileset">Create the tileset</h3>
<p>Now, following the original tutorial, we use Tippecanoe to optimize the shapefiles and data and then upload the “tiles” to Mapbox.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">tippecanoe</span>(</span>
<span id="cb6-2">  <span class="at" style="color: #677623;">input =</span> northwest,</span>
<span id="cb6-3">  <span class="at" style="color: #677623;">output =</span> <span class="st" style="color: #20794D;">"nw.mbtiles"</span>,</span>
<span id="cb6-4">  <span class="at" style="color: #677623;">layer_name =</span> <span class="st" style="color: #20794D;">"northwest"</span>)</span>
<span id="cb6-5"></span>
<span id="cb6-6"><span class="fu" style="color: #4758AB;">upload_tiles</span>(<span class="at" style="color: #677623;">input =</span> <span class="st" style="color: #20794D;">"nw.mbtiles"</span>,</span>
<span id="cb6-7">             <span class="at" style="color: #677623;">username =</span> <span class="st" style="color: #20794D;">"ivelasq3"</span>, </span>
<span id="cb6-8">             <span class="at" style="color: #677623;">tileset_id =</span> <span class="st" style="color: #20794D;">"northwest"</span>,</span>
<span id="cb6-9">             <span class="at" style="color: #677623;">multipart =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span></code></pre></div>
</div>
</section>
<section id="style-the-tiles" class="level3">
<h3 class="anchored" data-anchor-id="style-the-tiles">Style the tiles</h3>
<p>This is the part that I had to figure out on the Mapbox website. <a href="https://docs.mapbox.com/help/tutorials/choropleth-studio-gl-pt-1/">This</a> walkthrough was helpful. Once you have uploaded the tiles using <code>upload_tiles()</code>, you should see them available under “Custom tileset” at the bottom of this webpage: https://studio.mapbox.com/tilesets/.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/leaidr2/1.png" class="img-fluid figure-img" alt="Screenshot of Mapbox website with Tilesets"></p>
<p></p><p></p>
</figure>
</div>
<p>Then, go to Styles on this webpage: https://studio.mapbox.com/. Click “New Style” and choose the template you want, then Customize.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/leaidr2/2.png" class="img-fluid figure-img" alt="Screenshot of Mapbox choosing a template"></p>
<p></p><p></p>
</figure>
</div>
<p>To add your tileset, go to Layers, click the Plus sign, then under “Source”, find your uploaded tileset, or add the tileset by the ID given by <code>upload_tiles()</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/leaidr2/3.png" class="img-fluid figure-img" alt="Screenshot of Mapbox layers and how to add them"></p>
<p></p><p></p>
</figure>
</div>
<p>I zoomed to where my tiles are located (Oregon and Washington) and started editing. <a href="https://docs.mapbox.com/help/tutorials/choropleth-studio-gl-pt-1/#data-driven-styling">This section of the walkthrough</a> explains how to create a choropleth map, where each geography has a different color according to a value.</p>
<p>Once done styling, I clicked “Publish” on the top right of Mapbox Studio.</p>
</section>
<section id="using-the-map-in-r" class="level3">
<h3 class="anchored" data-anchor-id="using-the-map-in-r">Using the map in R</h3>
<p>To get the information to bring it back into R and be able to use the map in a Shiny app, I clicked “Share” and scrolled to find the Style ID.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/leaidr2/4.png" class="img-fluid figure-img" alt="Screenshot of Mapbox sharing a map"></p>
<p></p><p></p>
</figure>
</div>
<p>I copied the Share URL to include in the function below. For the location parameter, I used the latitude/longitude listed in the browser URL. I played around with the zoom level until I found one I liked.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;">mapdeck</span>(<span class="at" style="color: #677623;">token =</span> <span class="fu" style="color: #4758AB;">Sys.getenv</span>(<span class="st" style="color: #20794D;">"MAPBOX_PUBLIC_TOKEN"</span>),</span>
<span id="cb7-2">        <span class="at" style="color: #677623;">style =</span> <span class="st" style="color: #20794D;">"mapbox://styles/ivelasq3/ckehhzzld3l3p19mht1n8hksj"</span>,</span>
<span id="cb7-3">        <span class="at" style="color: #677623;">zoom =</span> <span class="dv" style="color: #AD0000;">4</span>,</span>
<span id="cb7-4">        <span class="at" style="color: #677623;">location =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">120.161</span>, <span class="fl" style="color: #AD0000;">45.843</span>))</span></code></pre></div>
</div>
</section>
</section>
<section id="create-a-shiny-app-with-your-beautiful-map" class="level2">
<h2 class="anchored" data-anchor-id="create-a-shiny-app-with-your-beautiful-map">Create a Shiny app with your beautiful map</h2>
<p>Once you have the <code>mapdeck()</code> function all set up, you can use it in a Shiny app. <a href="https://github.com/greghuang8/Geovis/blob/master/shinyApp.R">Here’s</a> some reference code that I found useful for using <code>renderMapdeck()</code>. Thank you Greg Huang!</p>
<p>This is an example of a very bare-bones Shiny app. For the UI, use <code>mapdeckOutput()</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;">library</span>(shiny)</span>
<span id="cb8-3"><span class="fu" style="color: #4758AB;">library</span>(mapdeck)</span>
<span id="cb8-4"></span>
<span id="cb8-5">ui <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">fluidPage</span>(</span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;">mapdeckOutput</span>(<span class="at" style="color: #677623;">outputId =</span> <span class="st" style="color: #20794D;">"createMap"</span>)</span>
<span id="cb8-7">)</span></code></pre></div>
</div>
<p>And for the server, paste the <code>mapdeck()</code> function in <code>renderMapdeck()</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1">server <span class="ot" style="color: #00769E;">&lt;-</span> <span class="cf" style="color: #00769E;">function</span>(input, output) {</span>
<span id="cb9-2"></span>
<span id="cb9-3">  output<span class="sc" style="color: #5E5E5E;">$</span>createMap <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">renderMapdeck</span>({</span>
<span id="cb9-4">    <span class="fu" style="color: #4758AB;">mapdeck</span>(<span class="at" style="color: #677623;">token =</span> <span class="fu" style="color: #4758AB;">Sys.getenv</span>(<span class="st" style="color: #20794D;">"MAPBOX_PUBLIC_TOKEN"</span>),</span>
<span id="cb9-5">            <span class="at" style="color: #677623;">style =</span> <span class="st" style="color: #20794D;">"mapbox://styles/ivelasq3/ckehhzzld3l3p19mht1n8hksj"</span>,</span>
<span id="cb9-6">            <span class="at" style="color: #677623;">zoom =</span> <span class="dv" style="color: #AD0000;">4</span>,</span>
<span id="cb9-7">            <span class="at" style="color: #677623;">location =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="fl" style="color: #AD0000;">120.161</span>, <span class="fl" style="color: #AD0000;">45.843</span>))</span>
<span id="cb9-8">  })</span>
<span id="cb9-9">}</span></code></pre></div>
</div>
<p>I uploaded the app <a href="https://ivelasq.shinyapps.io/leaidr/">here</a>.</p>
</section>
<section id="add-a-shiny-app-to-a-package" class="level2">
<h2 class="anchored" data-anchor-id="add-a-shiny-app-to-a-package">Add a Shiny app to a package</h2>
<p>Now, say you would like to add the Shiny app to your package as well as upload it to shinyapps.io / instead of uploading to shinyapps.io. Thankfully, Dean Attali has a <a href="https://deanattali.com/2015/04/21/r-package-shiny-app/">great walkthrough</a> on how to do this!</p>
<ol type="1">
<li>Add {shiny} to your dependencies in your <code>DESCRIPTION</code> file (I do this with <code>usethis::use_package("shiny")</code>).</li>
<li>Create a folder called <code>inst</code> in your package with another folder for the Shiny example, and your UI/server file(s) within.</li>
<li>Create an R file to run your example (I used <code>usethis::use_r("runExample.R")</code>) to create this file.</li>
<li>Don’t forget to document! <code>devtools::document()</code></li>
</ol>
<p>So, if you were to install and load {leaidr}, you can run <code>leaidr::runExample()</code> to launch the Shiny app. To see what the files look like, check out the Github repo files <a href="https://github.com/ivelasq/leaidr/tree/master/inst/shiny-examples/mapbox">here</a>.</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>In conclusion, {leaidr} can help you map your data as long as you have school district LEAID’s or names in there somewhere. I hope that it helps you in your education data projects!</p>
<center>
<p><em>Liked this article? I’d love for you to retweet!</em></p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
New goodies for leaidr, an <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> pkg for school district shapefiles!<br><br>🤩 Major upgrade thx to <a href="https://twitter.com/datalorax?ref_src=twsrc%5Etfw"><span class="citation" data-cites="datalorax">@datalorax</span></a><br>📓 New docs: <a href="https://t.co/yOszd3SG7e">https://t.co/yOszd3SG7e</a><br>🗺️ Mapbox example thx to <a href="https://twitter.com/asmae_toumi?ref_src=twsrc%5Etfw"><span class="citation" data-cites="asmae_toumi">@asmae_toumi</span></a><br>🌐 Shiny app IN package thx to <a href="https://twitter.com/daattali?ref_src=twsrc%5Etfw"><span class="citation" data-cites="daattali">@daattali</span></a><br>ℹ️ Walkthrough: <a href="https://t.co/i2I121b6a3">https://t.co/i2I121b6a3</a><br><br>Happy mapping 🤓 <a href="https://t.co/4hIgJ9evoX">pic.twitter.com/4hIgJ9evoX</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1300446746955452416?ref_src=twsrc%5Etfw">August 31, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>package</category>
  <category>analysis</category>
  <guid>https://ivelasq.rbind.io/blog/leaidr2/index.html</guid>
  <pubDate>Sun, 30 Aug 2020 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/leaidr2/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Party with R: How the community enabled us to write a book</title>
  <link>https://ivelasq.rbind.io/blog/party-with-R/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/party-with-R/thumbnail-wide.jpg" class="img-fluid figure-img" alt="A dancer with a large skirt dancing at a dance hall with a crowd behind her"></p>
<p></p><p></p>
</figure>
</div>
<blockquote class="blockquote">
<p>It is like a party all the time; nobody has to worry about giving one or being invited; it is going on every day in the street and you can go down or be part of it from your window. - Eleanor Clark</p>
</blockquote>
<p>Without the R community, <a href="https://www.datascienceineducation.com/"><em>Data Science in Education Using R</em></a> would never have happened. Most evidently, we wouldn’t have met each other without the strong R presence on Twitter that sparked a conversation about data use in education. More importantly though, are the aspects of the R community that inspired that initial discussion and enabled us to complete a book for a broad and complex field.</p>
<p>In the <a href="https://datascienceineducation.com/c01.html">first chapter of our book</a>, we invite data practitioners in education to the party but the R community invited us to the party first. Like any successful party, certain elements had to exist for us to join in and end up having an amazing time.</p>
<p><strong>The Invitation</strong> 📩</p>
<p>As someone who started following the R community on Twitter after it was already well established and popular, I never felt the apprehension about having to ask how to get involved or interact with others. First, there are so many avenues. The R community offers many ways to let you in, whether it be replying to Tweets, posting a question on community.rstudio.com, or sharing a blog post on R Weekly. Second, the R community welcomes users no matter their level. Whether it is a code snippet with a function you found cool, a blog post, or a personal side project, there are ways to engage that appeal to everybody. Members of the R community can interact how they want and as often as they want.</p>
<p>For us, it was exciting to meet on Twitter, talk about collaborating on an education data project, and then just get started on it. We felt welcome and encouraged to do so. Because people in the R community meet other users virtually and begin side projects all the time, we didn’t have to worry about whether something like this was possible: The invitation was already there.</p>
<p><strong>An Open Door</strong> 🚪</p>
<p>In our first blog post, we described what it’s like to learn by seeing someone do the thing you want to learn. One of the best things about the R community is you constantly get to see this in action. The R community not only holds open principles but actually exhibits them whenever possible. Users post their code, projects, and drafts constantly. Just by scanning the #rstats hashtag, one can discover something new.</p>
<p>Because others were open, we knew that we wanted to be open as well. We wrote our book on <a href="https://github.com/data-edu/data-science-in-education">GitHub</a>, showing all the many changes it went through until its final completion. By having it freely available on a <a href="https://www.datascienceineducation.com/">website</a>, we hope that it opens the door to others who’d like to learn what we did and work on their own open project as well.</p>
<p><strong>Food (for Thought)</strong> 🍕</p>
<p>The R community offers so many opportunities to get feedback, advice, and information from a wide variety of users. Early on in the book development, we had a lot of questions to nail down: who is the audience? “Data is” or “data are?” How do we describe “people who work in the education field and use data and want to get more effective at it?” Finding a common language was difficult, but we were able to do this by engaging others in the wider R community. We listened to the stories of many data scientists who work in education, then found common experiences we could describe in our writing.</p>
<p>As an example, we learned we weren’t the only ones challenged by learning a programming language while attending to full-time jobs and personal lives. Knowing this, we made sure to <a href="https://datascienceineducation.com/c02.html#different-strokes-for-different-data-scientists-in-education">discuss these challenges in our book</a> and offer various ways of engaging with the material based on the reader’s needs.</p>
<p><strong>Socializing</strong> 💬</p>
<p>Throughout the process of writing DSIEUR, we asked the R community several times for other types of feedback and suggestions. We also ran into some technical issues, especially when it came to preparing our manuscript with {bookdown} to meet our publisher’s specifications, and were able to get ideas on how to resolve them. We know that the R community is a safe and encouraging place to ask questions, and this enabled us to write a stronger book.</p>
<p><strong>The Next Day</strong> ☀️</p>
<p>The community participation throughout the DSIEUR process helped us define our goals and get feedback. Another wonderful aspect is that the R community engaged us back. Writing this RViews series is an example: Someone reached out to us and wanted us to reflect on what we discovered and share it with all of you. This type of engagement reminds us of what an inclusive and encouraging place the R community is and helps us come up with new ways of making sure others see the invitation as well.</p>
<p>Thank you for reading! 🎉 We’ll be back with the fourth post on “One Writer, Five Authors” in about two weeks. Until then, we’d love to know how else the R paRty has encouraged your work, both personally and professionally. You can reach us on Twitter: Emily <a href="https://twitter.com/ebovee09"><strong>ebovee09</strong></a>, Jesse <a href="https://twitter.com/kierisi"><strong>kierisi</strong></a>, Joshua <a href="https://twitter.com/jrosenberg6432"><strong>jrosenberg6432</strong></a>, Ryan <a href="https://twitter.com/RyanEs"><strong>RyanEs</strong></a>, and me <a href="https://twitter.com/ivelasq3"><strong>ivelasq3</strong></a>.</p>
<center>
<em>Liked this post? I’d love for you to retweet!</em>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
Party with R: How the Community Enabled Us to Write a Book<a href="https://t.co/NnGqM9Ux2X">https://t.co/NnGqM9Ux2X</a>
</p>
— RStudio (<span class="citation" data-cites="rstudio">@rstudio</span>) <a href="https://twitter.com/rstudio/status/1290688259182526466?ref_src=twsrc%5Etfw">August 4, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


 ]]></description>
  <category>community</category>
  <guid>https://ivelasq.rbind.io/blog/party-with-R/index.html</guid>
  <pubDate>Mon, 13 Jul 2020 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/party-with-R/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>What it takes to tidy Census data</title>
  <link>https://ivelasq.rbind.io/blog/tidying-census-data/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/thumbnail-wide.jpg" class="img-fluid figure-img" alt="A town of people skating on a frozen lake"></p>
<p></p><p></p>
</figure>
</div>
<p>The U.S. Census releases aggregate data on their <a href="https://www.census.gov/data/tables/2020/demo/hhp2.html">Household Pulse Survey</a>. These data are valuable and cover a range of important topics, particularly those related to the COVID-19 pandemic.</p>
<p>First of all, let me clarify that I think that the work that the Census does is amazing and I am so glad that these data are available. But, when you download the data, you will see that it is a highly stylized Excel spreadsheet. There may be upsides for those who want to see the data quickly and easily. As an R user though, seeing all those merged cells, non-numeric numerics, and category names in rows makes me feel <code>emo::ji('unamused')</code>.</p>
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/census_image.png" class="img-fluid" alt="One of the Census Excel spreadsheets pointing out egregious formatting, like headers, merged cells, and categories in rows."></p>
<p>However, this is not terribly surprising (and with public data, somewhat expected). As stated in the <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">tidy data</a> paper:</p>
<blockquote class="blockquote">
<p>It is often said that 80% of data analysis is spent on cleaning and preparing data.</p>
</blockquote>
<p>Thankfully, we have the very powerful R and tidyverse available to address our data woes. Let’s go through the process of tidying these data with tidyverse packages to show how easily they can become ready for analysis!</p>
<section id="loading-the-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-data">Loading the data</h2>
<p>As usual, we begin by loading our packages.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(readxl)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(httr)</span></code></pre></div>
</div>
<p>We have the option to download the Excel file and load it in R. But what if we want to load the data directly from the website? We can use {httr}! The following code ‘gets’ the file from the internet, writes it in a temporary file path, and loads it in an object called <code>path</code>.</p>
<blockquote class="blockquote">
<p>Many thanks to Liz Potamites for pointing out: if the below doesn’t work, it may be that the link is changed or broken. It should be Table 2 from the second week of the Household Pulse Survey, which as of July 21, 2020, is located <a href="https://www.census.gov/data/tables/2020/demo/hhp/hhp2.html">here</a>.</p>
</blockquote>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;">GET</span>(<span class="st" style="color: #20794D;">"https://www2.census.gov/programs-surveys/demo/tables/hhp/2020/wk2/educ2_week2.xlsx"</span>, <span class="fu" style="color: #4758AB;">write_disk</span>(path <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">tempfile</span>(<span class="at" style="color: #677623;">fileext =</span> <span class="st" style="color: #20794D;">".xlsx"</span>)))</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code>Response [https://www2.census.gov/programs-surveys/demo/tables/hhp/2020/wk2/educ2_week2.xlsx]
  Date: 2022-03-13 15:45
  Status: 200
  Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
  Size: 442 kB
&lt;ON DISK&gt;  /var/folders/pj/nmg9b8_93dq4kwt8nt2d4cj40000gn/T//RtmpRY4m58/file2eca17a48009.xlsx</code></pre>
</div>
</div>
</section>
<section id="cleaning-the-data" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-the-data">Cleaning the data</h2>
<p>As mentioned in the figure above, each sheet comprises a state’s data. It’d be good to have all of the data in one single data structure. One option is to try to force all of the sheets together at once in a data frame (which is a 2D structure). But we also saw that each sheet requires a lot of cleaning before it can be useful, and it may be difficult to clean if they’re all merged in one data frame. Therefore, let’s instead first read in all the data as a <strong>list</strong> (which is a higher dimension structure), clean it up, and <em>then</em> put it together in a data frame.</p>
<p>However, I am not very good at thinking about things in a list format and it’s a little harder to see what’s going on compared to looking at a data frame using <code>View()</code>. Before I clean up a list, I usually work on a single cut of the list as a data frame to know what exactly I am going to do. Thankfully, all the sheets in this Excel sheet are formatted the same across states. This isn’t always the case! Because they are identically formatted, we know if our processing works on one sheet, it will work across all of them.</p>
<p>Let’s look at a single sheet!</p>
<section id="single-sheet-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="single-sheet-cleaning">Single sheet cleaning</h3>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1">census_sheet1 <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;">read_excel</span>(path, <span class="at" style="color: #677623;">sheet =</span> <span class="dv" style="color: #AD0000;">1</span>)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="fu" style="color: #4758AB;">View</span>(census_sheet1)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/census1.png" class="img-fluid figure-img" alt="First three columns of the imported dataset, first column is the table title and the other two don't have names and are listed as dot dot dot 2 and dot dot dot 3."></p>
<p></p><p></p>
</figure>
</div>
<p>Immediately, we see that the top lines are superfluous rows (the headers from the original dataset). We can use <code>skip</code> in <code>read_excel()</code> to not have them read in.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1">census_sheet1 <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;">read_excel</span>(path, <span class="at" style="color: #677623;">sheet =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #677623;">skip =</span> <span class="dv" style="color: #AD0000;">3</span>)</span>
<span id="cb5-3"></span>
<span id="cb5-4"><span class="co" style="color: #5E5E5E;"># View(census_sheet1)</span></span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/census2.png" class="img-fluid figure-img" alt="Dataset with skipped lines so that the column names are now characteristics, Total, and impact of the pandemic on children's education."></p>
<p></p><p></p>
</figure>
</div>
<p>Now that the unnecessary rows are gone, we see that the column names aren’t reading in super well because of the merged cells in the original sheet. In this case, we manually create a vector of the column names and replace the old ones with <code>set_names()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1">new_names <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"select_characteristics"</span>, <span class="st" style="color: #20794D;">"total"</span>, <span class="st" style="color: #20794D;">"using_online_resources"</span>, <span class="st" style="color: #20794D;">"using_paper_materials_sent_home"</span>, <span class="st" style="color: #20794D;">"where_classes_were_cancelled"</span>, <span class="st" style="color: #20794D;">"where_classes_changed_in_another_way"</span>, <span class="st" style="color: #20794D;">"where_no_change_to_classes"</span>, <span class="st" style="color: #20794D;">"did_not_respond"</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4">census_example <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb6-5">  census_sheet1 <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;">set_names</span>(new_names)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/census3.png" class="img-fluid figure-img" alt="Dataset with cleaned names so that they are select underscore characteristics, total, and using online resources."></p>
<p></p><p></p>
</figure>
</div>
<p>We still have some empty rows (and also a row at the very bottom which is a note in the original dataset). We can eliminate these rows using <code>slice()</code>. Here, we’re saying to ‘slice’ rows 1 through 3 and 60.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1">census_example <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb7-2">  census_example <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">slice</span>(<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:-</span><span class="dv" style="color: #AD0000;">3</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">60</span><span class="sc" style="color: #5E5E5E;">:-</span><span class="dv" style="color: #AD0000;">61</span>)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/census4.png" class="img-fluid figure-img" alt="Dataset with removed rows so that the first rows start to line up with the columns."></p>
<p></p><p></p>
</figure>
</div>
<p>Now to deal with the fact that the category names are embedded within the first column <code>select_characteristics</code>. There may be other ways to do this, but again I manually create a vector with all the values that I want to get rid of and use <code>filter()</code> to keep only the rows that do <strong>not</strong> contain the items in the vector.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1">filter_var <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Age"</span>, <span class="st" style="color: #20794D;">"Sex"</span>, <span class="st" style="color: #20794D;">"Hispanic origin and Race"</span>, <span class="st" style="color: #20794D;">"Education"</span>, <span class="st" style="color: #20794D;">"Marital status"</span>, <span class="st" style="color: #20794D;">"Presence of children under 18 years old"</span>, <span class="st" style="color: #20794D;">"Respondent or household member experienced loss of employment income"</span>, <span class="st" style="color: #20794D;">"Mean weekly hours spent on…"</span>, <span class="st" style="color: #20794D;">"Respondent currently employed"</span>, <span class="st" style="color: #20794D;">"Food sufficiency for households prior to March 13, 2020"</span>, <span class="st" style="color: #20794D;">"Household income"</span>)</span>
<span id="cb8-3"></span>
<span id="cb8-4">census_example <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb8-5">  census_example <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-6">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span>select_characteristics <span class="sc" style="color: #5E5E5E;">%in%</span> filter_var) </span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/census5.png" class="img-fluid figure-img" alt="Dataset with filtered rows so that the columns and rows match up."></p>
<p></p><p></p>
</figure>
</div>
<p>Even though we removed the characteristic names from the rows, they contain very useful information. Also, we run into an issue in which two of the characteristic categories had the same options (“yes” and “no”). If we don’t address this, we’ll forget which rows are for which characteristic. To fix this, we manually create a column with the characteristics for each of the response options and append it to the data.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1">category_column <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"age"</span>, <span class="st" style="color: #20794D;">"age"</span>, <span class="st" style="color: #20794D;">"age"</span>, <span class="st" style="color: #20794D;">"age"</span>, <span class="st" style="color: #20794D;">"age"</span>, <span class="st" style="color: #20794D;">"sex"</span>, <span class="st" style="color: #20794D;">"sex"</span>, <span class="st" style="color: #20794D;">"race"</span>, <span class="st" style="color: #20794D;">"race"</span>, <span class="st" style="color: #20794D;">"race"</span>, <span class="st" style="color: #20794D;">"race"</span>, <span class="st" style="color: #20794D;">"race"</span>, <span class="st" style="color: #20794D;">"education"</span>, <span class="st" style="color: #20794D;">"education"</span>, <span class="st" style="color: #20794D;">"education"</span>, <span class="st" style="color: #20794D;">"education"</span>, <span class="st" style="color: #20794D;">"marital_status"</span>, <span class="st" style="color: #20794D;">"marital_status"</span>, <span class="st" style="color: #20794D;">"marital_status"</span>, <span class="st" style="color: #20794D;">"marital_status"</span>, <span class="st" style="color: #20794D;">"marital_status"</span>, <span class="st" style="color: #20794D;">"children"</span>, <span class="st" style="color: #20794D;">"children"</span>, <span class="st" style="color: #20794D;">"loss_employment"</span>, <span class="st" style="color: #20794D;">"loss_employment"</span>, <span class="st" style="color: #20794D;">"loss_employment"</span>, <span class="st" style="color: #20794D;">"hours_spent"</span>, <span class="st" style="color: #20794D;">"hours_spent"</span>, <span class="st" style="color: #20794D;">"employed"</span>, <span class="st" style="color: #20794D;">"employed"</span>, <span class="st" style="color: #20794D;">"employed"</span>, <span class="st" style="color: #20794D;">"food_sufficiency"</span>, <span class="st" style="color: #20794D;">"food_sufficiency"</span>, <span class="st" style="color: #20794D;">"food_sufficiency"</span>, <span class="st" style="color: #20794D;">"food_sufficiency"</span>, <span class="st" style="color: #20794D;">"food_sufficiency"</span>, <span class="st" style="color: #20794D;">"income"</span>, <span class="st" style="color: #20794D;">"income"</span>, <span class="st" style="color: #20794D;">"income"</span>, <span class="st" style="color: #20794D;">"income"</span>, <span class="st" style="color: #20794D;">"income"</span>, <span class="st" style="color: #20794D;">"income"</span>, <span class="st" style="color: #20794D;">"income"</span>, <span class="st" style="color: #20794D;">"income"</span>, <span class="st" style="color: #20794D;">"income"</span>)</span>
<span id="cb9-3"></span>
<span id="cb9-4">census_example <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb9-5">  census_example <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;">add_column</span>(category_column)</span></code></pre></div>
</div>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/census6.png" class="img-fluid figure-img" alt="Column with variable names that repeat down the column."></p>
<p></p><p></p>
</figure>
</div>
</center>
<p>Finally, you may have noticed that some of the rows did not read in as numbers but as characters.</p>
<center>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/census7.png" class="img-fluid figure-img" alt="Column with numbers but with character type."></p>
<p></p><p></p>
</figure>
</div>
</center>
<p>We can use <code>mutate_at()</code> and specify which variables we want to be numeric.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1">census_example <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb10-2">  census_example <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">mutate_at</span>(<span class="fu" style="color: #4758AB;">vars</span>(total, using_online_resources<span class="sc" style="color: #5E5E5E;">:</span>did_not_respond), <span class="fu" style="color: #4758AB;">list</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(.)))</span></code></pre></div>
</div>
<p>Hooray - now we have a tidy dataset we could use for analysis! Which is great, but it’s only one sheet. How do we do this for the additional 66?</p>
</section>
<section id="multi-sheet-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="multi-sheet-cleaning">Multi-sheet cleaning</h3>
<p>We will now download the data and store it in a list, where each sheet (which represents a state) is saved as a tibble within the list. To work across all the lists, we use the tidyverse package {purrr} and its handy functions.</p>
<p>You may notice that the multi-sheet cleaning looks a lot like the single sheet cleaning but everything is wrapped in the function <code>map()</code>. That’s true! The wonderful thing about {purrr} being in the tidyverse is that it’s really easy to integrate with all the tidyverse functions.</p>
<p>Reading the data into one list is slightly more complicated than reading in a single sheet. We begin with the file path from before and then use <code>excel_sheets()</code> to create a vector of the sheet names. <code>set_names()</code> ensures that we have a named list that contains the state names, which will be important later. If we don’t use <code>set_names()</code>, then the tibbles have generic names instead of ‘US’, ‘AL’, etc. Then using <code>purrr::map()</code>, we ask R to download each of the sheets of the dataset and store it together in a list (<code>map()</code> always returns a list).</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1">census_list <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb11-2">  path <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;">excel_sheets</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;">set_names</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;">map</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">read_excel</span>(<span class="at" style="color: #677623;">path =</span> path, <span class="at" style="color: #677623;">sheet =</span> .x, <span class="at" style="color: #677623;">skip =</span> <span class="dv" style="color: #AD0000;">3</span>), <span class="at" style="color: #677623;">.id =</span> <span class="st" style="color: #20794D;">"Sheet"</span>)</span></code></pre></div>
</div>
<p>If you take a look at the list using <code>View(census_list)</code>, you can see the data is stored as tibbles within the list. If you expand <code>US</code>, you’ll see the same data as when we did the single sheet example. You can also see the same data if you run <code>census_list[["US"]]</code>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/census_list.png" class="img-fluid figure-img" alt="Viewing the list of each state with the same data structure underneath"></p>
<p></p><p></p>
</figure>
</div>
<p>Using the same thinking as we did with the single sheet example, let’s go through and clean up this list - without having to go into each tibble!</p>
<p>First, we set the names within each list using <code>set_names()</code>. We tell <code>map()</code> the names of the columns by defining <code>nm</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1">census_list <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb12-2">  census_list <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">map</span>(., set_names, <span class="at" style="color: #677623;">nm =</span> new_names)</span></code></pre></div>
</div>
<p>For each tibble in the list (<code>.x</code>), remove the rows 1 through 3 and 60.</p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb13-1">census_list <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb13-2">  census_list <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">map</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">slice</span>(.x, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:-</span><span class="dv" style="color: #AD0000;">3</span>, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">60</span><span class="sc" style="color: #5E5E5E;">:-</span><span class="dv" style="color: #AD0000;">61</span>))</span></code></pre></div>
</div>
<p>Now for each tibble, filter out the rows in <code>select_characteristics</code> that contain the items in <code>filter_var</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb14-1">census_list <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb14-2">  census_list <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb14-3">  <span class="fu" style="color: #4758AB;">map</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">filter</span>(.x, <span class="sc" style="color: #5E5E5E;">!</span>select_characteristics <span class="sc" style="color: #5E5E5E;">%in%</span> filter_var))</span></code></pre></div>
</div>
<p>Like before, we want a new column that lets us know the category for each of the characteristic options.</p>
<div class="cell">
<div class="sourceCode" id="cb15" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb15-1">census_list <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb15-2">  census_list <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb15-3">  <span class="fu" style="color: #4758AB;">map</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">add_column</span>(.x, category_column))</span></code></pre></div>
</div>
<p>And like before, we want to make sure our numeric columns are actually numeric.</p>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb16-1">census_list <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb16-2">  census_list <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb16-3">  <span class="fu" style="color: #4758AB;">map</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">mutate_at</span>(.x, <span class="fu" style="color: #4758AB;">vars</span>(total, using_online_resources<span class="sc" style="color: #5E5E5E;">:</span>did_not_respond), <span class="fu" style="color: #4758AB;">list</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(.))))</span></code></pre></div>
</div>
<p>Now that our tibbles are all clean and uniform, let’s make this a single, 2D data frame! As I mentioned before, our list should contain the state abbreviations. We can use <code>map_df()</code> to create a data frame with an ID column called <code>state</code> that stores each of the sheet names. With this column, we’ll easily know which column is for which state/geography.</p>
<div class="cell">
<div class="sourceCode" id="cb17" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb17-1">census_df <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb17-2">  census_list <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb17-3">  <span class="fu" style="color: #4758AB;">map_df</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.data.frame</span>(.x), <span class="at" style="color: #677623;">.id =</span> <span class="st" style="color: #20794D;">"state"</span>)</span></code></pre></div>
</div>
<p>Congrats! We have successfully tidied a Census dataset!</p>
</section>
</section>
<section id="using-the-data" class="level2">
<h2 class="anchored" data-anchor-id="using-the-data">Using the data</h2>
<p>The purpose of all this work is to be able to use it easily in R and with the tidyverse specifically. Let’s use the plotting package {ggplot2} to make something!</p>
<p>According to the Census website, we can calculate percentages by removing those that did not respond from the total for the denominator (let’s presume that NA in the column means that everybody responded). Let’s say we want to see the proportion of respondents in the U.S. who say their classes were canceled by income level.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb18-1">census_us_income <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb18-2">  census_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-3">  <span class="fu" style="color: #4758AB;">filter</span>(state <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"US"</span>, category_column <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"income"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">responses =</span> <span class="fu" style="color: #4758AB;">case_when</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(did_not_respond) <span class="sc" style="color: #5E5E5E;">~</span> total <span class="sc" style="color: #5E5E5E;">-</span> did_not_respond, </span>
<span id="cb18-5">                               <span class="fu" style="color: #4758AB;">is.na</span>(did_not_respond) <span class="sc" style="color: #5E5E5E;">~</span> total),<span class="co" style="color: #5E5E5E;"># calculate denominator</span></span>
<span id="cb18-6">         <span class="at" style="color: #677623;">pct_cancelled =</span> where_classes_were_cancelled <span class="sc" style="color: #5E5E5E;">/</span> responses) <span class="co" style="color: #5E5E5E;"># calculate percentage</span></span>
<span id="cb18-7"></span>
<span id="cb18-8">census_us_income <span class="ot" style="color: #00769E;">&lt;-</span> <span class="co" style="color: #5E5E5E;"># setting factor levels so graph shows correct order</span></span>
<span id="cb18-9">  census_us_income <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">select_characteristics =</span> <span class="fu" style="color: #4758AB;">factor</span>(select_characteristics,</span>
<span id="cb18-11">                                         <span class="at" style="color: #677623;">levels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Less than $25,000"</span>, </span>
<span id="cb18-12">                                                    <span class="st" style="color: #20794D;">"$25,000 - $34,999"</span>,</span>
<span id="cb18-13">                                                    <span class="st" style="color: #20794D;">"$35,000 - $49,999"</span>,</span>
<span id="cb18-14">                                                    <span class="st" style="color: #20794D;">"$50,000 - $74,999"</span>,</span>
<span id="cb18-15">                                                    <span class="st" style="color: #20794D;">"$75,000 - $99,999"</span>,</span>
<span id="cb18-16">                                                    <span class="st" style="color: #20794D;">"$100,000 - $149,999"</span>,</span>
<span id="cb18-17">                                                    <span class="st" style="color: #20794D;">"$150,000 - $199,999"</span>,</span>
<span id="cb18-18">                                                    <span class="st" style="color: #20794D;">"$200,000 and above"</span>)))</span>
<span id="cb18-19"></span>
<span id="cb18-20">census_us_income <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-21">  <span class="fu" style="color: #4758AB;">filter</span>(select_characteristics <span class="sc" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">"Did not report"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb18-22">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> select_characteristics, <span class="at" style="color: #677623;">y =</span> pct_cancelled)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-23">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"identity"</span>,</span>
<span id="cb18-24">           <span class="at" style="color: #677623;">fill =</span> <span class="st" style="color: #20794D;">"#00C3DA"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-25">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-26">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">axis.text.x =</span> <span class="fu" style="color: #4758AB;">element_text</span>(<span class="at" style="color: #677623;">angle =</span> <span class="dv" style="color: #AD0000;">45</span>, <span class="at" style="color: #677623;">hjust =</span> <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-27">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #677623;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span>percent) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-28">  <span class="fu" style="color: #4758AB;">labs</span>(<span class="at" style="color: #677623;">title =</span> <span class="st" style="color: #20794D;">"Percent of Respondents Whose Children's Classes Were Cancelled"</span>,</span>
<span id="cb18-29">       <span class="at" style="color: #677623;">x =</span> <span class="st" style="color: #20794D;">"Income"</span>,</span>
<span id="cb18-30">       <span class="at" style="color: #677623;">y =</span> <span class="st" style="color: #20794D;">"Percent with Classes Cancelled"</span>,</span>
<span id="cb18-31">       <span class="at" style="color: #677623;">caption =</span> <span class="st" style="color: #20794D;">"Source: U.S. Census"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/tidying-census-data/index_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" alt="Barplot showing percent of classes that were cancelled by income group, with lower income groups more likely to report cancelled classes" width="672"></p>
</figure>
</div>
</div>
</div>
<p>From this graph, we can see that respondents from the lower-income bands were more likely to say that classes were canceled for their children due to COVID.</p>
<center>
<p><em>Liked this article? I’d love for you to retweet!</em></p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
New blogpost 📣: What It Takes to Tidy Census Aggregate Data! ⭐ Let's take all those heavily formatted Excel sheets and make them a plain and simple data frame together! <a href="https://t.co/IsPb8BJ0ZT">https://t.co/IsPb8BJ0ZT</a> <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://t.co/XABr07wYfP">pic.twitter.com/XABr07wYfP</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1266372221179588609?ref_src=twsrc%5Etfw">May 29, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>analysis</category>
  <guid>https://ivelasq.rbind.io/blog/tidying-census-data/index.html</guid>
  <pubDate>Thu, 28 May 2020 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/tidying-census-data/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Introducing an R package for school district shapefiles</title>
  <link>https://ivelasq.rbind.io/blog/leaidr-shapefiles/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/leaidr-shapefiles/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Colorful flowers in a pot with a black background"></p>
<p></p><p></p>
</figure>
</div>
<p>I would like to introduce <a href="https://github.com/ivelasq/leaidr">{leaidr}</a>, a package for mapping U.S. school district shapefiles!</p>
<p>Inspired by my coauthor <a href="https://joshuamrosenberg.com/">Joshua Rosenberg</a>, the goal of {leaidr} is to facilitate the download and use of school district shapefiles.</p>
<p>School districts in the U.S. have associated local education agency identification numbers (LEAID) used in the <a href="https://nces.ed.gov/pubs2010/100largest0809/tables/table_d05.asp">National Center for Education Statistics (NCES) Common Core of Data</a>. These are very useful because if you have other datasets with NCES IDs, then you can (sometimes easily) join them.</p>
<p>It can be very useful to visualize districts and associated data. District shapefiles are available in different places, such as through the <a href="https://nces.ed.gov/programs/edge/Geographic/DistrictBoundaries">NCES</a> and <a href="https://exhibits.stanford.edu/data/catalog/db586ns4974">Stanford Education Data Archive</a>. The package {tigris} also has a school district option, but unfortunately, it is missing a few district polygons.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tigris)</span>
<span id="cb1-2"></span>
<span id="cb1-3">ca <span class="ot" style="color: #00769E;">&lt;-</span> tigris<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">school_districts</span>(<span class="at" style="color: #677623;">state =</span> <span class="st" style="color: #20794D;">"06"</span>,</span>
<span id="cb1-4">                               <span class="at" style="color: #677623;">type =</span> <span class="st" style="color: #20794D;">"unified"</span>)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="fu" style="color: #4758AB;">plot</span>(ca[<span class="st" style="color: #20794D;">"GEOID"</span>])</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/leaidr-shapefiles/index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" alt="Map of school districts from tigris, which is missing quite a few districts." width="672"></p>
</figure>
</div>
</div>
</div>
<p>{leaidr} downloads NCES’ U.S. district shapefile from Github using ROpenSci’s <a href="https://github.com/ropensci/piggyback">{piggyback}</a> package. This is a super helpful package, as Github caps file uploads at 100 MB (and the shapefile is ~170 MB). I originally tried Github Large File Storage (LFS), but it stores files as a hash, not as an actual file. Therefore, I couldn’t figure out how to use it for a package that others can use.</p>
<p>The function <code>lea_get()</code> downloads an R Data file from the Github repo to your designated path and then writes the necessary shapefiles. Then, create an object with <code>lea_prep()</code> by designating where the shapefiles exist and which state(s) you would like. <strong>Note:</strong> For now, you must use the state’s FIPS code. FIPS state codes are numeric and two-letter alphabetic codes to identify U.S. states and certain other associated areas. A reference table is found <a href="https://www.mcc.co.mercer.pa.us/dps/state_fips_code_listing.htm">here</a>.</p>
<p>Once you have the shapefile, then you can merge with other datasets and plot using packages like {leaflet} and {ggplot2}.</p>
<section id="example-of-creating-a-school-district-map" class="level2">
<h2 class="anchored" data-anchor-id="example-of-creating-a-school-district-map">Example of creating a school district map</h2>
<p>Let’s walk through an example where we will merge external data to the shapefile and then map all the districts in California. The external data is from Josh’s <a href="https://github.com/making-data-science-count/covidedu"><code>covidedu</code> project</a>, which scrapes district websites for specific words. In this case, the search terms were “covid*”, “coron*”, and “closure”. I highly recommend using <code>covidedu</code> for easy scraping from a <strong>lot</strong> of district websites!</p>
<p>First, let’s call our packages.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;"># if you haven't installed the package yet</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;"># devtools::install_github("ivelasq/leaidr")</span></span>
<span id="cb2-4"><span class="fu" style="color: #4758AB;">library</span>(leaidr)</span>
<span id="cb2-5"><span class="fu" style="color: #4758AB;">library</span>(maptools)</span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;"># if you don't have this downloaded</span></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;"># install.packages("mapproj")</span></span></code></pre></div>
</div>
<p>Time to get your data! Use {leaidr} to download and prep your shapefiles for California (FIPS == 06). Read in the external data (in this case, <code>summary-of-table-of-links.csv</code>).</p>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You must have a GitHub PAT set to run <code>lea_get()</code>. <a href="https://happygitwithr.com/github-pat.html">Happy git with R</a> has a great walkthrough on how to get one if you do not have it already.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;"># download the shapefile into a designated folder</span></span>
<span id="cb3-2">leaidr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">lea_get</span>(<span class="at" style="color: #677623;">path =</span> <span class="st" style="color: #20794D;">"./test"</span>)</span>
<span id="cb3-3"></span>
<span id="cb3-4"><span class="co" style="color: #5E5E5E;"># prep the shapefile for the state(s) you'd like</span></span>
<span id="cb3-5">ca_shapefile <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb3-6">  leaidr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">lea_prep</span>(<span class="at" style="color: #677623;">path =</span> <span class="st" style="color: #20794D;">"./test"</span>, <span class="at" style="color: #677623;">fips =</span> <span class="st" style="color: #20794D;">"06"</span>)</span>
<span id="cb3-7"></span>
<span id="cb3-8"><span class="co" style="color: #5E5E5E;"># read in the external data that also has NCES ID's</span></span>
<span id="cb3-9"><span class="co" style="color: #5E5E5E;"># this is from the covidedu project</span></span>
<span id="cb3-10">ca_data <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;">read_csv</span>(<span class="st" style="color: #20794D;">"https://raw.githubusercontent.com/making-data-science-count/covidedu/master/output/2020-04-29/summary-of-table-of-links.csv"</span>)</span></code></pre></div>
</div>
<p>Join the CSV to the shapefile.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1">ca_merge <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb4-2">  sp<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">merge</span>(ca_shapefile, ca_data, <span class="at" style="color: #677623;">by.x =</span> <span class="st" style="color: #20794D;">"GEOID"</span>, <span class="at" style="color: #677623;">by.y =</span> <span class="st" style="color: #20794D;">"nces_id"</span>)</span></code></pre></div>
</div>
<p>Now ‘fortify’ the data - this converts the polygons into points. This is so that ggplot can create the plot.</p>
<p>If you get the error <code>isTRUE(gpclibPermitStatus()) is not TRUE</code>, then you need to enable <code>gpclib</code> by running <code>gpclibPermit()</code> (this is part of the {maptools} package, which should have been loaded above). Note that support for <code>gpclib</code> will be withdrawn from maptools at the next major release, so you might have to try something else if the package has been upgraded.</p>
<p>If you run <code>gpclibPermit()</code> and you keep getting <code>FALSE</code>, then you are missing the package {gpclib}. Install the package, then run <code>gpclibPermit()</code> to set it to <code>TRUE</code>.</p>
<p>(I don’t know if this is the best/only way to do this - if anybody has suggestions, please let me know!)</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="co" style="color: #5E5E5E;"># install.packages("gpclib")</span></span>
<span id="cb5-2"><span class="fu" style="color: #4758AB;">gpclibPermit</span>()</span>
<span id="cb5-3">ca_points <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">fortify</span>(ca_merge, <span class="at" style="color: #677623;">region =</span> <span class="st" style="color: #20794D;">"GEOID"</span>)</span></code></pre></div>
</div>
<p>Now, join the points and the shapefile data.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1">ca_df <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">left_join</span>(ca_merge<span class="sc" style="color: #5E5E5E;">@</span>data, ca_points, <span class="at" style="color: #677623;">by =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"GEOID"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"id"</span>))</span></code></pre></div>
</div>
<p>We can finally plot the shapefile and its data!</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1">ca_map <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb7-2">  ca_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;">geom_polygon</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> long, </span>
<span id="cb7-5">                   <span class="at" style="color: #677623;">y =</span> lat, </span>
<span id="cb7-6">                   <span class="at" style="color: #677623;">group =</span> group,</span>
<span id="cb7-7">                   <span class="at" style="color: #677623;">fill =</span> any_link_found),</span>
<span id="cb7-8">               <span class="at" style="color: #677623;">color =</span> <span class="st" style="color: #20794D;">"gray"</span>, </span>
<span id="cb7-9">               <span class="at" style="color: #677623;">size =</span> .<span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-10">  <span class="fu" style="color: #4758AB;">theme_void</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-11">  <span class="fu" style="color: #4758AB;">scale_fill_iv</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-12">  <span class="fu" style="color: #4758AB;">ggtitle</span>(<span class="st" style="color: #20794D;">"COVID-Related Links Found on CA School District Sites"</span>)</span></code></pre></div>
</div>
<p>To make a nicer looking map, then you can use <code>coord_map()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1">map_projected <span class="ot" style="color: #00769E;">&lt;-</span> ca_map <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;">coord_map</span>()</span>
<span id="cb8-3"></span>
<span id="cb8-4"><span class="fu" style="color: #4758AB;">print</span>(map_projected)</span></code></pre></div>
</div>
<p><img src="https://ivelasq.rbind.io/blog/leaidr-shapefiles/test_map.png" class="img-fluid" alt="Map of California school districts showing whether or not they contained COVID-related links on their website"></p>
<p>Tada! A full school district map for California.</p>
</section>
<section id="call-for-collaboration" class="level2">
<h2 class="anchored" data-anchor-id="call-for-collaboration">Call for collaboration</h2>
<p>Please try out {leaidr}! I hope that it is useful to you in your work. I’d love any collaborators to join me in making it easier/better!</p>
<ul>
<li><strong>Other functionality</strong>: For example: being able to filter shapefiles by NCES IDs as well as states; adding commonly used data (like district demographics).</li>
<li><strong>Issues</strong>: If you run into any issues, please post on the <a href="https://github.com/ivelasq/leaidr/issues">GitHub page!</a></li>
</ul>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li><a href="http://www.nickeubank.com/wp-content/uploads/2015/10/RGIS2_MergingSpatialData_part1_Joins.html"><strong>Joining Spatial Data</strong></a></li>
<li><a href="https://rpubs.com/DanielSLee/censusMap"><strong>Analyzing U.S. Census Data Using R</strong></a></li>
</ul>
<center>
<em>Liked this post? I’d love for you to retweet!</em>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
Ever wish you could easily create U.S. school district maps 🗺🏫 in <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a>? Check out {leaidr}, which downloads the shapefile from GitHub using <a href="https://twitter.com/rOpenSci?ref_src=twsrc%5Etfw"><span class="citation" data-cites="rOpenSci">@rOpenSci</span></a> 's {piggyback} 🐷! Would love any thoughts on how to improve! Repo: <a href="https://t.co/yOszd4agYM">https://t.co/yOszd4agYM</a> Tutorial: <a href="https://t.co/JuqGQcVR7Z">https://t.co/JuqGQcVR7Z</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1259831120364888066?ref_src=twsrc%5Etfw">May 11, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>package</category>
  <guid>https://ivelasq.rbind.io/blog/leaidr-shapefiles/index.html</guid>
  <pubDate>Sun, 03 May 2020 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/leaidr-shapefiles/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>You CRAN do it</title>
  <dc:creator>Isabella Velásquez</dc:creator>
  <link>https://ivelasq.rbind.io/blog/you-cran-do-it/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/you-cran-do-it/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Rosie the Riveter with a red spotted bandana and a blue shirt holding her arm"></p>
<p></p><p></p>
</figure>
</div>
<p>As the @<a href="https://twitter.com/WeAreRLadies">WeAreRLadies</a> curator, I <a href="https://twitter.com/WeAreRLadies/status/1227937968117043200">asked the Twitterverse</a> for advice when submitting a package to the Comprehensive R Archive Network (CRAN) for the first time. Many people replied and offer their tips, experience, and well wishes. I have summarized everybody’s replies below. THANK YOU all for participating!</p>
<p>Here’s what to expect when succeeding to get your package on CRAN!</p>
<center>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
As someone who hopes to submit their first package 📦to CRAN this year… what should I know? 😳
</p>
— We are R-Ladies (<span class="citation" data-cites="WeAreRLadies">@WeAreRLadies</span>) <a href="https://twitter.com/WeAreRLadies/status/1227937968117043200?ref_src=twsrc%5Etfw">February 13, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
<section id="read-the-official-cran-documentation" class="level2">
<h2 class="anchored" data-anchor-id="read-the-official-cran-documentation">Read the official CRAN documentation</h2>
<p>… which is <a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html">Writing R Extensions</a>! “Necessary and sufficient,” according to Avraham Adler.</p>
</section>
<section id="you-can-get-by-with-a-little-help-from-your-friends" class="level2">
<h2 class="anchored" data-anchor-id="you-can-get-by-with-a-little-help-from-your-friends">You can get by with a little help from your friends</h2>
<p>{usethis}, {devtools}, and {roxygen2}, although not necessary, are useful tools for creating CRAN-ready packages.</p>
</section>
<section id="documentation-is-key" class="level2">
<h2 class="anchored" data-anchor-id="documentation-is-key">Documentation is key</h2>
<ul>
<li>Have tests and coverage via {covr}, and make sure they run without issues on all platforms</li>
<li>CRAN will ask that you add examples to your package, wrapped in <code>\dontrun{}</code> and <code>\donttest{}</code>.</li>
<li>Ask others read your stuff and provide feedback!</li>
</ul>
</section>
<section id="let-reviewers-know-why-this-should-be-on-cran" class="level2">
<h2 class="anchored" data-anchor-id="let-reviewers-know-why-this-should-be-on-cran">Let reviewers know why this should be on CRAN</h2>
<p>A quick note letting the reviewers know why your package should be on CRAN goes a long way.</p>
<center>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
Reviewer asking “why do we need this on CRAN?” isn’t a rejection, just respond politely with a reason. <br><br>Also, if <a href="https://t.co/9Mgm9C20E6">https://t.co/9Mgm9C20E6</a> can make it to CRAN, your package belongs there too!
</p>
— Jay Qi (<span class="citation" data-cites="jayyqi">@jayyqi</span>) <a href="https://twitter.com/jayyqi/status/1228049523806617601?ref_src=twsrc%5Etfw">February 13, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
</section>
<section id="be-patient" class="level2">
<h2 class="anchored" data-anchor-id="be-patient">Be patient</h2>
<p>The people at CRAN are busy! It might take a while for them to reply and accept your package. If you want to track the progress of your package, you can take a look at the <a href="https://lockedata.github.io/cransays/articles/dashboard.html">CRAN Incoming Dashboard</a>.</p>
</section>
<section id="emails-will-be-terse" class="level2">
<h2 class="anchored" data-anchor-id="emails-will-be-terse">Emails will be terse</h2>
<p>This is particularly difficult for me to hear, as someone who provides! ample! exclamation marks! in emails! in order to sound cheery and polite, but responses can be short and to-the-point. Breathe, and address everything mentioned. When you do reply, respond to the CRAN list.</p>
</section>
<section id="persist" class="level2">
<h2 class="anchored" data-anchor-id="persist">Persist</h2>
<p>The reviewers will let you know what you need to do for approval. Go through their list carefully and try again!</p>
<center>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
Don’t get discouraged if you don’t succeed on your first try. Everyone (including me, my team, and R core) gets rejected from time to time. It sucks, but don’t give up — just make the requested changes and resubmit.
</p>
— Hadley Wickham (<span class="citation" data-cites="hadleywickham">@hadleywickham</span>) <a href="https://twitter.com/hadleywickham/status/1228043230601777152?ref_src=twsrc%5Etfw">February 13, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
<p>Many thanks to the R Community for their words of advice and encouragement ❤</p>
</section>
<section id="guides" class="level2">
<h2 class="anchored" data-anchor-id="guides">Guides</h2>
<ul>
<li><a href="https://cran.r-project.org/doc/manuals/r-release/R-exts.html">Writing R Extensions</a> (Official CRAN Documentation)</li>
<li>Hadley Wickham and Jenny Bryan’s <a href="https://r-pkgs.org/">R Packages</a></li>
<li>Julia Silge’s <a href="https://juliasilge.com/blog/how-i-stopped/">How I Learned to Stop Worrying and Love R CMD Check</a></li>
<li>Maëlle Salmon’s <a href="https://blog.r-hub.io/2020/01/27/examples/">Code Examples in R Package Manuals</a></li>
<li>R-hub’s <a href="https://r-hub.github.io/rhub/articles/rhub.html#prepare-a-cran-submission">Prepare a CRAN submission</a></li>
<li>R-hub’s <a href="https://vimeo.com/329059890">CRAN submission preparation with rhub</a></li>
<li>Karl Broman’s <a href="https://kbroman.org/pkg_primer/pages/cran.html">Getting Your R Package on CRAN</a></li>
<li>Colin Fay’s <a href="https://github.com/ThinkR-open/prepare-for-cran">Preparing your package for a CRAN submission</a></li>
<li>Jp Marín Díaz’s <a href="https://jpmarindiaz.com/2020-01-08-how-to-publish-a-package-to-cran/">How to publish a package to CRAN</a> and <a href="https://jpmarindiaz.com/2020-02-13-from-0-to-cran-in-1-day/">From 0 to CRAN in 1 day</a></li>
<li>Jim Hester’s <a href="https://www.jimhester.com/post/2019-05-01-submit-vroom/">Submitting vroom to CRAN, LIVE!</a></li>
<li>Ryo Nakagawara’s <a href="https://ryo-n7.github.io/2019-09-06-tvthemes-CRAN-announcement/#cran-trials-and-errors-and-future-releases">CRAN Trial(s) and Error(s) and Future Releases</a></li>
</ul>
<center>
<p><em>Liked this article? I’d love for you to retweet!</em></p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
📢 New blogpost 📢 You CRAN Do It: What CRAN First-Timers Should Know 💪a summary of a thread from <a href="https://twitter.com/WeAreRLadies?ref_src=twsrc%5Etfw"><span class="citation" data-cites="WeAreRLadies">@WeAreRLadies</span></a>. Thank you for all your advice and encouragement! <a href="https://t.co/BimejGvqdr">https://t.co/BimejGvqdr</a> <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://t.co/0Ygk7qHc76">pic.twitter.com/0Ygk7qHc76</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1233031919551401984?ref_src=twsrc%5Etfw">February 27, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>community</category>
  <category>programming</category>
  <guid>https://ivelasq.rbind.io/blog/you-cran-do-it/index.html</guid>
  <pubDate>Tue, 25 Feb 2020 06:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/you-cran-do-it/thumbnail.png" medium="image" type="image/png" height="124" width="144"/>
</item>
<item>
  <title>Six things I always Google when using ggplot2</title>
  <link>https://ivelasq.rbind.io/blog/things-i-google/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/things-i-google/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Colorful dots making up a painting of a garden with two women"></p>
<p></p><p></p>
</figure>
</div>
<p>I often use {ggplot2} to create graphs but there are certain things I <em>always</em> have to Google. I figured I’d create a post for quick reference for myself but I’d love to hear what you always have to look up!</p>
<ul>
<li>Remove the Legend</li>
<li>Change Legend Title and Labels</li>
<li>Manually Change Colors</li>
<li>Remove X Axis Labels</li>
<li>Start the Y Axis at a Specific Number</li>
<li>Use Scales on the Y Axis</li>
</ul>
<p>To showcase what’s happening, I am going to use a <a href="https://github.com/rfordatascience/tidytuesday">TidyTuesday</a> dataset: Spotify songs! Let’s start by creating a simple graph.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span class="co" style="color: #5E5E5E;"># Load Data</span></span>
<span id="cb1-4">spotify_songs <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb1-5">  readr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">read_csv</span>(<span class="st" style="color: #20794D;">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-21/spotify_songs.csv'</span>)</span>
<span id="cb1-6"></span>
<span id="cb1-7">spotify_songs <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> playlist_genre)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb1-9">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"count"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://ivelasq.rbind.io/blog/things-i-google/index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<section id="remove-the-legend" class="level2">
<h2 class="anchored" data-anchor-id="remove-the-legend">Remove the legend</h2>
<p><code>theme(legend.position = "none")</code></p>
<p>Ahh… this one always gets me. Sometimes when your color is mostly just for aesthetics, it doesn’t make sense to also have a color legend. This removes the legend and makes the graph look cleaner.</p>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1">spotify_songs <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> playlist_genre, <span class="at" style="color: #677623;">fill =</span> playlist_genre)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"count"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://ivelasq.rbind.io/blog/things-i-google/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section>
<section id="change-legend-title-and-labels" class="level2">
<h2 class="anchored" data-anchor-id="change-legend-title-and-labels">Change legend title and labels</h2>
<p><code>scale_fill_discrete(name = "New Legend Title", labels = c("lab1" = "Label 1", "lab2" = "Label 2"))</code></p>
<p>Alright, say I do want the legend. How do I make it something readable?</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1">spotify_songs <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> playlist_genre, <span class="at" style="color: #677623;">fill =</span> playlist_genre)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"count"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">scale_fill_discrete</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Playlist Genre"</span>, </span>
<span id="cb3-5">                      <span class="at" style="color: #677623;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"edm"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"EDM"</span>, </span>
<span id="cb3-6">                                 <span class="st" style="color: #20794D;">"latin"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Latin"</span>, </span>
<span id="cb3-7">                                 <span class="st" style="color: #20794D;">"pop"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Pop"</span>, </span>
<span id="cb3-8">                                 <span class="st" style="color: #20794D;">"r&amp;b"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"R&amp;B"</span>, </span>
<span id="cb3-9">                                 <span class="st" style="color: #20794D;">"rap"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Rap"</span>, </span>
<span id="cb3-10">                                 <span class="st" style="color: #20794D;">"rock"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Rock"</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://ivelasq.rbind.io/blog/things-i-google/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section>
<section id="manually-change-colors" class="level2">
<h2 class="anchored" data-anchor-id="manually-change-colors">Manually change colors</h2>
<p><code>scale_fill_manual("New Legend Title", values = c("lab1" = "#000000", "lab2" = "#FFFFFF"))</code></p>
<p>This is a bit trickier, in that you cannot use <code>scale_fill_manual</code> and <code>scale_fill_discrete</code> separately on the same plot as they override each other. However, if you want to change the labels <em>and</em> the colors together, you can use <code>scale_fill_manual</code> like below.</p>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1">spotify_songs <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> playlist_genre, <span class="at" style="color: #677623;">fill =</span> playlist_genre)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"count"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Playlist Genre"</span>, </span>
<span id="cb4-5">                    <span class="at" style="color: #677623;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"edm"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"EDM"</span>, </span>
<span id="cb4-6">                               <span class="st" style="color: #20794D;">"latin"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Latin"</span>, </span>
<span id="cb4-7">                               <span class="st" style="color: #20794D;">"pop"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Pop"</span>, </span>
<span id="cb4-8">                               <span class="st" style="color: #20794D;">"r&amp;b"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"R&amp;B"</span>, </span>
<span id="cb4-9">                               <span class="st" style="color: #20794D;">"rap"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Rap"</span>, </span>
<span id="cb4-10">                               <span class="st" style="color: #20794D;">"rock"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Rock"</span>),</span>
<span id="cb4-11">                    <span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"edm"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#0081e8"</span>, </span>
<span id="cb4-12">                               <span class="st" style="color: #20794D;">"latin"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#9597f0"</span>, </span>
<span id="cb4-13">                               <span class="st" style="color: #20794D;">"pop"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#d4b4f6"</span>, </span>
<span id="cb4-14">                               <span class="st" style="color: #20794D;">"r&amp;b"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ffd6ff"</span>, </span>
<span id="cb4-15">                               <span class="st" style="color: #20794D;">"rap"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ffa1d4"</span>, </span>
<span id="cb4-16">                               <span class="st" style="color: #20794D;">"rock"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ff688c"</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://ivelasq.rbind.io/blog/things-i-google/index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section>
<section id="remove-x-axis-labels" class="level2">
<h2 class="anchored" data-anchor-id="remove-x-axis-labels">Remove x-axis labels</h2>
<p><code>theme(axis.title.x = element_blank(), axis.text.x = element_blank(), axis.ticks.x = element_blank())</code></p>
<p>In this case, since we have a legend, we don’t need any x axis labels. Sometimes I use this if there’s redundant information or if it otherwise makes the graph look cleaner.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1">spotify_songs <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> playlist_genre, <span class="at" style="color: #677623;">fill =</span> playlist_genre)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"count"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Playlist Genre"</span>, </span>
<span id="cb5-5">                    <span class="at" style="color: #677623;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"edm"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"EDM"</span>, </span>
<span id="cb5-6">                               <span class="st" style="color: #20794D;">"latin"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Latin"</span>, </span>
<span id="cb5-7">                               <span class="st" style="color: #20794D;">"pop"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Pop"</span>, </span>
<span id="cb5-8">                               <span class="st" style="color: #20794D;">"r&amp;b"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"R&amp;B"</span>, </span>
<span id="cb5-9">                               <span class="st" style="color: #20794D;">"rap"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Rap"</span>, </span>
<span id="cb5-10">                               <span class="st" style="color: #20794D;">"rock"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Rock"</span>),</span>
<span id="cb5-11">                    <span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"edm"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#0081e8"</span>, </span>
<span id="cb5-12">                               <span class="st" style="color: #20794D;">"latin"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#9597f0"</span>, </span>
<span id="cb5-13">                               <span class="st" style="color: #20794D;">"pop"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#d4b4f6"</span>, </span>
<span id="cb5-14">                               <span class="st" style="color: #20794D;">"r&amp;b"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ffd6ff"</span>, </span>
<span id="cb5-15">                               <span class="st" style="color: #20794D;">"rap"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ffa1d4"</span>, </span>
<span id="cb5-16">                               <span class="st" style="color: #20794D;">"rock"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ff688c"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-17">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">axis.title.x =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb5-18">         <span class="at" style="color: #677623;">axis.text.x =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb5-19">         <span class="at" style="color: #677623;">axis.ticks.x =</span> <span class="fu" style="color: #4758AB;">element_blank</span>())</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://ivelasq.rbind.io/blog/things-i-google/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section>
<section id="start-the-y-axis-at-a-specific-number" class="level2">
<h2 class="anchored" data-anchor-id="start-the-y-axis-at-a-specific-number">Start the y-axis at a specific number</h2>
<p><code>scale_y_continuous(name = "New Y Axis Title", limits = c(0, 1000000))</code></p>
<p>Often times, we want our graph’s y axis to start at 0. In this example it already does, but this handy parameter allows us to set exactly what we want our y axis to be.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1">spotify_songs <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> playlist_genre, <span class="at" style="color: #677623;">fill =</span> playlist_genre)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"count"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Playlist Genre"</span>, </span>
<span id="cb6-5">                    <span class="at" style="color: #677623;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"edm"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"EDM"</span>, </span>
<span id="cb6-6">                               <span class="st" style="color: #20794D;">"latin"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Latin"</span>, </span>
<span id="cb6-7">                               <span class="st" style="color: #20794D;">"pop"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Pop"</span>, </span>
<span id="cb6-8">                               <span class="st" style="color: #20794D;">"r&amp;b"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"R&amp;B"</span>, </span>
<span id="cb6-9">                               <span class="st" style="color: #20794D;">"rap"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Rap"</span>, </span>
<span id="cb6-10">                               <span class="st" style="color: #20794D;">"rock"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Rock"</span>),</span>
<span id="cb6-11">                    <span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"edm"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#0081e8"</span>, </span>
<span id="cb6-12">                               <span class="st" style="color: #20794D;">"latin"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#9597f0"</span>, </span>
<span id="cb6-13">                               <span class="st" style="color: #20794D;">"pop"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#d4b4f6"</span>, </span>
<span id="cb6-14">                               <span class="st" style="color: #20794D;">"r&amp;b"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ffd6ff"</span>, </span>
<span id="cb6-15">                               <span class="st" style="color: #20794D;">"rap"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ffa1d4"</span>, </span>
<span id="cb6-16">                               <span class="st" style="color: #20794D;">"rock"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ff688c"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-17">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">axis.title.x =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb6-18">         <span class="at" style="color: #677623;">axis.text.x =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb6-19">         <span class="at" style="color: #677623;">axis.ticks.x =</span> <span class="fu" style="color: #4758AB;">element_blank</span>()) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-20">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Count"</span>, <span class="at" style="color: #677623;">limits =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">10000</span>))</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://ivelasq.rbind.io/blog/things-i-google/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section>
<section id="use-scales-on-the-y-axis" class="level2">
<h2 class="anchored" data-anchor-id="use-scales-on-the-y-axis">Use scales on the y-axis</h2>
<p><code>scale_y_continuous(label = scales::format)</code></p>
<p>Depending on our data, we may want the y axis to be formatted a certain way (using dollar signs, commas, percentage signs, etc.). The handy {scales} package allows us to do that easily.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1">spotify_songs <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> playlist_genre, <span class="at" style="color: #677623;">fill =</span> playlist_genre)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"count"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;">scale_fill_manual</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Playlist Genre"</span>, </span>
<span id="cb7-5">                    <span class="at" style="color: #677623;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"edm"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"EDM"</span>, </span>
<span id="cb7-6">                               <span class="st" style="color: #20794D;">"latin"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Latin"</span>, </span>
<span id="cb7-7">                               <span class="st" style="color: #20794D;">"pop"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Pop"</span>, </span>
<span id="cb7-8">                               <span class="st" style="color: #20794D;">"r&amp;b"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"R&amp;B"</span>, </span>
<span id="cb7-9">                               <span class="st" style="color: #20794D;">"rap"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Rap"</span>, </span>
<span id="cb7-10">                               <span class="st" style="color: #20794D;">"rock"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"Rock"</span>),</span>
<span id="cb7-11">                    <span class="at" style="color: #677623;">values =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"edm"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#0081e8"</span>, </span>
<span id="cb7-12">                               <span class="st" style="color: #20794D;">"latin"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#9597f0"</span>, </span>
<span id="cb7-13">                               <span class="st" style="color: #20794D;">"pop"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#d4b4f6"</span>, </span>
<span id="cb7-14">                               <span class="st" style="color: #20794D;">"r&amp;b"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ffd6ff"</span>, </span>
<span id="cb7-15">                               <span class="st" style="color: #20794D;">"rap"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ffa1d4"</span>, </span>
<span id="cb7-16">                               <span class="st" style="color: #20794D;">"rock"</span> <span class="ot" style="color: #00769E;">=</span> <span class="st" style="color: #20794D;">"#ff688c"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-17">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">axis.title.x =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb7-18">         <span class="at" style="color: #677623;">axis.text.x =</span> <span class="fu" style="color: #4758AB;">element_blank</span>(),</span>
<span id="cb7-19">         <span class="at" style="color: #677623;">axis.ticks.x =</span> <span class="fu" style="color: #4758AB;">element_blank</span>()) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-20">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Count"</span>, <span class="at" style="color: #677623;">limits =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">10000</span>),</span>
<span id="cb7-21">                     <span class="at" style="color: #677623;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span>comma)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://ivelasq.rbind.io/blog/things-i-google/index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>There we have it! Six things I always eventually end up Googling when I am making plots using {ggplot2}. Hopefully now I can just look at this page instead of searching each and every time!</p>
<center>
<em>Liked this post? I’d love for you to retweet!</em>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
I wrote a quick <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> blogpost: "Six Things I Always Google When Using ggplot2" 🔎 📊 What do you always have to look up when creating your <a href="https://twitter.com/hashtag/ggplot2?src=hash&amp;ref_src=twsrc%5Etfw">#ggplot2</a> graphs? 🤔🤔 <a href="https://t.co/jEOR3RDDIh">https://t.co/jEOR3RDDIh</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1222169501464133633?ref_src=twsrc%5Etfw">January 28, 2020</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>learn</category>
  <guid>https://ivelasq.rbind.io/blog/things-i-google/index.html</guid>
  <pubDate>Mon, 27 Jan 2020 06:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/things-i-google/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Finding the modal school district</title>
  <link>https://ivelasq.rbind.io/blog/modal-district/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/modal-district/thumbnail-wide.jpg" class="img-fluid figure-img" alt="A town showing green and yellow houses and a white church and trees"></p>
<p></p><p></p>
</figure>
</div>
<p>My good friend <a href="https://twitter.com/RyanEs">Ryan Estrellado</a> recommended an <a href="https://www.npr.org/2019/08/28/755191639/episode-936-the-modal-american">NPR Planet Money podcast episode</a> on the “Modal American.” Working with Ben Casselman, Planet Money explored the most ‘typical’ American. It was a fantastic, engaging episode about a common statistical technique that I’ve never seen applied in this way before. They ran the numbers on a variety of demographic variables to see what group is the most common in the U.S. (I highly recommend the episode - it’s pretty surprising!).</p>
<p>Ben Casselman shared the <a href="https://github.com/BenCasselman/planet_money">code</a> he ran for the analysis. Ryan suggested running a similar analysis to find the modal school district, which I thought was brilliant! The analysis is below, but if you are desperate for the answer, the modal school district in the U.S. is [drum roll please]: (1) Majority (&gt;=50%) White, (2) Small, (3) Rural, and (4) Medium-Low FRPL (between 25% and 50% FRPL).</p>
<section id="downloading-and-parsing-data" class="level2">
<h2 class="anchored" data-anchor-id="downloading-and-parsing-data">Downloading and parsing data</h2>
<p>I used NCES <a href="https://nces.ed.gov/ccd/ccddata.asp">Common Core of Data (CCD)</a> to pull Local Educational Agency (LEA) (a.k.a. school districts) demographic data. I wanted to try Urban Institute’s <a href="https://github.com/UrbanInstitute/education-data-package-r">{educationdata}</a> R package. They have enrollment and racial demographic data available to download through their package. For Free/Reduced Price Lunch data, I had to pull the data directly from the CCD as it’s not available via the Urban API.</p>
<p>What buckets do you choose for analysis? This is a bit tricky. I chose buckets I typically refer to for work. I also looked at some <a href="https://nces.ed.gov/pubs2011/2011301.pdf">NCES reports</a> to see how they typically think about districts. Ultimately, I decided on four buckets: urban-centric locale bucket, race/ethnicity bucket, size bucket, and FRPL bucket.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(educationdata)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(janitor)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(ggalluvial)</span>
<span id="cb1-5"></span>
<span id="cb1-6">knitr<span class="sc" style="color: #5E5E5E;">::</span>opts_chunk<span class="sc" style="color: #5E5E5E;">$</span><span class="fu" style="color: #4758AB;">set</span>(<span class="at" style="color: #677623;">out.width =</span> <span class="st" style="color: #20794D;">'100%'</span>) </span></code></pre></div>
</div>
<section id="urban-centric-locale-bucket" class="level3">
<h3 class="anchored" data-anchor-id="urban-centric-locale-bucket">Urban-centric locale bucket</h3>
<p>First, we download the directory data using the Urban Institute’s API. These data include the districts and their <a href="https://nces.ed.gov/pubs2007/ruraled/exhibit_a.asp">urban-centric_locale</a>.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_edf3be05c4c3da7702591717f8eec5cf">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1">ccd_dir <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">get_education_data</span>(<span class="at" style="color: #677623;">level =</span> <span class="st" style="color: #20794D;">'school-districts'</span>,</span>
<span id="cb2-2">                              <span class="at" style="color: #677623;">source =</span> <span class="st" style="color: #20794D;">'ccd'</span>, </span>
<span id="cb2-3">                              <span class="at" style="color: #677623;">topic =</span> <span class="st" style="color: #20794D;">'directory'</span>, </span>
<span id="cb2-4">                              <span class="at" style="color: #677623;">filters =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #677623;">year =</span> <span class="dv" style="color: #AD0000;">2016</span>),</span>
<span id="cb2-5">                              <span class="at" style="color: #677623;">add_labels =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span></code></pre></div>
</div>
<p>Because there are so many options for urban-centric locale, let’s collapse them to just the biggest buckets: City, Town, Rural, and Suburb.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1">ccd_urbanicity <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb3-2">  ccd_dir <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">select</span>(leaid, urban_centric_locale) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">leaid =</span> <span class="fu" style="color: #4758AB;">as.character</span>(leaid),</span>
<span id="cb3-5">         <span class="at" style="color: #677623;">geography =</span> <span class="fu" style="color: #4758AB;">case_when</span>(<span class="fu" style="color: #4758AB;">str_detect</span>(urban_centric_locale, <span class="st" style="color: #20794D;">"City|city"</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"City"</span>,</span>
<span id="cb3-6">                               <span class="fu" style="color: #4758AB;">str_detect</span>(urban_centric_locale, <span class="st" style="color: #20794D;">"Town|town"</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Town"</span>,</span>
<span id="cb3-7">                               <span class="fu" style="color: #4758AB;">str_detect</span>(urban_centric_locale, <span class="st" style="color: #20794D;">"Rural|rural"</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Rural"</span>,</span>
<span id="cb3-8">                               <span class="fu" style="color: #4758AB;">str_detect</span>(urban_centric_locale, <span class="st" style="color: #20794D;">"Suburb|suburb"</span>) <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Suburb"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>urban_centric_locale)</span></code></pre></div>
</div>
</section>
<section id="size-raceethnicity-buckets" class="level3">
<h3 class="anchored" data-anchor-id="size-raceethnicity-buckets">Size &amp; race/ethnicity buckets</h3>
<p>Then, we download the enrollment data from the Urban Institute.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-8_a41a45b820401385311033b6324c351f">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1">ccd_enroll <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">get_education_data</span>(<span class="at" style="color: #677623;">level =</span> <span class="st" style="color: #20794D;">'school-districts'</span>,</span>
<span id="cb4-2">                                 <span class="at" style="color: #677623;">source =</span> <span class="st" style="color: #20794D;">'ccd'</span>, </span>
<span id="cb4-3">                                 <span class="at" style="color: #677623;">topic =</span> <span class="st" style="color: #20794D;">'enrollment'</span>, </span>
<span id="cb4-4">                                 <span class="at" style="color: #677623;">filters =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="at" style="color: #677623;">year =</span> <span class="dv" style="color: #AD0000;">2016</span>,</span>
<span id="cb4-5">                                             <span class="at" style="color: #677623;">grade =</span> <span class="dv" style="color: #AD0000;">99</span>),</span>
<span id="cb4-6">                                 <span class="at" style="color: #677623;">by =</span> <span class="fu" style="color: #4758AB;">list</span>(<span class="st" style="color: #20794D;">'race'</span>),</span>
<span id="cb4-7">                                 <span class="at" style="color: #677623;">add_labels =</span> <span class="cn" style="color: #8f5902;">TRUE</span>) </span></code></pre></div>
</div>
<p>We want to create two buckets here:</p>
<ul>
<li><strong>Size:</strong> Bucket districts by enrollment size, Small (less than 2500 students), Medium (between 2500 and 10,000 students), or Large (10,000 students or more). I used <a href="https://www.google.com/search?q=what+is+a+large+school+district&amp;oq=what+is+a&amp;aqs=chrome.0.69i59j69i57j35i39j69i60l3.1065j0j7&amp;sourceid=chrome&amp;ie=UTF-8">MDR’s</a> definition for this.</li>
<li><strong>Race/Ethnicity:</strong> Bucket districts by Majority Non-White (50% or fewer of students are White) or Majority White (more than 50% of students are White).</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1">ccd_enroll_buckets <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb5-2">  ccd_enroll <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">select</span>(leaid, race, enrollment) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;">spread</span>(race, enrollment, <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">white_na =</span> <span class="fu" style="color: #4758AB;">case_when</span>(White <span class="sc" style="color: #5E5E5E;">==</span> <span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="cn" style="color: #8f5902;">NA_real_</span>, <span class="co" style="color: #5E5E5E;"># districts with missing data loaded as 0 instead of NA for some reason</span></span>
<span id="cb5-6">                              <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> White),</span>
<span id="cb5-7">         <span class="at" style="color: #677623;">pct_white =</span> white_na<span class="sc" style="color: #5E5E5E;">/</span>Total,</span>
<span id="cb5-8">         <span class="at" style="color: #677623;">enroll_na =</span> <span class="fu" style="color: #4758AB;">case_when</span>(Total <span class="sc" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">0</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="cn" style="color: #8f5902;">NA_real_</span>, <span class="co" style="color: #5E5E5E;"># districts with missing data loaded as 0 instead of NA for some reason</span></span>
<span id="cb5-9">                               <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> Total)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">demographics =</span> <span class="fu" style="color: #4758AB;">case_when</span>(pct_white <span class="sc" style="color: #5E5E5E;">&gt;=</span> .<span class="dv" style="color: #AD0000;">5</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Majority White"</span>,</span>
<span id="cb5-11">                                  pct_white <span class="sc" style="color: #5E5E5E;">&lt;</span> .<span class="dv" style="color: #AD0000;">5</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Majority Non-White"</span>,</span>
<span id="cb5-12">                                  <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="cn" style="color: #8f5902;">NA_character_</span>),</span>
<span id="cb5-13">         <span class="at" style="color: #677623;">size =</span> <span class="fu" style="color: #4758AB;">case_when</span>(enroll_na <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">10000</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Large"</span>,</span>
<span id="cb5-14">                          enroll_na <span class="sc" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">10000</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> enroll_na <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">2500</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Medium"</span>,</span>
<span id="cb5-15">                          enroll_na <span class="sc" style="color: #5E5E5E;">&lt;</span> <span class="dv" style="color: #AD0000;">2500</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Small"</span>))</span></code></pre></div>
</div>
</section>
<section id="freereduced-price-lunch-bucket" class="level3">
<h3 class="anchored" data-anchor-id="freereduced-price-lunch-bucket">Free/reduced price lunch bucket</h3>
<p>Now, we load the FRPL data.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-12_e949b77485cfbafa18589b3fe5d98cdf">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1">ccd_frpl <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;">read_csv</span>(<span class="st" style="color: #20794D;">"https://media.githubusercontent.com/media/ivelasq/modal_district/master/data/raw/ccd_sch_033_1617_l_2a_11212017.csv"</span>)</span></code></pre></div>
</div>
<p>We want Free + Reduced Price Lunch numbers by district. This file also has Free Lunch and Reduced Lunch numbers, and it is school-level. We aggregate up Free + Reduced Price Lunch by district.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1">ccd_frpl_wide <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb7-2">  ccd_frpl <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;">clean_names</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">leaid =</span> <span class="fu" style="color: #4758AB;">as.character</span>(leaid)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-5">  <span class="fu" style="color: #4758AB;">filter</span>(data_group <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Free and Reduced-price Lunch Table"</span>,</span>
<span id="cb7-6">         lunch_program <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"No Category Codes"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-7">  <span class="fu" style="color: #4758AB;">select</span>(leaid, student_count) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-8">  <span class="fu" style="color: #4758AB;">group_by</span>(leaid) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;">summarise</span>(<span class="at" style="color: #677623;">frpl_student_count =</span> <span class="fu" style="color: #4758AB;">sum</span>(student_count))</span></code></pre></div>
</div>
<p>Then, we merge with the enrollment data to calculate percent FRPL by district. Our buckets are Low FRPL (less than 25%), Medium-Low FRPL (between 25% and 50% FRPL), Medium-High FRPL (between 50% and 75% FRPL), and High FRPL (greater than 75% FRPL). I originally did not have Medium-Low and Medium High split out but that bucket was so large that I thought this would bring more nuance.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1">ccd_enroll_buckets <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;">left_join</span>(ccd_enroll_buckets, ccd_frpl_wide) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">pct_frpl =</span> frpl_student_count<span class="sc" style="color: #5E5E5E;">/</span>enroll_na,</span>
<span id="cb8-4">         <span class="at" style="color: #677623;">frpl =</span> <span class="fu" style="color: #4758AB;">case_when</span>(pct_frpl <span class="sc" style="color: #5E5E5E;">&lt;=</span> .<span class="dv" style="color: #AD0000;">25</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Low FRPL"</span>,</span>
<span id="cb8-5">                          pct_frpl <span class="sc" style="color: #5E5E5E;">&gt;</span> .<span class="dv" style="color: #AD0000;">25</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> pct_frpl <span class="sc" style="color: #5E5E5E;">&lt;=</span> .<span class="dv" style="color: #AD0000;">5</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Medium-Low FRPL"</span>,</span>
<span id="cb8-6">                          pct_frpl <span class="sc" style="color: #5E5E5E;">&gt;</span> .<span class="dv" style="color: #AD0000;">5</span> <span class="sc" style="color: #5E5E5E;">&amp;</span> pct_frpl <span class="sc" style="color: #5E5E5E;">&lt;=</span> .<span class="dv" style="color: #AD0000;">75</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"Medium-High FRPL"</span>,</span>
<span id="cb8-7">                          pct_frpl <span class="sc" style="color: #5E5E5E;">&gt;</span> .<span class="dv" style="color: #AD0000;">75</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">"High FRPL"</span>))</span></code></pre></div>
</div>
</section>
<section id="bringing-it-all-together" class="level3">
<h3 class="anchored" data-anchor-id="bringing-it-all-together">Bringing it all together</h3>
<p>Finally, we put all the datasets together. One question raised was what to do with missing data. Some districts, either because of small n-sizes or policy, do not report their demographic or FRPL numbers. In fact, some districts were missing enrollment data altogether! For the purposes of this analysis, I removed any district that was missing data in the FRPL or Race/Ethnicity Buckets. Any data without enrollment data is also excluded.</p>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1">ccd_all <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;">full_join</span>(ccd_urbanicity, ccd_enroll_buckets, <span class="at" style="color: #677623;">by =</span> <span class="st" style="color: #20794D;">"leaid"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(frpl),</span>
<span id="cb9-4">         <span class="sc" style="color: #5E5E5E;">!</span><span class="fu" style="color: #4758AB;">is.na</span>(demographics))</span>
<span id="cb9-5"></span>
<span id="cb9-6">ccd_all <span class="ot" style="color: #00769E;">&lt;-</span> <span class="co" style="color: #5E5E5E;"># reordering factors</span></span>
<span id="cb9-7">  ccd_all <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">demographics =</span> <span class="fu" style="color: #4758AB;">factor</span>(demographics, <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Majority White"</span>, <span class="st" style="color: #20794D;">"Majority Non-White"</span>)),</span>
<span id="cb9-9">         <span class="at" style="color: #677623;">size =</span> <span class="fu" style="color: #4758AB;">factor</span>(size, <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Small"</span>, <span class="st" style="color: #20794D;">"Medium"</span>, <span class="st" style="color: #20794D;">"Large"</span>)),</span>
<span id="cb9-10">         <span class="at" style="color: #677623;">geography =</span> <span class="fu" style="color: #4758AB;">factor</span>(geography, <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Rural"</span>, <span class="st" style="color: #20794D;">"Suburb"</span>, <span class="st" style="color: #20794D;">"Town"</span>, <span class="st" style="color: #20794D;">"City"</span>)),</span>
<span id="cb9-11">         <span class="at" style="color: #677623;">frpl =</span> <span class="fu" style="color: #4758AB;">factor</span>(frpl, <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Low FRPL"</span>, <span class="st" style="color: #20794D;">"Medium-Low FRPL"</span>, <span class="st" style="color: #20794D;">"Medium-High FRPL"</span>, <span class="st" style="color: #20794D;">"High FRPL"</span>)))</span></code></pre></div>
</div>
</section>
<section id="running-the-analysis" class="level3">
<h3 class="anchored" data-anchor-id="running-the-analysis">Running the analysis</h3>
<p>We can see what is the modal school district - that is, the combination of our buckets that represents the most districts in the U.S.</p>
<p><strong>Update 2019-09-18:</strong> Thanks to the input from <a href="https://twitter.com/apreshill">Alison Hill</a> on Twitter, instead of the <code>grouper()</code> function in the original analysis I’m using <code>dplyr::count()</code>.</p>
<center>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
This is a great post! I think you don't need the grouper function- I think what you need is dplyr::count(sort = TRUE) (it also does the ungroup for you :) <a href="https://t.co/G6ccoQIHFC">https://t.co/G6ccoQIHFC</a>
</p>
— Alison Presmanes Hill (<span class="citation" data-cites="apreshill">@apreshill</span>) <a href="https://twitter.com/apreshill/status/1174152252996501504?ref_src=twsrc%5Etfw">September 18, 2019</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
<p>The n shows how many districts fit these criteria. Here are the first four but the full table is in the Appendix.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1">modal <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb10-2">  ccd_all <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">count</span>(demographics, frpl, geography, size, <span class="at" style="color: #677623;">sort =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb10-4"></span>
<span id="cb10-5">modal <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;">top_n</span>(<span class="dv" style="color: #AD0000;">4</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-7">  knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">demographics</th>
<th style="text-align: left;">frpl</th>
<th style="text-align: left;">geography</th>
<th style="text-align: left;">size</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">2223</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">1454</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">803</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">576</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The modal school district ends up being: Majority White, Rural, Small, Medium-Low FRPL districts. <strong>18%</strong> (2484) of the 13,464 districts in our analysis fall within these criteria.</p>
</section>
</section>
<section id="takeaways" class="level2">
<h2 class="anchored" data-anchor-id="takeaways">Takeaways</h2>
<section id="some-districts-are-all-alike-every-district-is-different-in-its-own-way" class="level3">
<h3 class="anchored" data-anchor-id="some-districts-are-all-alike-every-district-is-different-in-its-own-way">Some districts are all alike; every district is different in its own way</h3>
<p>If you run each bucket individually, you get the same results as all of the groups together (as in, when running only based on size, the result is that Rural districts are the modal districts). This is slightly different from the Modal American analysis from NPR - none of these demographics seem to ‘split’ the groups.</p>
</section>
<section id="this-makes-sense" class="level3">
<h3 class="anchored" data-anchor-id="this-makes-sense">This makes sense</h3>
<ul>
<li>The U.S. is majority White and areas tend to be segregated.</li>
<li>Majority of districts fall in the Medium FRPL buckets. Majority Non-White districts tend to have higher levels of FRPL, but there are so few of them compared to Majority White Districts, that they do not change the modal district much.</li>
<li>The U.S. is very large and districts cannot get too geographically big in order to serve their students. In places with little population density, which is most of the U.S., these districts must remain small.</li>
<li>Similarly, there are not that many Cities/Towns compared to Rural districts, probably because you need many districts in Rural areas to serve the spread-out population of students.</li>
</ul>
</section>
<section id="its-really-hard-to-visualize-this" class="level3">
<h3 class="anchored" data-anchor-id="its-really-hard-to-visualize-this">It’s really hard to visualize this</h3>
<p>It was interesting trying to visualize these data, especially since there ended up being 87 (!) combinations. I tried a Sankey chart but it is a bit bananas.</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1"><span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">as.data.frame</span>(modal),</span>
<span id="cb11-2">       <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">y =</span> n,</span>
<span id="cb11-3">           <span class="at" style="color: #677623;">axis1 =</span> demographics, </span>
<span id="cb11-4">           <span class="at" style="color: #677623;">axis2 =</span> geography, </span>
<span id="cb11-5">           <span class="at" style="color: #677623;">axis3 =</span> frpl,</span>
<span id="cb11-6">           <span class="at" style="color: #677623;">axis4 =</span> size)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-7">  <span class="fu" style="color: #4758AB;">stat_alluvium</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">fill =</span> n),</span>
<span id="cb11-8">                <span class="at" style="color: #677623;">width =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">6</span>, </span>
<span id="cb11-9">            <span class="at" style="color: #677623;">alpha =</span> <span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">3</span>,</span>
<span id="cb11-10">            <span class="at" style="color: #677623;">aes.bind =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-11">  <span class="fu" style="color: #4758AB;">guides</span>(<span class="at" style="color: #677623;">fill =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-12">  <span class="fu" style="color: #4758AB;">geom_stratum</span>(<span class="at" style="color: #677623;">width =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">/</span><span class="dv" style="color: #AD0000;">12</span>, <span class="at" style="color: #677623;">fill =</span> <span class="st" style="color: #20794D;">"black"</span>, <span class="at" style="color: #677623;">color =</span> <span class="st" style="color: #20794D;">"grey"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-13">  <span class="fu" style="color: #4758AB;">geom_label</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"stratum"</span>, <span class="at" style="color: #677623;">label.strata =</span> <span class="cn" style="color: #8f5902;">TRUE</span>, <span class="at" style="color: #677623;">size =</span> <span class="dv" style="color: #AD0000;">2</span>, <span class="at" style="color: #677623;">hjust =</span> <span class="st" style="color: #20794D;">"inward"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-14">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #677623;">breaks =</span> <span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">4</span>, <span class="at" style="color: #677623;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Demographics"</span>, <span class="st" style="color: #20794D;">"Geography"</span>, <span class="st" style="color: #20794D;">"FRPL"</span>, <span class="st" style="color: #20794D;">"Size"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-15">  <span class="fu" style="color: #4758AB;">ggtitle</span>(<span class="st" style="color: #20794D;">"Modal District Sankey Chart"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-16">  <span class="fu" style="color: #4758AB;">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://ivelasq.rbind.io/blog/modal-district/index_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
<p>I tried to visualize the data another way - using bar plots. Again, this gets a bit unruly with all the variables. This leads me to think it’s better to just look at the table.</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1">ccd_all <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;">select</span>(leaid, demographics, geography, size, frpl) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">count =</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(count)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;">geom_bar</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;">facet_grid</span>(demographics <span class="sc" style="color: #5E5E5E;">+</span> frpl <span class="sc" style="color: #5E5E5E;">~</span> size <span class="sc" style="color: #5E5E5E;">+</span> geography)</span></code></pre></div>
<div class="cell-output-display">
<p><img src="https://ivelasq.rbind.io/blog/modal-district/index_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" style="width:100.0%"></p>
</div>
</div>
</section>
</section>
<section id="next-steps" class="level2">
<h2 class="anchored" data-anchor-id="next-steps">Next steps</h2>
<p>In addition to analyzing more variables (perhaps data that are less likely to correlate), it would be interesting to cut the data using smaller grain size for the buckets. There are probably very interesting nuances between Majority White districts for example - we just need the data (and bandwidth!) to find out.</p>
<p>I am in awe of social media, which allows us to learn and share in so many ways. My friend retweeted a news article, which prompted the person who wrote the code to share, and then we crafted an idea based on that. I think that’s pretty great!</p>
<p><strong>Update 2019-09-18:</strong> <a href="https://twitter.com/bencasselman">Ben Casselman</a> wrote a reply on how it would be interesting to conduct an analysis on the modal school experience. So exciting! Can’t wait to continue the analysis (and always looking for collaborators!)</p>
<center>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
Curious what this would look like if you weighted by student population – in essence, the modal school <em>experience.</em> (More students attend this type of school than any other.) Suspect the results would look quite different.
</p>
— Ben Casselman (<span class="citation" data-cites="bencasselman">@bencasselman</span>) <a href="https://twitter.com/bencasselman/status/1173577230997512198?ref_src=twsrc%5Etfw">September 16, 2019</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>
</section>
<section id="appendix" class="level2">
<h2 class="anchored" data-anchor-id="appendix">Appendix</h2>
<section id="full-table" class="level3">
<h3 class="anchored" data-anchor-id="full-table">Full table</h3>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb13-1">ccd_all <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;">count</span>(demographics, frpl, geography, size) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-3">  knitr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">kable</span>()</span></code></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">demographics</th>
<th style="text-align: left;">frpl</th>
<th style="text-align: left;">geography</th>
<th style="text-align: left;">size</th>
<th style="text-align: right;">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">803</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">459</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">373</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">145</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">32</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">79</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">2223</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">107</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">312</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">241</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">47</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">545</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">145</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">37</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">21</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">1454</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">101</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">136</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">68</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">397</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">143</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">303</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">41</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">47</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">37</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">59</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">75</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-Low FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">209</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">128</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">105</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">95</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">207</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">43</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">Medium-High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">74</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">359</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">50</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Rural</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">159</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">49</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Suburb</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">129</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">73</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">Town</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Small</td>
<td style="text-align: right;">576</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Medium</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="even">
<td style="text-align: left;">Majority Non-White</td>
<td style="text-align: left;">High FRPL</td>
<td style="text-align: left;">City</td>
<td style="text-align: left;">Large</td>
<td style="text-align: right;">39</td>
</tr>
</tbody>
</table>
</div>
</div>


</section>
</section>
 ]]></description>
  <category>analysis</category>
  <guid>https://ivelasq.rbind.io/blog/modal-district/index.html</guid>
  <pubDate>Wed, 11 Sep 2019 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/modal-district/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Taking a peek into my hiking data</title>
  <link>https://ivelasq.rbind.io/blog/average-hike/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/average-hike/thumbnail-wide.jpg" class="img-fluid figure-img" alt="A horizon of snow-capped mountains"></p>
<p></p><p></p>
</figure>
</div>
<p>I moved to Seattle at the end of 2016 and since then have done over 100 hikes (depending on your definition of ‘a hike’). I must admit I’ve been abysmal at tracking any data regarding my hiking activity beyond a <a href="https://docs.google.com/spreadsheets/d/1Y3NdGea6yVuoDS7ewUKmuKGZouzU62FHK-aY813TafA/edit?usp=sharing">Google spreadsheet</a>, despite the ubiquity of trail tracking apps that exist.</p>
<p>Recently, I signed up on <a href="https://www.alltrails.com/">AllTrails</a> to start collecting data on my hikes. The Pro service offers many wonderful features, including the ability to download GPX data on hikes. I was so excited by this that I decided to try to visualize the hikes I have done.</p>
<p>I ran <a href="https://twitter.com/ivelasq3/status/1121536896956428289">a poll on Twitter</a> in which I asked whether people embed code in the main text of their blog post or at the end. 91% embed in the main text [n = 85]. I structured this post accordingly.</p>
<section id="pulling-data" class="level2">
<h2 class="anchored" data-anchor-id="pulling-data">Pulling data</h2>
<section id="choose-packages" class="level3">
<h3 class="anchored" data-anchor-id="choose-packages">Choose packages</h3>
<p>It took a bit to decide which packages had the functions needed to run the spatial analyses. In the end, I decided on:</p>
<ul>
<li><strong>plotKML</strong>: A package containing functions to read GPX files.</li>
<li><strong>geosphere</strong>: A package containing functions for geospatial calculations. I decided to use this for finding out distances between lon/lat.</li>
<li><strong>googleway</strong>: A package allowing access to the Google Maps API. To run this, you need to obtain a Google Maps API key and load it to R by using <code>set_key()</code>. I use this for elevation calculations but the API can also obtain the distance between points.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(googleway)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(plotKML)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(geosphere)</span>
<span id="cb1-5"></span>
<span id="cb1-6">googleway<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">set_key</span>(API_KEY_HERE)</span></code></pre></div>
</div>
</section>
<section id="tidy-data" class="level3">
<h3 class="anchored" data-anchor-id="tidy-data">Tidy data</h3>
<p>I downloaded each GPX file from AllTrails and saved them in a file in my project organization. Their file names were TRAILNAME.gpx.</p>
<ul>
<li>Using <code>plotKML::readGPX()</code> results in the files being loaded as lists.</li>
<li>I used <code>purrr</code> in conjunction with <code>plotKML()</code> to handily read them in and add the file name to the list.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;"># find gpx files</span></span>
<span id="cb2-2">data_path <span class="ot" style="color: #00769E;">&lt;-</span> </span>
<span id="cb2-3">  here<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">here</span>(<span class="st" style="color: #20794D;">"data"</span>, <span class="st" style="color: #20794D;">"raw"</span>, <span class="st" style="color: #20794D;">"gpx_files"</span>)</span>
<span id="cb2-4"></span>
<span id="cb2-5">files <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb2-6">  <span class="fu" style="color: #4758AB;">dir</span>(data_path, <span class="at" style="color: #677623;">pattern =</span> <span class="st" style="color: #20794D;">"*.gpx"</span>, <span class="at" style="color: #677623;">full.names =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span>
<span id="cb2-7"></span>
<span id="cb2-8"><span class="co" style="color: #5E5E5E;"># get trail names</span></span>
<span id="cb2-9">names <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;">dir</span>(data_path, <span class="at" style="color: #677623;">pattern =</span> <span class="st" style="color: #20794D;">"*.gpx"</span>, <span class="at" style="color: #677623;">full.names =</span> <span class="cn" style="color: #8f5902;">FALSE</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;">str_extract</span>(<span class="st" style="color: #20794D;">".+?(?=.gpx)"</span>)</span>
<span id="cb2-12"></span>
<span id="cb2-13"><span class="co" style="color: #5E5E5E;"># read all gpx files</span></span>
<span id="cb2-14">gpx_dat <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb2-15">  <span class="fu" style="color: #4758AB;">map2</span>(files,</span>
<span id="cb2-16">       names,</span>
<span id="cb2-17">       <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">readGPX</span>(.x,</span>
<span id="cb2-18">         <span class="at" style="color: #677623;">metadata =</span> <span class="cn" style="color: #8f5902;">TRUE</span>,</span>
<span id="cb2-19">         <span class="at" style="color: #677623;">bounds =</span> <span class="cn" style="color: #8f5902;">TRUE</span>,</span>
<span id="cb2-20">         <span class="at" style="color: #677623;">waypoints =</span> <span class="cn" style="color: #8f5902;">TRUE</span>,</span>
<span id="cb2-21">         <span class="at" style="color: #677623;">tracks =</span> <span class="cn" style="color: #8f5902;">TRUE</span>,</span>
<span id="cb2-22">         <span class="at" style="color: #677623;">routes =</span> <span class="cn" style="color: #8f5902;">TRUE</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-23">         <span class="fu" style="color: #4758AB;">list_modify</span>(<span class="at" style="color: #677623;">trail =</span> .y)) <span class="co" style="color: #5E5E5E;"># otherwise you can't tell which entry is for which trail</span></span></code></pre></div>
</div>
</section>
<section id="calculate-elevation" class="level3">
<h3 class="anchored" data-anchor-id="calculate-elevation">Calculate elevation</h3>
<p>We can use <code>googleway::google_elevation()</code> to access the Google Elevation API and calculate elevation for every lon/lat pair from the GPX files. Unfortunately, the API accepts and returns only a few requests at a time (~200 rows for these files). We have over 51,000 rows of data. So, we can create groups for every 200 rows and use a loop to make a call for each</p>
<p>This results in a list, so we can then create a tibble pulling out the data we want.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1">lonlat_dat <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb3-2">  gpx_dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">map_df</span>(., <span class="sc" style="color: #5E5E5E;">~</span>.x<span class="sc" style="color: #5E5E5E;">$</span><span class="st" style="color: #20794D;">"routes"</span>[[<span class="dv" style="color: #AD0000;">1</span>]], <span class="at" style="color: #677623;">.id =</span> <span class="st" style="color: #20794D;">"trail"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">select</span>(trail, lon, lat) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;">group_by</span>(trail) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">group_number =</span> (<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;">nrow</span>(.) <span class="sc" style="color: #5E5E5E;">%/%</span> <span class="dv" style="color: #AD0000;">200</span>) <span class="sc" style="color: #5E5E5E;">+</span> <span class="dv" style="color: #AD0000;">1</span>) <span class="co" style="color: #5E5E5E;"># https://stackoverflow.com/questions/32078578/how-to-group-by-every-7-rows-and-aggregate-those-7-values-by-median</span></span>
<span id="cb3-8"></span>
<span id="cb3-9">dat_lapply <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">lapply</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="fu" style="color: #4758AB;">max</span>(lonlat_dat<span class="sc" style="color: #5E5E5E;">$</span>group_number), <span class="cf" style="color: #00769E;">function</span>(x) {</span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;">Sys.sleep</span>(<span class="dv" style="color: #AD0000;">3</span>)</span>
<span id="cb3-11">  </span>
<span id="cb3-12">  lonlat_dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-13">    <span class="fu" style="color: #4758AB;">filter</span>(group_number <span class="sc" style="color: #5E5E5E;">==</span> x) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># added a filter so you only pull a subset of the data.</span></span>
<span id="cb3-14">    <span class="fu" style="color: #4758AB;">do</span>(<span class="at" style="color: #677623;">elev_dat =</span></span>
<span id="cb3-15">         <span class="fu" style="color: #4758AB;">data.frame</span>(</span>
<span id="cb3-16">           <span class="fu" style="color: #4758AB;">google_elevation</span>(</span>
<span id="cb3-17">             <span class="at" style="color: #677623;">df_locations =</span> dplyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">select</span>(., lon, lat),</span>
<span id="cb3-18">             <span class="at" style="color: #677623;">location_type =</span> <span class="st" style="color: #20794D;">"individual"</span>,</span>
<span id="cb3-19">             <span class="at" style="color: #677623;">simplify =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)))</span>
<span id="cb3-20">  })</span>
<span id="cb3-21"></span>
<span id="cb3-22">dat_lapply_elev_dat <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb3-23">  dat_lapply <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-24">  <span class="fu" style="color: #4758AB;">map</span>(., <span class="sc" style="color: #5E5E5E;">~</span> .x<span class="sc" style="color: #5E5E5E;">$</span><span class="st" style="color: #20794D;">"elev_dat"</span>[[<span class="dv" style="color: #AD0000;">1</span>]])</span>
<span id="cb3-25"></span>
<span id="cb3-26">elev_df <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb3-27">  dat_lapply_elev_dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> {</span>
<span id="cb3-28">    <span class="fu" style="color: #4758AB;">tibble</span>(</span>
<span id="cb3-29">      <span class="at" style="color: #677623;">elevation =</span> <span class="fu" style="color: #4758AB;">map</span>(., <span class="sc" style="color: #5E5E5E;">~</span> .x<span class="sc" style="color: #5E5E5E;">$</span><span class="st" style="color: #20794D;">"results.elevation"</span>),</span>
<span id="cb3-30">      <span class="at" style="color: #677623;">lon =</span> <span class="fu" style="color: #4758AB;">map</span>(., <span class="sc" style="color: #5E5E5E;">~</span> .x<span class="sc" style="color: #5E5E5E;">$</span><span class="st" style="color: #20794D;">"results.location"</span>[[<span class="st" style="color: #20794D;">"lng"</span>]]),</span>
<span id="cb3-31">      <span class="at" style="color: #677623;">lat =</span> <span class="fu" style="color: #4758AB;">map</span>(.,  <span class="sc" style="color: #5E5E5E;">~</span> .x<span class="sc" style="color: #5E5E5E;">$</span><span class="st" style="color: #20794D;">"results.location"</span>[[<span class="st" style="color: #20794D;">"lat"</span>]])</span>
<span id="cb3-32">    )</span>
<span id="cb3-33">  } <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-34">  <span class="fu" style="color: #4758AB;">unnest</span>(<span class="at" style="color: #677623;">.id =</span> <span class="st" style="color: #20794D;">"group_number"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-35">  <span class="fu" style="color: #4758AB;">select</span>(group_number, elevation, lon, lat)</span></code></pre></div>
</div>
</section>
<section id="calculate-distance" class="level3">
<h3 class="anchored" data-anchor-id="calculate-distance">Calculate distance</h3>
<p>Now we have a list of trails, longitudes and latitudes along their paths, and the elevation for each of those points. Now we want to calculate the distance along the paths.</p>
<ul>
<li>We bring back <code>lonlat_dat</code> so we know what trails with which each point are associated.</li>
<li>To use calculate distance, we can use <code>distHaversine()</code> with two sets of lon/lat. We create the second set of lon/lat by creating a new variable that takes the “next” value in a vector (so we’re calculating the distance between point A and point B, point B to point C, and so on).</li>
<li><code>cumsum()</code> accumulates the distances between each set of lon/lat.</li>
<li>Finally, we calculate the elevation gain for each hike.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1">hiking_dat <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb4-2">  plyr<span class="sc" style="color: #5E5E5E;">::</span><span class="fu" style="color: #4758AB;">join</span>(elev_df, lonlat_dat, <span class="at" style="color: #677623;">type =</span> <span class="st" style="color: #20794D;">"left"</span>, <span class="at" style="color: #677623;">match =</span> <span class="st" style="color: #20794D;">"first"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;">group_by</span>(trail) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">elev_feet =</span> elevation <span class="sc" style="color: #5E5E5E;">*</span> <span class="fl" style="color: #AD0000;">3.281</span>, <span class="co" style="color: #5E5E5E;"># to convert to feet</span></span>
<span id="cb4-5">         <span class="at" style="color: #677623;">lon2 =</span> <span class="fu" style="color: #4758AB;">lead</span>(lon, <span class="dv" style="color: #AD0000;">1</span>),</span>
<span id="cb4-6">         <span class="at" style="color: #677623;">lat2 =</span> <span class="fu" style="color: #4758AB;">lead</span>(lat, <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;">ungroup</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">dist =</span> <span class="fu" style="color: #4758AB;">distHaversine</span>(hiking_dat[, <span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">3</span>], hiking_dat[, <span class="dv" style="color: #AD0000;">7</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">8</span>])<span class="sc" style="color: #5E5E5E;">/</span><span class="fl" style="color: #AD0000;">1609.344</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># to convert to miles</span></span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;">group_by</span>(trail) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">cumdist =</span> <span class="fu" style="color: #4758AB;">cumsum</span>(dist),</span>
<span id="cb4-11">         <span class="at" style="color: #677623;">elev_gain =</span> elev_feet <span class="sc" style="color: #5E5E5E;">-</span> <span class="fu" style="color: #4758AB;">first</span>(elev_feet)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-12">  <span class="fu" style="color: #4758AB;">ungroup</span>()</span></code></pre></div>
</div>
</section>
<section id="create-additional-tables" class="level3">
<h3 class="anchored" data-anchor-id="create-additional-tables">Create additional tables</h3>
<p>For nerdy kicks, I also wanted to find out my ‘average’ hike - that is, the average distance, the average elevation, and the average elevation for each distance. I also wanted to see the total distance and elevation for each trail for which I pulled data.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1">avg_elev <span class="ot" style="color: #00769E;">&lt;-</span> <span class="co" style="color: #5E5E5E;"># average elevation by distance</span></span>
<span id="cb5-2">  hiking_dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">group_by</span>(<span class="fu" style="color: #4758AB;">round</span>(cumdist, <span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;">summarize</span>(<span class="fu" style="color: #4758AB;">mean</span>(elev_gain))</span>
<span id="cb5-5"></span>
<span id="cb5-6">hiking_dat_by_trail <span class="ot" style="color: #00769E;">&lt;-</span> <span class="co" style="color: #5E5E5E;"># total gain/distance by trail</span></span>
<span id="cb5-7">  hiking_dat <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;">select</span>(trail, cumdist, elev_gain) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;">group_by</span>(trail) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;">summarize</span>(<span class="at" style="color: #677623;">tot_dist =</span> <span class="fu" style="color: #4758AB;">max</span>(cumdist, <span class="at" style="color: #677623;">na.rm =</span> T),</span>
<span id="cb5-11">            <span class="at" style="color: #677623;">tot_elev_gain =</span> <span class="fu" style="color: #4758AB;">max</span>(elev_gain)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-12">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">tot_dist_scaled =</span> <span class="fu" style="color: #4758AB;">scale</span>(tot_dist), <span class="co" style="color: #5E5E5E;"># for cluster analysis</span></span>
<span id="cb5-13">         <span class="at" style="color: #677623;">tot_elev_scaled =</span> <span class="fu" style="color: #4758AB;">scale</span>(tot_elev_gain))</span></code></pre></div>
</div>
</section>
</section>
<section id="creating-visualizations" class="level2">
<h2 class="anchored" data-anchor-id="creating-visualizations">Creating visualizations</h2>
</section>
<section id="disclaimer" class="level2">
<h2 class="anchored" data-anchor-id="disclaimer">Disclaimer</h2>
<p>For data collection, I downloaded each trail’s GPX files from AllTrails. Because these data are proprietary, I will not be providing them. Some things to note:</p>
<ul>
<li>Because these are data pulled from the website, they are not indicative of my actual hiking path (for example, Franklin Falls is a 2-mile hike in the summer, but in the winter is a 6-mile snowshoe).</li>
<li>There are hikes that I did back-to-back that I’d consider one hike but the trails might be listed separately on the site. For example, Deception Pass is actually made up of three small loops.</li>
</ul>
</section>
<section id="the-hikes-are-wide-and-varied" class="level2">
<h2 class="anchored" data-anchor-id="the-hikes-are-wide-and-varied">The hikes are wide and varied</h2>
<p>Being fortunate enough to live near multiple mountain ranges, the hikes come in all shapes and sizes.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb6-2">  <span class="fu" style="color: #4758AB;">geom_density_ridges</span>(<span class="at" style="color: #677623;">data =</span> <span class="fu" style="color: #4758AB;">na.omit</span>(hiking_dat),</span>
<span id="cb6-3">                      <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> cumdist,</span>
<span id="cb6-4">                          <span class="at" style="color: #677623;">y =</span> trail,</span>
<span id="cb6-5">                          <span class="at" style="color: #677623;">group =</span> trail),</span>
<span id="cb6-6">                      <span class="at" style="color: #677623;">fill =</span> <span class="st" style="color: #20794D;">"#00204c"</span>,</span>
<span id="cb6-7">                      <span class="at" style="color: #677623;">rel_min_height =</span> <span class="fl" style="color: #AD0000;">0.01</span></span>
<span id="cb6-8">                      ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-9">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb6-10">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
</div>
<p><img src="https://ivelasq.rbind.io/blog/average-hike/joyplot.png" class="img-fluid" alt="Joyplot showing trail distance and height"></p>
<p>I calculated my ‘average hike’ - that is, the average elevation given the cumulative distance traveled.</p>
<div class="cell">
<div class="sourceCode" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb7-1"><span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;">geom_ridgeline</span>(<span class="at" style="color: #677623;">data =</span> hiking_dat,</span>
<span id="cb7-3">                 <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> cumdist,</span>
<span id="cb7-4">                     <span class="at" style="color: #677623;">y =</span> trail,</span>
<span id="cb7-5">                     <span class="at" style="color: #677623;">group =</span> trail,</span>
<span id="cb7-6">                     <span class="at" style="color: #677623;">height =</span> elev_gain),</span>
<span id="cb7-7">                 <span class="at" style="color: #677623;">color =</span> <span class="st" style="color: #20794D;">"#c9b869"</span>,</span>
<span id="cb7-8">                 <span class="at" style="color: #677623;">alpha =</span> <span class="dv" style="color: #AD0000;">0</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-9">  <span class="fu" style="color: #4758AB;">geom_line</span>(<span class="at" style="color: #677623;">data =</span> avg_elev,</span>
<span id="cb7-10">            <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #677623;">round(cumdist, 1)</span><span class="st" style="color: #20794D;">`</span>,</span>
<span id="cb7-11">                <span class="at" style="color: #677623;">y =</span> <span class="st" style="color: #20794D;">`</span><span class="at" style="color: #677623;">mean(elev_gain)</span><span class="st" style="color: #20794D;">`</span>),</span>
<span id="cb7-12">            <span class="at" style="color: #677623;">color =</span> <span class="st" style="color: #20794D;">"#00204c"</span>,</span>
<span id="cb7-13">            <span class="at" style="color: #677623;">size =</span> <span class="dv" style="color: #AD0000;">2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-14">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Cumulative Distance (miles)"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-15">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Cumulative Elevation (ft)"</span>, <span class="at" style="color: #677623;">limits =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">5000</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-16">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb7-17">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
</div>
<p><img src="https://ivelasq.rbind.io/blog/average-hike/avg_hike.png" class="img-fluid" alt="Line chart showing distance and elevation of individual hikes with a darker line highlighting the average elevation by distance"></p>
</section>
<section id="aggregated-data-by-trail" class="level2">
<h2 class="anchored" data-anchor-id="aggregated-data-by-trail">Aggregated Data by Trail</h2>
<p>In the aggregate, there seems to be a correlation (r^2 = 0.48) between total distance and total elevation.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="fu" style="color: #4758AB;">ggplot</span>() <span class="sc" style="color: #5E5E5E;">+</span> </span>
<span id="cb8-2">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #677623;">data =</span> hiking_dat_by_trail,</span>
<span id="cb8-3">             <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> tot_dist,</span>
<span id="cb8-4">                 <span class="at" style="color: #677623;">y =</span> tot_elev_gain,</span>
<span id="cb8-5">                 <span class="at" style="color: #677623;">color =</span> tot_elev_gain,</span>
<span id="cb8-6">                 <span class="at" style="color: #677623;">size =</span> tot_dist)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-7">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Total Distance (miles)"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-8">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Total Elevation (ft)"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-9">  <span class="fu" style="color: #4758AB;">scale_color_viridis</span>(<span class="at" style="color: #677623;">option =</span> <span class="st" style="color: #20794D;">"cividis"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-10">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
</div>
<p><img src="https://ivelasq.rbind.io/blog/average-hike/tot_dis_elev.png" class="img-fluid" alt="Scatterplot of total distance by total elevation"></p>
</section>
<section id="there-exist-clusters-of-hikes" class="level2">
<h2 class="anchored" data-anchor-id="there-exist-clusters-of-hikes">There exist “clusters” of hikes</h2>
<p>I ran a quick <a href="https://uc-r.github.io/kmeans_clustering">cluster analysis</a> to see if I can categorize my hikes in any way. Code is in the Methodology section. Four clusters seemed to be optimal. I have dubbed them:</p>
<ul>
<li>Cluster 1: “Let’s Get This Over With” (steep &amp; hard)</li>
<li>Cluster 2: “Easy Peasy Lemon Squeezy” (short &amp; flat)</li>
<li>Cluster 3: “The Sweet Spot” (not too long, not too high)</li>
<li>Cluster 4: “I Don’t Care About My Knees Anyway” (too long for my own good)</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb9-1"><span class="fu" style="color: #4758AB;">fviz_nbclust</span>(hiking_dat_by_trail[, <span class="dv" style="color: #AD0000;">4</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">5</span>], kmeans, <span class="at" style="color: #677623;">method =</span> <span class="st" style="color: #20794D;">"wss"</span>) <span class="co" style="color: #5E5E5E;"># finding optimal number of clusters</span></span>
<span id="cb9-2">k4 <span class="ot" style="color: #00769E;">&lt;-</span> <span class="fu" style="color: #4758AB;">kmeans</span>(hiking_dat_by_trail[, <span class="dv" style="color: #AD0000;">4</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">5</span>], <span class="at" style="color: #677623;">centers =</span> <span class="dv" style="color: #AD0000;">4</span>, <span class="at" style="color: #677623;">nstart =</span> <span class="dv" style="color: #AD0000;">25</span>) <span class="co" style="color: #5E5E5E;"># calculating clusters</span></span>
<span id="cb9-3"></span>
<span id="cb9-4"><span class="fu" style="color: #4758AB;">fviz_cluster</span>(k4, <span class="at" style="color: #677623;">data =</span> hiking_dat_by_trail)  <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-5">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Scaled Total Distance (miles)"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-6">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #677623;">name =</span> <span class="st" style="color: #20794D;">"Scaled Total Elevation (ft)"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-7">  <span class="fu" style="color: #4758AB;">scale_color_viridis</span>(<span class="at" style="color: #677623;">option =</span> <span class="st" style="color: #20794D;">"cividis"</span>, <span class="at" style="color: #677623;">discrete =</span> T) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-8">  <span class="fu" style="color: #4758AB;">scale_fill_viridis</span>(<span class="at" style="color: #677623;">option =</span> <span class="st" style="color: #20794D;">"cividis"</span>, <span class="at" style="color: #677623;">discrete =</span> T) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb9-9">  <span class="fu" style="color: #4758AB;">theme_minimal</span>()</span></code></pre></div>
</div>
<p><img src="https://ivelasq.rbind.io/blog/average-hike/cluster_analysis.png" class="img-fluid" alt="Cluster analysis of hikes by elevation and distance showing four distinct clusters"></p>
</section>
<section id="i-dont-particularly-love-long-hikes" class="level2">
<h2 class="anchored" data-anchor-id="i-dont-particularly-love-long-hikes">I don’t particularly love long hikes</h2>
<p>My average hike is 6.4 miles - and most of them are concentrated around that distance. This makes sense as I usually day hike and need to get back at a reasonable time. My shortest hike was 1.18 miles and my longest was 17.85 (the Enchantments…). In these 90 hikes, I hiked around 576 miles.</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1">hiking_dat_by_trail <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> tot_dist)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #677623;">fill =</span> <span class="st" style="color: #20794D;">"#00204c"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">"Trail Total Distance (miles)"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-5">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"Count"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;">scale_fill_viridis</span>(<span class="at" style="color: #677623;">option =</span> <span class="st" style="color: #20794D;">"cividis"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb10-8">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/average-hike/dist_histogram.png" class="img-fluid figure-img" alt="Histogram of hike total distance skewed right"></p>
<p></p><p></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1">hiking_dat_by_trail <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">cumdist =</span> <span class="fu" style="color: #4758AB;">cumsum</span>(tot_dist)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> trail,</span>
<span id="cb11-4">             <span class="at" style="color: #677623;">y =</span> cumdist,</span>
<span id="cb11-5">             <span class="at" style="color: #677623;">fill =</span> cumdist)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"identity"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-7">  <span class="fu" style="color: #4758AB;">scale_fill_viridis</span>(<span class="at" style="color: #677623;">option =</span> <span class="st" style="color: #20794D;">"cividis"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-8">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb11-9">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/average-hike/cum_dist.png" class="img-fluid figure-img" alt="Cumulative bar plot of distance increasing from the left to the right colored by a gradient"></p>
<p></p><p></p>
</figure>
</div>
</section>
<section id="i-dont-dislike-high-elevation-hikes-though" class="level2">
<h2 class="anchored" data-anchor-id="i-dont-dislike-high-elevation-hikes-though">I don’t dislike high elevation hikes though</h2>
<p>Elevation on these hikes ranged from ~0 feet to 4580 feet gain. I averaged 1455.4 feet gain and have climbed 130,984 feet (~24 miles!).</p>
<div class="cell">
<div class="sourceCode" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb12-1">hiking_dat_by_trail <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> tot_elev_gain)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #677623;">fill =</span> <span class="st" style="color: #20794D;">"#00204c"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-4">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">"Trail Total Elevation (ft)"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-5">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"Count"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-6">  <span class="fu" style="color: #4758AB;">scale_fill_viridis</span>(<span class="at" style="color: #677623;">option =</span> <span class="st" style="color: #20794D;">"cividis"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-7">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb12-8">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
</div>
<p><img src="https://ivelasq.rbind.io/blog/average-hike/elev_histogram.png" class="img-fluid" alt="Histogram of hike total elevation skewed right"></p>
<div class="cell">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb13-1">hiking_dat_by_trail <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">cumelev =</span> <span class="fu" style="color: #4758AB;">cumsum</span>(tot_elev_gain)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> trail,</span>
<span id="cb13-4">             <span class="at" style="color: #677623;">y =</span> cumelev,</span>
<span id="cb13-5">             <span class="at" style="color: #677623;">fill =</span> cumelev)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-6">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"identity"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-7">  <span class="fu" style="color: #4758AB;">scale_fill_viridis</span>(<span class="at" style="color: #677623;">option =</span> <span class="st" style="color: #20794D;">"cividis"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-8">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb13-9">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
</div>
<p><img src="https://ivelasq.rbind.io/blog/average-hike/cum_elev.png" class="img-fluid" alt="Cumulative bar plot of elevation increasing from left to right and colored by a gradient"></p>
<center>
<p><em>Liked this article? I’d love for you to retweet!</em></p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
New blog post 🎉: Taking A Peek into My Hiking Data accessing Google Maps API with <code>googleway</code> ⛰️🗺 <a href="https://t.co/2foOUgPKIy">https://t.co/2foOUgPKIy</a> <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://t.co/pEevVI9uxN">pic.twitter.com/pEevVI9uxN</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1125384610894843905?ref_src=twsrc%5Etfw">May 6, 2019</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>analysis</category>
  <guid>https://ivelasq.rbind.io/blog/average-hike/index.html</guid>
  <pubDate>Sat, 06 Apr 2019 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/average-hike/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Transforming PDFs into useful tables</title>
  <link>https://ivelasq.rbind.io/blog/snap-expenditures/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/snap-expenditures/thumbnail-wide.jpg" class="img-fluid figure-img" alt="Several green plumbs on a brown table"></p>
<p></p><p></p>
</figure>
</div>
<p>Way back in 2016, the USDA released a <a href="https://www.fns.usda.gov/snap/foods-typically-purchased-supplemental-nutrition-assistance-program-snap-households">study</a> entitled “Foods Typically Purchased by Supplemental Nutrition Assistance Program (SNAP) Households” that included a summary, final report, and appendices. Per the USDA’s description:</p>
<p><em>“This study uses calendar year 2011 point-of-sale transaction data from a leading grocery retailer to examine the food choices of SNAP and non-SNAP households.”</em></p>
<p>At the time though, I was most interested in looking at the <a href="https://fns-prod.azureedge.net/sites/default/files/ops/SNAPFoodsTypicallyPurchased-Appendices.pdf">appendices data</a> - <em>263</em> pages full of tables detailing the commodities and categories of food bought by both families served and not served by SNAP. Unfortunately, these wonderful data are in PDF format, with ‘fancy’ Excel formatting (merged cells, unnecessary column names), where the formatting varies depending on which appendix you are looking at.</p>
<p>I <a href="mailto:SNAPHQ-WEB@fns.usda.gov">emailed</a> SNAP HQ to ask if they had the raw data available in CSVs and was told simply:</p>
<p><em>“Thank you for your inquiry. Unfortunately we do not have the data tables in a CSV file.”</em></p>
<p>At the time, my R skills were pretty rudimentary and I couldn’t figure out how to easily and efficiently pull the data into usable tables. Two years later and with a little more experience with R and scraping and cleaning ugly files, I decided to try again using the {tidyverse} and {tabulizer} packages.</p>
<div class="cell">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(tabulizer)</span></code></pre></div>
</div>
<p>We use <code>tabulizer::extract_tables()</code> to extract the data from the <a href="https://fns-prod.azureedge.net/sites/default/files/ops/SNAPFoodsTypicallyPurchased-Appendices.pdf">appendices PDF</a>. Once we extract the tables, we are left with a list (which is slightly more manageable than the original PDFs).</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-6_3cf540c1e755ec4dea2e1ab8f0340109">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1">snap_pdf <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;">extract_tables</span>(</span>
<span id="cb2-3">    <span class="st" style="color: #20794D;">"https://fns-prod.azureedge.net/sites/default/files/ops/SNAPFoodsTypicallyPurchased-Appendices.pdf"</span></span>
<span id="cb2-4">  )</span></code></pre></div>
</div>
<p>Using the {purrr} package, we create a data frame from the lists while simultaneously removing the unnecessary rows.</p>
<div class="cell">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1">snap_df <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb3-2">  snap_pdf <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">map</span>(as_tibble) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">map_df</span>( <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">slice</span>(.,<span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">2</span>)) <span class="co" style="color: #5E5E5E;"># slicing because of the unnecessary rows</span></span>
<span id="cb3-5"></span>
<span id="cb3-6"><span class="fu" style="color: #4758AB;">head</span>(snap_df)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 9
  V1                    V2    V3             V4    V5    V6    V7    V8    V9   
  &lt;chr&gt;                 &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 ""                    ""    SNAP Househol… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
2 "Soft drinks"         ""    1 $357.7 5.44… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
3 "Fluid milk products" ""    2 $253.7 3.85… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
4 "Beef:grinds"         ""    3 $201.0 3.05… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
5 "Bag snacks"          ""    4 $199.3 3.03… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; 
6 "Cheese"              ""    5 $186.4 2.83… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt; </code></pre>
</div>
</div>
<p>Due to the original formatting of the PDFs, we need to do a lot of cleaning to make the list into a usable table. Using <code>slice()</code>, we isolate only the rows from Appendix 1.</p>
<div class="cell">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1">snap_appendix1 <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb5-2">  snap_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">slice</span>(<span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">244</span>)</span></code></pre></div>
</div>
<p>Now comes the fun part (yay, data cleaning!). When we look at the data frame, the data for each commodity are in two separate columns (<code>V2</code> and <code>V3</code>), but only one column or the other. There are several empty columns (<code>V4</code> through <code>V9</code>), probably created due to the funky original formatting.</p>
<p>First things first: let’s put all the data in a single column called <code>col_dat</code>. Then, we will remove all the empty rows in the newly created <code>col_dat</code> column.</p>
<div class="cell">
<div class="sourceCode" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb6-1">snap_appendix1_pt1 <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb6-2">  snap_appendix1 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">col_dat =</span> <span class="fu" style="color: #4758AB;">case_when</span>(<span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"[0-9]"</span>, V2) <span class="sc" style="color: #5E5E5E;">~</span> V2, <span class="co" style="color: #5E5E5E;"># create a column that contains all the data</span></span>
<span id="cb6-4">                             <span class="fu" style="color: #4758AB;">grepl</span>(<span class="st" style="color: #20794D;">"[0-9]"</span>, V3) <span class="sc" style="color: #5E5E5E;">~</span> V3,</span>
<span id="cb6-5">                             <span class="cn" style="color: #8f5902;">TRUE</span> <span class="sc" style="color: #5E5E5E;">~</span> <span class="st" style="color: #20794D;">""</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;">filter</span>(col_dat <span class="sc" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">""</span>) <span class="co" style="color: #5E5E5E;"># some rows are empty</span></span>
<span id="cb6-7"></span>
<span id="cb6-8"><span class="fu" style="color: #4758AB;">head</span>(snap_appendix1_pt1)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 10
  V1                  V2    V3       V4    V5    V6    V7    V8    V9    col_dat
  &lt;chr&gt;               &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  
1 Soft drinks         ""    1 $357.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  1 $357…
2 Fluid milk products ""    2 $253.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  2 $253…
3 Beef:grinds         ""    3 $201.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  3 $201…
4 Bag snacks          ""    4 $199.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  4 $199…
5 Cheese              ""    5 $186.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  5 $186…
6 Baked breads        ""    6 $163.… &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;  6 $163…</code></pre>
</div>
</div>
<p>Now the numeric data we want is in a single column, we can select the columns <code>V1</code> and <code>col_dat</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb8-1">snap_appendix1_pt2 <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb8-2">  snap_appendix1_pt1 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;">select</span>(V1, col_dat)</span>
<span id="cb8-4"></span>
<span id="cb8-5"><span class="fu" style="color: #4758AB;">head</span>(snap_appendix1_pt2)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 2
  V1                  col_dat                        
  &lt;chr&gt;               &lt;chr&gt;                          
1 Soft drinks         1 $357.7 5.44% 2 $1,263.3 4.01%
2 Fluid milk products 2 $253.7 3.85% 1 $1,270.3 4.03%
3 Beef:grinds         3 $201.0 3.05% 6 $621.1 1.97%  
4 Bag snacks          4 $199.3 3.03% 5 $793.9 2.52%  
5 Cheese              5 $186.4 2.83% 3 $948.9 3.01%  
6 Baked breads        6 $163.7 2.49% 4 $874.8 2.78%  </code></pre>
</div>
</div>
<p>The numeric data is still mushed in column <code>col_dat</code>. We can use <code>tidyr::separate()</code> to split the values that are separated by spaces into their own columns. We reference the original PDF to descriptively rename the columns (and the commodity column <code>V1</code> as well).</p>
<div class="cell">
<div class="sourceCode" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb10-1">snap_appendix1_pt3 <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb10-2">  snap_appendix1_pt2 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;">separate</span>(</span>
<span id="cb10-4">    col_dat,</span>
<span id="cb10-5">    <span class="st" style="color: #20794D;">" "</span>,</span>
<span id="cb10-6">    <span class="at" style="color: #677623;">into =</span> <span class="fu" style="color: #4758AB;">c</span>(</span>
<span id="cb10-7">      <span class="st" style="color: #20794D;">"snap_rank"</span>,</span>
<span id="cb10-8">      <span class="st" style="color: #20794D;">"snap_dollars_in_millions"</span>,</span>
<span id="cb10-9">      <span class="st" style="color: #20794D;">"snap_pct_total_expenditures"</span>,</span>
<span id="cb10-10">      <span class="st" style="color: #20794D;">"nonsnap_rank"</span>,</span>
<span id="cb10-11">      <span class="st" style="color: #20794D;">"nonsnap_dollars_in_millions"</span>,</span>
<span id="cb10-12">      <span class="st" style="color: #20794D;">"nonsnap_pct_total_expenditures"</span></span>
<span id="cb10-13">    )</span>
<span id="cb10-14">  ) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb10-15">  <span class="fu" style="color: #4758AB;">rename</span>(<span class="at" style="color: #677623;">commodity =</span> V1)</span></code></pre></div>
</div>
<p>The numeric values have retained their original formatting, with dollar signs and commas and percentage signs, oh my! We can remove those unnecessary characters and transform those columns into truly numeric values.</p>
<div class="cell">
<div class="sourceCode" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb11-1">snap_appendix1_pt4 <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb11-2">  snap_appendix1_pt3 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="fu" style="color: #4758AB;">across</span>(</span>
<span id="cb11-4">    snap_rank<span class="sc" style="color: #5E5E5E;">:</span>nonsnap_pct_total_expenditures,</span>
<span id="cb11-5">    <span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">as.numeric</span>(<span class="fu" style="color: #4758AB;">str_replace_all</span>(.x, <span class="st" style="color: #20794D;">",|%|</span><span class="sc" style="color: #5E5E5E;">\\</span><span class="st" style="color: #20794D;">$"</span>, <span class="st" style="color: #20794D;">""</span>))</span>
<span id="cb11-6">  ))</span>
<span id="cb11-7"></span>
<span id="cb11-8"><span class="fu" style="color: #4758AB;">head</span>(snap_appendix1_pt4)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 7
  commodity           snap_rank snap_dollars_in_m… snap_pct_total_… nonsnap_rank
  &lt;chr&gt;                   &lt;dbl&gt;              &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
1 Soft drinks                 1               358.             5.44            2
2 Fluid milk products         2               254.             3.85            1
3 Beef:grinds                 3               201              3.05            6
4 Bag snacks                  4               199.             3.03            5
5 Cheese                      5               186.             2.83            3
6 Baked breads                6               164.             2.49            4
# … with 2 more variables: nonsnap_dollars_in_millions &lt;dbl&gt;,
#   nonsnap_pct_total_expenditures &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Last but not least, we convert all the columns with percentages into actual percentages by dividing by 100.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb13-1">snap_appendix1_clean <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb13-2">  snap_appendix1_pt4 <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb13-3">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="fu" style="color: #4758AB;">contains</span>(<span class="st" style="color: #20794D;">"pct"</span>), <span class="sc" style="color: #5E5E5E;">~</span> . <span class="sc" style="color: #5E5E5E;">/</span> <span class="dv" style="color: #AD0000;">100</span>))</span></code></pre></div>
</div>
<p>Tada! Now we have a clean dataset from the original not-very-usable PDFs.</p>
<div class="cell">
<div class="sourceCode" id="cb14" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb14-1"><span class="fu" style="color: #4758AB;">head</span>(snap_appendix1_clean)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code># A tibble: 6 × 7
  commodity           snap_rank snap_dollars_in_m… snap_pct_total_… nonsnap_rank
  &lt;chr&gt;                   &lt;dbl&gt;              &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
1 Soft drinks                 1               358.           0.0544            2
2 Fluid milk products         2               254.           0.0385            1
3 Beef:grinds                 3               201            0.0305            6
4 Bag snacks                  4               199.           0.0303            5
5 Cheese                      5               186.           0.0283            3
6 Baked breads                6               164.           0.0249            4
# … with 2 more variables: nonsnap_dollars_in_millions &lt;dbl&gt;,
#   nonsnap_pct_total_expenditures &lt;dbl&gt;</code></pre>
</div>
</div>
<p>At some point, I would like to do a full analysis of what these data show. My hope is that now some of it is available, others can create and share amazing analyses using these data. For the purposes of this post, here is a quick ggplot that compare the rank of commodities between families served by SNAP and those who are not. Based on a Wilcox Signed-Rank Test, the two groups do not statistically differ in their food rankings.</p>
<div class="cell">
<div class="sourceCode" id="cb16" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb16-1"><span class="fu" style="color: #4758AB;">wilcox.test</span>(snap_appendix1_clean<span class="sc" style="color: #5E5E5E;">$</span>snap_rank,</span>
<span id="cb16-2">            snap_appendix1_clean<span class="sc" style="color: #5E5E5E;">$</span>nonsnap_rank,</span>
<span id="cb16-3">            <span class="at" style="color: #677623;">paired =</span> <span class="cn" style="color: #8f5902;">TRUE</span>)</span></code></pre></div>
<div class="cell-output-stdout">
<pre><code>
    Wilcoxon signed rank test with continuity correction

data:  snap_appendix1_clean$snap_rank and snap_appendix1_clean$nonsnap_rank
V = 13954, p-value = 0.7538
alternative hypothesis: true location shift is not equal to 0</code></pre>
</div>
</div>
<p>Here is a ggplot that compare the rank of commodities between families served by SNAP and those who are not. The labels display which commodities differ by rank of 30 or more.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb18-1"><span class="fu" style="color: #4758AB;">library</span>(ggrepel)</span>
<span id="cb18-2"></span>
<span id="cb18-3">snap_appendix1_plot <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb18-4">  snap_appendix1_clean <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb18-5">  <span class="fu" style="color: #4758AB;">select</span>(commodity, snap_rank, nonsnap_rank) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb18-6">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">rank_diff =</span> snap_rank <span class="sc" style="color: #5E5E5E;">-</span> nonsnap_rank) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb18-7">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"snap_rank"</span>, <span class="st" style="color: #20794D;">"nonsnap_rank"</span>),</span>
<span id="cb18-8">               <span class="at" style="color: #677623;">names_to =</span> <span class="st" style="color: #20794D;">"variable"</span>,</span>
<span id="cb18-9">               <span class="at" style="color: #677623;">values_to =</span> <span class="st" style="color: #20794D;">"value"</span>)</span>
<span id="cb18-10"></span>
<span id="cb18-11"><span class="fu" style="color: #4758AB;">ggplot</span>(snap_appendix1_plot, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> variable, <span class="at" style="color: #677623;">y =</span> value)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-12">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #677623;">size =</span> <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #677623;">col =</span> <span class="st" style="color: #20794D;">"lightgrey"</span>, <span class="at" style="color: #677623;">alpha =</span> <span class="fl" style="color: #AD0000;">0.2</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-13">  <span class="fu" style="color: #4758AB;">geom_line</span>(</span>
<span id="cb18-14">    <span class="at" style="color: #677623;">data =</span> snap_appendix1_plot <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb18-15">      <span class="fu" style="color: #4758AB;">filter</span>(rank_diff <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">30</span> <span class="sc" style="color: #5E5E5E;">|</span> rank_diff <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">30</span>),</span>
<span id="cb18-16">    <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">group =</span> commodity),</span>
<span id="cb18-17">    <span class="at" style="color: #677623;">color =</span> <span class="st" style="color: #20794D;">"#00C3DA"</span>,</span>
<span id="cb18-18">    <span class="at" style="color: #677623;">alpha =</span> <span class="fl" style="color: #AD0000;">0.6</span></span>
<span id="cb18-19">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-20">  <span class="fu" style="color: #4758AB;">geom_text_repel</span>(</span>
<span id="cb18-21">    <span class="at" style="color: #677623;">data =</span> snap_appendix1_plot <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb18-22">      <span class="fu" style="color: #4758AB;">filter</span>(rank_diff <span class="sc" style="color: #5E5E5E;">&gt;=</span> <span class="dv" style="color: #AD0000;">30</span>,</span>
<span id="cb18-23">             variable <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"nonsnap_rank"</span>),</span>
<span id="cb18-24">    <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">label =</span> commodity),</span>
<span id="cb18-25">    <span class="at" style="color: #677623;">nudge_y =</span> <span class="fl" style="color: #AD0000;">0.25</span>,</span>
<span id="cb18-26">    <span class="at" style="color: #677623;">size =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb18-27">    <span class="at" style="color: #677623;">direction =</span> <span class="st" style="color: #20794D;">"y"</span></span>
<span id="cb18-28">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-29">  <span class="fu" style="color: #4758AB;">geom_text_repel</span>(</span>
<span id="cb18-30">    <span class="at" style="color: #677623;">data =</span> snap_appendix1_plot <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb18-31">      <span class="fu" style="color: #4758AB;">filter</span>(rank_diff <span class="sc" style="color: #5E5E5E;">&lt;=</span> <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">30</span>,</span>
<span id="cb18-32">             variable <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"snap_rank"</span>),</span>
<span id="cb18-33">    <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">label =</span> commodity),</span>
<span id="cb18-34">    <span class="at" style="color: #677623;">nudge_y =</span> <span class="fl" style="color: #AD0000;">0.25</span>,</span>
<span id="cb18-35">    <span class="at" style="color: #677623;">size =</span> <span class="dv" style="color: #AD0000;">2</span>,</span>
<span id="cb18-36">    <span class="at" style="color: #677623;">direction =</span> <span class="st" style="color: #20794D;">"y"</span></span>
<span id="cb18-37">  ) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-38">  <span class="fu" style="color: #4758AB;">ggtitle</span>(<span class="st" style="color: #20794D;">"Rank Comparison"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-39">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">"Category"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-40">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"Rank"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-41">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-42">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-43">  <span class="fu" style="color: #4758AB;">scale_x_discrete</span>(<span class="at" style="color: #677623;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Non-SNAP Expenditure Rank"</span>, <span class="st" style="color: #20794D;">"SNAP Expenditure Rank"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb18-44">  <span class="fu" style="color: #4758AB;">scale_y_reverse</span>()</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/snap-expenditures/index_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" alt="Line plot showing difference in rank by families served and not served by SNAP" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I’d love to collaborate with others to finish up this project and find more efficient ways of cleaning these data. The repo with the code and final dataset are on <a href="https://github.com/ivelasq/snap">Github</a>.</p>
<center>
<p><em>Liked this article? I’d love for you to retweet!</em></p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
New blog post 🎉 Extracting SNAP Expenditures Data by Transforming PDFs into Useful Tables 🥒🌶🥕 <a href="https://t.co/UP0hQaHJc9">https://t.co/UP0hQaHJc9</a> <a href="https://twitter.com/hashtag/tabulizer?src=hash&amp;ref_src=twsrc%5Etfw">#tabulizer</a> <a href="https://twitter.com/hashtag/dplyr?src=hash&amp;ref_src=twsrc%5Etfw">#dplyr</a> <a href="https://t.co/SYWbqMiIZh">pic.twitter.com/SYWbqMiIZh</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1074704678858973184?ref_src=twsrc%5Etfw">December 17, 2018</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


 ]]></description>
  <category>analysis</category>
  <guid>https://ivelasq.rbind.io/blog/snap-expenditures/index.html</guid>
  <pubDate>Sun, 16 Dec 2018 06:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/snap-expenditures/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>Disaggregating school district data</title>
  <link>https://ivelasq.rbind.io/blog/why-disaggregate-data/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/why-disaggregate-data/thumbnail-wide.jpg" class="img-fluid figure-img" alt="A sunset with dark clouds at a beach"></p>
<p></p><p></p>
</figure>
</div>
<p>I am a data analyst committed to nonprofit work with the aim of reducing racial and socioeconomic inequities. Data, and in particular disaggregated data, can provide measures of the equity of a system, process, or program. Displaying data by subgroups is an important step in any data team’s equity journey, and exploring these data beyond averages can highlight the most prominent equity needs.</p>
<p>In this post, I define what disaggregated data is and how it can inform teams on their equity work. Then, I run various cuts on Minneapolis Public Schools data. The district’s reporting of the composition of their schools provides an excellent opportunity to explore inequities in a system.</p>
<p>Although this post heavily references education and student data, the principle of using distributions is paramount in any field that strives to close equity gaps.</p>
<section id="what-is-equity" class="level2">
<h2 class="anchored" data-anchor-id="what-is-equity">What is Equity</h2>
<p>Inequities are <a href="http://www.yourdictionary.com/racial-inequality">disparities in opportunity, resources, and treatment.</a> Racial and socioeconomic inequities are those that are as a result of one’s race or socioeconomic status. The unequal distribution of opportunity, resource, and treatment can be due to many factors, including patterns in society. <a href="https://www.allsides.com/dictionary/racial-inequity">Examples include:</a></p>
<ul>
<li>Racial attitudes/bias that act subtly to undermine and exclude,</li>
<li>Continued redlining in lending,</li>
<li>Embedded biases in education (images, language, school discipline),</li>
<li>Long term ramifications of poor health/healthcare.</li>
</ul>
<p>Because the definition of equity varies from team to team, it is important to decide which inequities to identify and focus on.</p>
</section>
<section id="what-is-disaggregated-data" class="level2">
<h2 class="anchored" data-anchor-id="what-is-disaggregated-data">What is disaggregated data</h2>
<p>According to the <a href="https://www.edglossary.org/disaggregated-data/">Glossary of Education Reform</a>, the formal definition of disaggregated data is:</p>
<blockquote class="blockquote">
<p>Disaggregated data refers to numerical or non-numerical information that has been (1) collected from multiple sources and/or on multiple measures, variables, or individuals; (2) compiled into aggregate data—i.e., summaries of data—typically for the purposes of public reporting or statistical analysis; and then (3) broken down in component parts or smaller units of data.</p>
</blockquote>
<p>Aggregate population numbers are broken down into smaller groupings that analysts can compare and contrast. These groupings depend on your team’s definition of equity, whether it be focused on race, socioeconomic status, race AND socioeconomic status, age, ethnicity, etc.</p>
</section>
<section id="why-use-disaggregated-data" class="level2">
<h2 class="anchored" data-anchor-id="why-use-disaggregated-data">Why use disaggregated data</h2>
<p>Particularly in education, disaggregated data is essential in identifying where solutions are needed to solve inequities. Per NCES’ <a href="https://nces.ed.gov/pubsearch/pubsinfo.asp?pubid=NFES2017017">Forum Guide to Collecting and Using Disaggregated Data on Racial/Ethnic Subgroups</a>:</p>
<blockquote class="blockquote">
<p>Educators need both high-level data summaries as well as disaggregated data that accurately describe smaller groups of students they serve. Access to and analysis of more detailed data—that is, disaggregated data—can be a useful tool for improving educational outcomes for small groups of students who otherwise would not be distinguishable in the aggregated data used for federal reporting. Disaggregating student data into subpopulations can help schools and communities plan appropriate programs; decide which interventions to implement; target limited resources; and recognize trends in educational participation, outcomes, and achievement.</p>
</blockquote>
</section>
<section id="minneapolis-public-schools-example" class="level2">
<h2 class="anchored" data-anchor-id="minneapolis-public-schools-example">Minneapolis Public Schools example</h2>
<p>Minneapolis Public Schools (MPS) reports their student demographics in a robust, complete way. Not only do they report the percentage of students in a subgroup, but they also include the number of students in each subgroup. This allows a deep look into their individual school demographics and gives us the opportunity to explore equity in their district.</p>
<section id="pulling-data" class="level3">
<h3 class="anchored" data-anchor-id="pulling-data">Pulling data</h3>
<p>MPS publishes their school data in PDFs. Thankfully, the {tabulizer} package exists! It easily and quickly pulled the data into lists which I then transformed to data frames and tidied up.</p>
<div class="cell" data-hash="index_cache/html/unnamed-chunk-4_5d0e6b13715b62a2bded88158d86cc05">
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;"># Load packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;">library</span>(tidyverse)</span>
<span id="cb1-3"><span class="fu" style="color: #4758AB;">library</span>(tabulizer)</span>
<span id="cb1-4"><span class="fu" style="color: #4758AB;">library</span>(janitor)</span>
<span id="cb1-5"></span>
<span id="cb1-6"><span class="co" style="color: #5E5E5E;"># Extract tables with race data</span></span>
<span id="cb1-7">race_pdf <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;">extract_tables</span>(<span class="st" style="color: #20794D;">"http://studentaccounting.mpls.k12.mn.us/uploads/racial_ethnic_school_gradefall2017.pdf"</span>)</span>
<span id="cb1-9"></span>
<span id="cb1-10"><span class="co" style="color: #5E5E5E;"># Create data frame</span></span>
<span id="cb1-11">race_df <span class="ot" style="color: #00769E;">&lt;-</span> <span class="co" style="color: #5E5E5E;"># many thanks to my brother @gvelasq for purrrifying this</span></span>
<span id="cb1-12">  race_pdf <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-13">  <span class="fu" style="color: #4758AB;">map</span>(as_tibble) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-14">  <span class="fu" style="color: #4758AB;">map_df</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">slice</span>(., <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span><span class="sc" style="color: #5E5E5E;">:-</span><span class="dv" style="color: #AD0000;">2</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-15">  <span class="fu" style="color: #4758AB;">set_names</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"school_group"</span>,</span>
<span id="cb1-16">              <span class="st" style="color: #20794D;">"school_name"</span>,</span>
<span id="cb1-17">              <span class="st" style="color: #20794D;">"grade"</span>, <span class="st" style="color: #20794D;">"na_num"</span>,</span>
<span id="cb1-18">              <span class="st" style="color: #20794D;">"na_pct"</span>,</span>
<span id="cb1-19">              <span class="st" style="color: #20794D;">"aa_num"</span>,</span>
<span id="cb1-20">              <span class="st" style="color: #20794D;">"aa_pct"</span>,</span>
<span id="cb1-21">              <span class="st" style="color: #20794D;">"as_num"</span>,</span>
<span id="cb1-22">              <span class="st" style="color: #20794D;">"as_pct"</span>,</span>
<span id="cb1-23">              <span class="st" style="color: #20794D;">"hi_num"</span>,</span>
<span id="cb1-24">              <span class="st" style="color: #20794D;">"hi_pct"</span>,</span>
<span id="cb1-25">              <span class="st" style="color: #20794D;">"wh_num"</span>,</span>
<span id="cb1-26">              <span class="st" style="color: #20794D;">"wh_pct"</span>,</span>
<span id="cb1-27">              <span class="st" style="color: #20794D;">"pi_pct"</span>,</span>
<span id="cb1-28">              <span class="st" style="color: #20794D;">"blank_col"</span>,</span>
<span id="cb1-29">              <span class="st" style="color: #20794D;">"tot"</span>))</span>
<span id="cb1-30"></span>
<span id="cb1-31">race_filter <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb1-32">  race_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-33">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>school_group, <span class="sc" style="color: #5E5E5E;">-</span>grade, <span class="sc" style="color: #5E5E5E;">-</span>pi_pct, <span class="sc" style="color: #5E5E5E;">-</span>blank_col) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># Remove unnecessary or blank columns</span></span>
<span id="cb1-34">  <span class="fu" style="color: #4758AB;">filter</span>(<span class="fu" style="color: #4758AB;">str_detect</span>(school_name, <span class="st" style="color: #20794D;">"Total"</span>),</span>
<span id="cb1-35">         school_name <span class="sc" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">"Grand Total"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> <span class="co" style="color: #5E5E5E;"># otherwise totals are duplicated</span></span>
<span id="cb1-36">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">school_name =</span> <span class="fu" style="color: #4758AB;">str_replace</span>(school_name, <span class="st" style="color: #20794D;">"Total"</span>, <span class="st" style="color: #20794D;">""</span>),</span>
<span id="cb1-37">         <span class="fu" style="color: #4758AB;">across</span>(<span class="fu" style="color: #4758AB;">where</span>(is.character), trimws))</span>
<span id="cb1-38"></span>
<span id="cb1-39"><span class="co" style="color: #5E5E5E;"># Extract tables with FRPL data</span></span>
<span id="cb1-40">frpl_pdf <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb1-41">  <span class="fu" style="color: #4758AB;">extract_tables</span>(<span class="st" style="color: #20794D;">"https://studentaccounting.mpls.k12.mn.us/uploads/free_reduced_meal_fall_2017_2.pdf"</span>)</span>
<span id="cb1-42"></span>
<span id="cb1-43"><span class="co" style="color: #5E5E5E;"># Create data frame</span></span>
<span id="cb1-44">frpl_df <span class="ot" style="color: #00769E;">&lt;-</span> <span class="co" style="color: #5E5E5E;"># many thanks to my brother @gvelasq for purrrifying this</span></span>
<span id="cb1-45">  frpl_pdf <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-46">  <span class="fu" style="color: #4758AB;">map</span>(as_tibble) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-47">  <span class="fu" style="color: #4758AB;">map_df</span>(<span class="sc" style="color: #5E5E5E;">~</span> <span class="fu" style="color: #4758AB;">slice</span>(., <span class="sc" style="color: #5E5E5E;">-</span><span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  </span>
<span id="cb1-48">  <span class="fu" style="color: #4758AB;">set_names</span>(<span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"school_grades"</span>,</span>
<span id="cb1-49">              <span class="st" style="color: #20794D;">"school_name"</span>,</span>
<span id="cb1-50">              <span class="st" style="color: #20794D;">"total_students"</span>,</span>
<span id="cb1-51">              <span class="st" style="color: #20794D;">"frpl_pct"</span>,</span>
<span id="cb1-52">              <span class="st" style="color: #20794D;">"free_num"</span>,</span>
<span id="cb1-53">              <span class="st" style="color: #20794D;">"reduce_num"</span>,</span>
<span id="cb1-54">              <span class="st" style="color: #20794D;">"not_eligible_num"</span>))</span>
<span id="cb1-55"></span>
<span id="cb1-56">frpl_filter <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb1-57">  frpl_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-58">  <span class="fu" style="color: #4758AB;">filter</span>(school_name <span class="sc" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">""</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-59">  <span class="fu" style="color: #4758AB;">select</span>(<span class="sc" style="color: #5E5E5E;">-</span>school_grades)</span>
<span id="cb1-60"></span>
<span id="cb1-61"><span class="co" style="color: #5E5E5E;"># Merged data</span></span>
<span id="cb1-62">merged_df <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb1-63">  <span class="fu" style="color: #4758AB;">left_join</span>(race_filter, frpl_filter, <span class="at" style="color: #677623;">by =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"school_name"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb1-64">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="fu" style="color: #4758AB;">across</span>(<span class="dv" style="color: #AD0000;">2</span><span class="sc" style="color: #5E5E5E;">:</span><span class="dv" style="color: #AD0000;">17</span>, as.numeric)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-65">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">frpl_pct =</span> (free_num <span class="sc" style="color: #5E5E5E;">+</span> reduce_num)<span class="sc" style="color: #5E5E5E;">/</span>total_students,</span>
<span id="cb1-66">         <span class="at" style="color: #677623;">hi_povnum =</span> <span class="fu" style="color: #4758AB;">case_when</span>(frpl_pct <span class="sc" style="color: #5E5E5E;">&gt;</span> .<span class="dv" style="color: #AD0000;">75</span> <span class="sc" style="color: #5E5E5E;">~</span> hi_num),</span>
<span id="cb1-67">         <span class="at" style="color: #677623;">aa_povnum =</span> <span class="fu" style="color: #4758AB;">case_when</span>(frpl_pct <span class="sc" style="color: #5E5E5E;">&gt;</span> .<span class="dv" style="color: #AD0000;">75</span> <span class="sc" style="color: #5E5E5E;">~</span> aa_num),</span>
<span id="cb1-68">         <span class="at" style="color: #677623;">wh_povnum =</span> <span class="fu" style="color: #4758AB;">case_when</span>(frpl_pct <span class="sc" style="color: #5E5E5E;">&gt;</span> .<span class="dv" style="color: #AD0000;">75</span> <span class="sc" style="color: #5E5E5E;">~</span> wh_num),</span>
<span id="cb1-69">         <span class="at" style="color: #677623;">as_povnum =</span> <span class="fu" style="color: #4758AB;">case_when</span>(frpl_pct <span class="sc" style="color: #5E5E5E;">&gt;</span> .<span class="dv" style="color: #AD0000;">75</span> <span class="sc" style="color: #5E5E5E;">~</span> as_num),</span>
<span id="cb1-70">         <span class="at" style="color: #677623;">na_povnum =</span> <span class="fu" style="color: #4758AB;">case_when</span>(frpl_pct <span class="sc" style="color: #5E5E5E;">&gt;</span> .<span class="dv" style="color: #AD0000;">75</span> <span class="sc" style="color: #5E5E5E;">~</span> na_num)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-71">  <span class="fu" style="color: #4758AB;">adorn_totals</span>() <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-72">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">na_pct =</span> na_num<span class="sc" style="color: #5E5E5E;">/</span>tot,</span>
<span id="cb1-73">         <span class="at" style="color: #677623;">aa_pct =</span> aa_num<span class="sc" style="color: #5E5E5E;">/</span>tot,</span>
<span id="cb1-74">         <span class="at" style="color: #677623;">as_pct =</span> as_num<span class="sc" style="color: #5E5E5E;">/</span>tot,</span>
<span id="cb1-75">         <span class="at" style="color: #677623;">hi_pct =</span> hi_num<span class="sc" style="color: #5E5E5E;">/</span>tot,</span>
<span id="cb1-76">         <span class="at" style="color: #677623;">wh_pct =</span> wh_num<span class="sc" style="color: #5E5E5E;">/</span>tot,</span>
<span id="cb1-77">         <span class="at" style="color: #677623;">frpl_pct =</span> (free_num <span class="sc" style="color: #5E5E5E;">+</span> reduce_num)<span class="sc" style="color: #5E5E5E;">/</span>total_students, <span class="co" style="color: #5E5E5E;"># otherwise total frpl_pct is off</span></span>
<span id="cb1-78">         <span class="at" style="color: #677623;">hi_povsch =</span> hi_povnum<span class="sc" style="color: #5E5E5E;">/</span>hi_num[<span class="fu" style="color: #4758AB;">which</span>(school_name <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Total"</span>)],</span>
<span id="cb1-79">         <span class="at" style="color: #677623;">aa_povsch =</span> aa_povnum<span class="sc" style="color: #5E5E5E;">/</span>aa_num[<span class="fu" style="color: #4758AB;">which</span>(school_name <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Total"</span>)],</span>
<span id="cb1-80">         <span class="at" style="color: #677623;">as_povsch =</span> as_povnum<span class="sc" style="color: #5E5E5E;">/</span>as_num[<span class="fu" style="color: #4758AB;">which</span>(school_name <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Total"</span>)],</span>
<span id="cb1-81">         <span class="at" style="color: #677623;">wh_povsch =</span> wh_povnum<span class="sc" style="color: #5E5E5E;">/</span>wh_num[<span class="fu" style="color: #4758AB;">which</span>(school_name <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Total"</span>)],</span>
<span id="cb1-82">         <span class="at" style="color: #677623;">na_povsch =</span> na_povnum<span class="sc" style="color: #5E5E5E;">/</span>na_num[<span class="fu" style="color: #4758AB;">which</span>(school_name <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Total"</span>)])</span>
<span id="cb1-83"></span>
<span id="cb1-84"><span class="co" style="color: #5E5E5E;"># Finish up the data frame</span></span>
<span id="cb1-85">tidy_df <span class="ot" style="color: #00769E;">&lt;-</span></span>
<span id="cb1-86">  merged_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb1-87">  <span class="fu" style="color: #4758AB;">pivot_longer</span>(<span class="at" style="color: #677623;">cols =</span> na_num<span class="sc" style="color: #5E5E5E;">:</span>na_povsch,</span>
<span id="cb1-88">               <span class="at" style="color: #677623;">names_to =</span> <span class="st" style="color: #20794D;">"category"</span>,</span>
<span id="cb1-89">               <span class="at" style="color: #677623;">values_to =</span> <span class="st" style="color: #20794D;">"value"</span>)</span></code></pre></div>
</div>
</section>
<section id="first-glance-mps-district-demographics" class="level3">
<h3 class="anchored" data-anchor-id="first-glance-mps-district-demographics">First glance: MPS District demographics</h3>
<p>Here is a barplot which shows the percentage of different subgroups in the school district. FRPL stands for Free/Reduced Price Lunch, often used as a proxy for poverty. Students from a household with an income up to 185 percent of the poverty threshold are eligible for free or reduced price lunch.</p>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Definitions are very important in disaggregated data. FRPL is used because it’s ubiquitous and reporting is mandated but <a href="https://nces.ed.gov/blogs/nces/post/free-or-reduced-price-lunch-a-proxy-for-poverty">there is debate as to whether it actually reflects the level of poverty among students</a>.</p>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb2-1">tidy_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-2">  <span class="fu" style="color: #4758AB;">filter</span>(school_name <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Total"</span>,</span>
<span id="cb2-3">         <span class="fu" style="color: #4758AB;">str_detect</span>(category, <span class="st" style="color: #20794D;">"pct"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">category =</span> <span class="fu" style="color: #4758AB;">factor</span>(</span>
<span id="cb2-5">    category,</span>
<span id="cb2-6">    <span class="at" style="color: #677623;">levels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"aa_pct"</span>, <span class="st" style="color: #20794D;">"wh_pct"</span>, <span class="st" style="color: #20794D;">"hi_pct"</span>, <span class="st" style="color: #20794D;">"as_pct"</span>, <span class="st" style="color: #20794D;">"na_pct"</span>, <span class="st" style="color: #20794D;">"frpl_pct"</span>)</span>
<span id="cb2-7">  )) <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb2-8">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> category, <span class="at" style="color: #677623;">y =</span> value)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-9">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"identity"</span>, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">fill =</span> <span class="fu" style="color: #4758AB;">factor</span>(category))) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-10">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">"Subgroup"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-11">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"Percentage of Population"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-12">  <span class="fu" style="color: #4758AB;">scale_x_discrete</span>(<span class="at" style="color: #677623;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Black"</span>, <span class="st" style="color: #20794D;">"White"</span>, <span class="st" style="color: #20794D;">"Hispanic"</span>, <span class="st" style="color: #20794D;">"Asian"</span>, <span class="st" style="color: #20794D;">"Native Am."</span>, <span class="st" style="color: #20794D;">"FRPL"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-13">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #677623;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span>percent) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-14">  <span class="fu" style="color: #4758AB;">scale_fill_iv</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-15">  <span class="fu" style="color: #4758AB;">theme_iv</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb2-16">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/why-disaggregate-data/index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" alt="Barplot showing demographic breakdown of students in MPS. Black students make up the most at almost 40%, then White students slightly less, and finally Hispanic, Asian, and Native American under 20%. Almost 60% of all students qualify for FRPL." width="672"></p>
</figure>
</div>
</div>
</div>
<p>When we look at these data, MPS looks like a diverse school district. Almost <strong>40% of students are Black</strong> and around <strong>35% are White</strong>. <strong>60% of the students are eligible for FRPL</strong>, which is <a href="https://nces.ed.gov/programs/digest/d17/tables/dt17_204.10.asp?current=yes">high for Minnesota but close to the US average of 52.1%</a>.</p>
<p>However, let’s explore if there’s more to this story.</p>
</section>
<section id="discover-distributions" class="level3">
<h3 class="anchored" data-anchor-id="discover-distributions">Discover distributions</h3>
<p>Another view of the data can be visualizing the distribution of percentage of a demographic within schools. Here is a histogram for the percentage of White students within the 74 MPS schools for which we have data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb3-1">merged_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-2">  <span class="fu" style="color: #4758AB;">filter</span>(school_name <span class="sc" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">"Total"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> wh_pct)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-4">  <span class="fu" style="color: #4758AB;">geom_histogram</span>(<span class="at" style="color: #677623;">fill =</span> <span class="st" style="color: #20794D;">"#00C3DA"</span>, <span class="at" style="color: #677623;">breaks=</span> <span class="fu" style="color: #4758AB;">seq</span>(<span class="dv" style="color: #AD0000;">0</span>, <span class="dv" style="color: #AD0000;">1</span>, <span class="at" style="color: #677623;">by =</span> .<span class="dv" style="color: #AD0000;">1</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">"White Percentage"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-6">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"Count"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #677623;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span>percent) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-8">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;">scale_fill_iv</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-10">  <span class="fu" style="color: #4758AB;">theme_iv</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/why-disaggregate-data/index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" alt="Histogram of number of schools by White pecentage of students. Most schools have less than 30%." width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>27 of the 74 (36%) of schools have between 0-10% White students.</strong> This implies that even though the school district may be diverse, the demographics are not evenly distributed across the schools. More than half of schools enroll fewer than 30% of White students even though White students make up 35% of the district student population.</p>
<p>The school race demographics are not representative of the district populations but does that hold for socioeconomic status as well?</p>
</section>
<section id="create-categories" class="level3">
<h3 class="anchored" data-anchor-id="create-categories">Create categories</h3>
<p>High-poverty schools are defined as public schools where more than 75% of the students are eligible for FRPL. According to NCES, <a href="https://nces.ed.gov/fastfacts/display.asp?id=898">24% of public school students attended high-poverty schools</a>. However, different subgroups were overrepresented and underrepresented within the high poverty schools. Is this the case for MPS?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb4-1">tidy_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span></span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;">filter</span>(school_name <span class="sc" style="color: #5E5E5E;">==</span> <span class="st" style="color: #20794D;">"Total"</span>,</span>
<span id="cb4-3">         <span class="fu" style="color: #4758AB;">str_detect</span>(category, <span class="st" style="color: #20794D;">"povsch"</span>)) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;">mutate</span>(<span class="at" style="color: #677623;">category =</span> <span class="fu" style="color: #4758AB;">factor</span>(category, <span class="at" style="color: #677623;">levels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"hi_povsch"</span>, <span class="st" style="color: #20794D;">"na_povsch"</span>, <span class="st" style="color: #20794D;">"aa_povsch"</span>, <span class="st" style="color: #20794D;">"as_povsch"</span>, <span class="st" style="color: #20794D;">"wh_povsch"</span>))) <span class="sc" style="color: #5E5E5E;">%&gt;%</span>  </span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> category, <span class="at" style="color: #677623;">y =</span> value)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-6">  <span class="fu" style="color: #4758AB;">geom_bar</span>(<span class="at" style="color: #677623;">stat =</span> <span class="st" style="color: #20794D;">"identity"</span>, <span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">fill =</span> <span class="fu" style="color: #4758AB;">factor</span>(category))) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-7">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">"Subgroup"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-8">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"Percentage in High Poverty Schools"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-9">  <span class="fu" style="color: #4758AB;">scale_x_discrete</span>(<span class="at" style="color: #677623;">labels =</span> <span class="fu" style="color: #4758AB;">c</span>(<span class="st" style="color: #20794D;">"Hispanic"</span>, <span class="st" style="color: #20794D;">"Native Am."</span>, <span class="st" style="color: #20794D;">"Black"</span>, <span class="st" style="color: #20794D;">"Asian"</span>, <span class="st" style="color: #20794D;">"White"</span>)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-10">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #677623;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span>percent) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-11">  <span class="fu" style="color: #4758AB;">scale_fill_iv</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-12">  <span class="fu" style="color: #4758AB;">theme_iv</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-13">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb4-14">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/why-disaggregate-data/index_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" alt="Barplot showing demographic breakdown of students attending schools which high percentage of poverty. About 50% of Black, Hispanic, Native American, and Asian student attend high-poverty schools compared to 9% of White students." width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>9% of White students</strong> attend high poverty schools, compared to <strong>46% of Black students</strong>, <strong>51% of Hispanic students</strong>, <strong>46% of Asian students</strong>, and <strong>49% of Native American students</strong>. These students are disproportionately attending high poverty schools.</p>
</section>
<section id="reveal-relationships" class="level3">
<h3 class="anchored" data-anchor-id="reveal-relationships">Reveal relationships</h3>
<p>Let’s explore what happens when we correlate race and FRPL percentage by school.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r cell-code code-with-copy"><code class="sourceCode r"><span id="cb5-1">merged_df <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;">filter</span>(school_name <span class="sc" style="color: #5E5E5E;">!=</span> <span class="st" style="color: #20794D;">"Total"</span>) <span class="sc" style="color: #5E5E5E;">%&gt;%</span> </span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;">ggplot</span>(<span class="fu" style="color: #4758AB;">aes</span>(<span class="at" style="color: #677623;">x =</span> wh_pct, <span class="at" style="color: #677623;">y =</span> frpl_pct)) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-4">  <span class="fu" style="color: #4758AB;">geom_point</span>(<span class="at" style="color: #677623;">color =</span> <span class="st" style="color: #20794D;">"#00C3DA"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-5">  <span class="fu" style="color: #4758AB;">xlab</span>(<span class="st" style="color: #20794D;">"White Percentage"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-6">  <span class="fu" style="color: #4758AB;">ylab</span>(<span class="st" style="color: #20794D;">"FRPL Percentage"</span>) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-7">  <span class="fu" style="color: #4758AB;">scale_y_continuous</span>(<span class="at" style="color: #677623;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span>percent) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-8">  <span class="fu" style="color: #4758AB;">scale_x_continuous</span>(<span class="at" style="color: #677623;">labels =</span> scales<span class="sc" style="color: #5E5E5E;">::</span>percent) <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-9">  <span class="fu" style="color: #4758AB;">theme_minimal</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-10">  <span class="fu" style="color: #4758AB;">theme_iv</span>() <span class="sc" style="color: #5E5E5E;">+</span></span>
<span id="cb5-11">  <span class="fu" style="color: #4758AB;">theme</span>(<span class="at" style="color: #677623;">legend.position =</span> <span class="st" style="color: #20794D;">"none"</span>)</span></code></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/why-disaggregate-data/index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" alt="Scattershot showing the relationship of FRPL percentage and percentage of students that are White with a steep negative correlation." width="672"></p>
</figure>
</div>
</div>
</div>
<p>Similarly to the result above, <strong>there is a strong negative correlation between FRPL percentage and the percentage of White students in a school.</strong> High poverty schools have a lower percentage of White students and low poverty schools have a higher percentage of White students.</p>
</section>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>According to the Urban Institute, the disproportionate percentage of students of color attending high poverty schools “is a defining feature of almost all Midwestern and northeastern metropolitan school systems.” Among other issues, high poverty schools <a href="https://www.urban.org/urban-wire/high-poverty-schools-undermine-education-children-color">tend to lack the educational resources—like highly qualified and experienced teachers, low student-teacher ratios, college prerequisite and advanced placement courses, and extracurricular activities—available in low-poverty schools.</a> This has a huge impact on these students and their futures.</p>
<p>Because of the disaggregated data Minneapolis Public Schools provides, we can go deeper than the average of demographics across the district and see what it looks like on the school level. These views display that (1) there exists a distribution of race/ethnicity within schools that are not representative of the district, (2) that students of color are overrepresented in high poverty schools, and (3) there is a relationship between the percentage of White students in a school and the percentage of students eligible for FRPL.</p>
</section>
</section>
<section id="examples-of-disaggregated-data-reporting" class="level2">
<h2 class="anchored" data-anchor-id="examples-of-disaggregated-data-reporting">Examples of disaggregated data reporting</h2>
<p>There are so many amazing examples out there using disaggregated data. These two are my favorites:</p>
<ul>
<li><a href="https://www.nytimes.com/interactive/2016/04/29/upshot/money-race-and-success-how-your-school-district-compares.html">Money, Race and Success: How Your School District Compares</a></li>
<li><a href="http://www.tampabay.com/projects/2015/investigations/pinellas-failure-factories/chart-failing-black-students/">Why Pinellas County is the worst place in Florida to be black and go to public school</a></li>
</ul>
<center>
<p><em>Liked this article? I’d love for you to retweet!</em></p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
New blog post 🎉: Why Equity Requires Looking Beyond Averages 🕵🏽‍♀️📊 A Look at Minneapolis Public Schools using the awesome packages <a href="https://twitter.com/hashtag/tabulizer?src=hash&amp;ref_src=twsrc%5Etfw">#tabulizer</a> 📑 and <a href="https://twitter.com/hashtag/janitor?src=hash&amp;ref_src=twsrc%5Etfw">#janitor</a> ✨ <a href="https://t.co/w4WiuDo0Bl">https://t.co/w4WiuDo0Bl</a> <a href="https://twitter.com/hashtag/rstats?src=hash&amp;ref_src=twsrc%5Etfw">#rstats</a> <a href="https://t.co/2MnY3ctFYH">pic.twitter.com/2MnY3ctFYH</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1044233934865752064?ref_src=twsrc%5Etfw">September 24, 2018</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>analysis</category>
  <guid>https://ivelasq.rbind.io/blog/why-disaggregate-data/index.html</guid>
  <pubDate>Fri, 21 Sep 2018 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/why-disaggregate-data/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
<item>
  <title>So you’re getting a Masters in Analytics</title>
  <link>https://ivelasq.rbind.io/blog/so-youre-getting-a-masters/index.html</link>
  <description><![CDATA[ 

<p>plausible.html</p><div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://ivelasq.rbind.io/blog/so-youre-getting-a-masters/thumbnail-wide.jpg" class="img-fluid figure-img" alt="A still life with a book, statue, violin, skull, and other items arranged in a room"></p>
<p></p><p></p>
</figure>
</div>
<p>The new school year is right around the corner and I have gotten a few requests from new students entering a Data Science or Analytics program to talk about my experience in graduate school. I graduated with a Masters of Science in Analytics from the University of Chicago in June 2016. It was an amazing experience that helped propel me into a new career but there are definitely things I wish I had known or would have done differently.</p>
<p>I’ve tried to keep track of the different questions people ask and aggregate them into a list. A few caveats:</p>
<ul>
<li>My program, homework, and projects were primarily in R.</li>
<li>This is assuming that you are entering the program to find a new job or career.</li>
</ul>
<p>Here is my advice to aspiring data scientists/analysts entering these programs and how I would have made an already great experience even better.</p>
<section id="learn-git-and-put-everything-on-github-or-equivalent" class="level2">
<h2 class="anchored" data-anchor-id="learn-git-and-put-everything-on-github-or-equivalent">1. Learn Git and put everything on GitHub (or equivalent)</h2>
<p>Git and GitHub was not required for any classes (at least when I was in the program) and I really regret not using it with my classmates.</p>
<ul>
<li>GitHub is a great way to show off your skills to potential employers.</li>
<li>It’s a much better collaboration tool than what we did (which was email each other with code changes).</li>
<li>It’s also a good history so you remember things you’ve done (which I have forgotten already).</li>
<li>It’s also way neater to have homework in projects in GitHub as opposed to a zillion folders on your Desktop (which is what I went with).</li>
<li>Git[hub] is also a great skill to have, as many data analysis/science teams use it regularly!</li>
<li>There’s also nothing better than having a filled up contribution graph.</li>
</ul>
<center>
<img src="https://ivelasq.rbind.io/blog/so-youre-getting-a-masters/https:/i.imgur.com/7c6ss6v.jpg?style=centerme" alt="Character from Napolean Dynamite saying Created repo and made an initial commit, so I guess you could say things are getting pretty serious.">
</center>
</section>
<section id="leave-each-class-with-an-example-that-you-can-show-a-potential-employer" class="level2">
<h2 class="anchored" data-anchor-id="leave-each-class-with-an-example-that-you-can-show-a-potential-employer">2. Leave each class with an example that you can show a potential employer</h2>
<p>These programs go <em>quickly.</em> I was a part-time student and took my sweet time and even then I felt like I was racing towards the end. Due to competing priorities, it’s easy to rush through homework assignments and projects. Instead of focusing on completion, remember the goal of this is to enter a new career/role/path in life and that everything you do is an example of a new skill you can showcase. So: document your work. Be clear in the intention behind it and how you went through your thought process. Make it presentable. Related to the advice above, link potential employers to your GitHub.</p>
<p>Of course, I understand that not all homework applies to this — but a lot of it does, in particular your final projects. Are you going to put on your resume that you can produce dashboards with data visualizations? You must have an example to back that up — and be able to show how this project illustrates the value you can bring to your future company.</p>
<center>
<img src="https://ivelasq.rbind.io/blog/so-youre-getting-a-masters/https:/miro.medium.com/max/1838/1*5U_4FZ82_Lf4p6o82VTGuQ.gif" alt="Jamie from Outlander saying, I'm here and I'm ready.">
</center>
</section>
<section id="diversify-your-programming-languages" class="level2">
<h2 class="anchored" data-anchor-id="diversify-your-programming-languages">3. Diversify your programming languages</h2>
<p>My classes were primarily in R, with only one course requiring Python. In a short amount of time, I picked up and could use Python — and I lost my skills in about the same amount of time once the course was over! Without the discipline of practicing and keeping up my programming skills in languages other than R, they quickly were put on the backburner and eventually forgotten.</p>
<center>
<img src="https://ivelasq.rbind.io/blog/so-youre-getting-a-masters/https:/media.makeameme.org/created/you-know-i-5b67d1.jpg?style=centerme" alt="Ron Burgundy saying You know I dont speak Python In R please.">
</center>
<p><br> Once I was finishing up school and applying for jobs, I had to admit to potential employers that my R skills were much stronger. This ultimately worked out but it did put me out of the running for any Python shops. To replicate the work I did in Python, I’d have to refresh myself on even the basics of the language — which is a shame considering how much effort I put in when I was in the class.</p>
</section>
<section id="choose-your-capstone-project-and-advisor-carefully" class="level2">
<h2 class="anchored" data-anchor-id="choose-your-capstone-project-and-advisor-carefully">4. Choose your Capstone project and advisor carefully</h2>
<p>When it was Capstone time, the options were listed on a website and we were told to form a group, choose a project, and pick out an advisor. It seemed like those were the only variables but in actuality there were <em>many</em> other considerations that impacted the difficulty and complexity of the project. They directly affected whether or not someone graduated when they wanted so this is a decision to take very seriously.</p>
<ul>
<li><strong>Research Question</strong>: Is the research question defined (clearly) by the Capstone sponsor? If not, a lot of time will be dedicated to research question development, edits, rewrites, and eventual approval.</li>
<li><strong>Data</strong>: The addition of a project to the Capstone list does not mean that the data will be readily available to you when you want to begin your project. Several students chose a project under the assumption that the Capstone sponsor would immediately send over the data and instead had to wait a quarter (!) before they actually received anything and could begin analysis. Ask: Is the data available, and if not, how will it be collected? Will you need to sign a confidentiality agreement and who is in charge of that? How will the data be transferred to you and in what format? How long will it take to get the data? Will you need to update or refresh it throughout the course of your Capstone? Will you refine your research question(s) once you have the data?</li>
<li><strong>Sponsor Availability/Interaction</strong>: Some sponsors want to be involved in every step of the process. Some sponsors will see you once a quarter. There are pros and cons to each approach but generally speaking you want a sponsor that provides clear guidance and expectations without micromanaging. Try to find out the kind of sponsor you have so you know how to best work with them. You are in it together for the long haul!</li>
<li><strong>Advisor Availability/Interaction</strong>: Similar to the sponsor, the Capstone advisor will vary in their expectations of how they will collaborate. Be mindful that some advisors are handling a heavy load — another job, classes, and several Capstone projects at the same time — and therefore you have to account for how you will get their time and attention. This can be frustrating if you need help or are struggling to meet a deadline. Decide your expectations early — my group set up a standing weekly call and biweekly in-person meeting with our advisor.</li>
<li><strong>Advisor Specialty</strong>: Some advisors have more experience or insight in the particular analysis you are trying to do. My Capstone project dealt with survey respondents — and luckily my advisor was a marketing researcher! However, sometimes the advisor’s specialty differs from your analytic approach and your group will have to do more research on their own to fulfill the sponsor’s needs.</li>
<li><strong>Group Availability/Interaction</strong>: In a sudden turn of events, one of the members of a Capstone group quit to start a new job in another state. This left their group in disarray as they tried to figure out how to manage the rest of their project. While I am happy for the person who got a job (that is the point of it all, anyway), they could have helped out their team by being open and honest. Ask your potential teammates: What happens if you were offered a new job? Is your graduation timeline fixed or flexible? How many other courses are you taking and how much time can you dedicate to this project? Along with these questions, figure out how everybody intends to interact and set clear expectations from the beginning so that the group can work towards success together.</li>
</ul>
</section>
<section id="keep-track-of-and-give-recommendations-on-how-the-program-can-improve" class="level2">
<h2 class="anchored" data-anchor-id="keep-track-of-and-give-recommendations-on-how-the-program-can-improve">5. Keep track of and give recommendations on how the program can improve</h2>
<p>I was in the second cohort of my Analytics program and even though it’s been a couple of years since then, most data science curriculum are relatively new. There are still kinks to work out in terms of what should be required, what should be optional, what order to take courses in, etc. For example, we were thrust into the world of R because our homework had to be done in R, even though many of us had never even installed a package before! We made the recommendation to administration that they should create a short course covering the basics and now it’s offered to any student who may benefit from it.</p>
<center>
<img src="https://ivelasq.rbind.io/blog/so-youre-getting-a-masters/https:/media.giphy.com/media/uRb2p09vY8lEs/giphy.gif?style=centerme" alt="Tom Cruise saying Help me help you.">
</center>
<p><br> As you go through your program, everything will seem to go so quickly. The details will get lost in the blur unless you intentionally think about how to improve your experience and the experience of those who will come after you.</p>
</section>
<section id="learn-what-you-love-about-the-process" class="level2">
<h2 class="anchored" data-anchor-id="learn-what-you-love-about-the-process">6. Learn what you love about the process</h2>
<p>As you progress through your Analytics or Data Science program, you will learn the nuance and complexity of data work. It is a fascinating journey that requires project management, client interaction and understanding, technical expertise, feedback loops, and trial and error. It’s all amazing and necessary but there will be parts that you enjoy more. I have always been into creating aesthetically pleasing work and knew I would love developing data visualizations. I didn’t know that I love the creativity and mind puzzles that come with data wrangling. Some people feel the opposite — that is their least favorite part of the data science routine. But they may enjoy business requirements gathering a lot more than I do.</p>
<p>You should know how to successfully accomplish the data science methodology but graduate school is also an opportunity to learn which part excites you. Because of the enormous world of data analytics out there, this will help hone in on the role that can bring joy to your work as much as possible.</p>
<center>
<img src="https://ivelasq.rbind.io/blog/so-youre-getting-a-masters/https:/i.chzbgr.com/full/7462068736/h27B781F0/?style=centerme" alt="Data from Star Trek playing with a cat">
</center>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>The purpose of these data science/analytics degrees is to serve as a means to an end but it’s been two years since I finished my Masters and I still reflect on the experience. Along the journey, there was a lot of change and improvement. My Analytics program impacted how I think, my career trajectory, and what I do outside of work. For that I am thankful, as I also realize that there is no definite end to learning.</p>
<center>
<p><em>Liked this article? I’d love for you to retweet!</em></p>
<blockquote class="twitter-tweet blockquote">
<p lang="en" dir="ltr">
First blog post on my new <a href="https://twitter.com/hashtag/blogdown?src=hash&amp;ref_src=twsrc%5Etfw">#blogdown</a> 🎉: So You're Getting a Masters in Analytics 👩🏽‍🎓👨🏽‍🎓‼️ Reflections from an R-Centric Program <a href="https://t.co/mvOPKbcSeG">https://t.co/mvOPKbcSeG</a> <a href="https://twitter.com/hashtag/datascience?src=hash&amp;ref_src=twsrc%5Etfw">#datascience</a> <a href="https://t.co/uaq721m2ZL">pic.twitter.com/uaq721m2ZL</a>
</p>
— Isabella Velásquez (<span class="citation" data-cites="ivelasq3">@ivelasq3</span>) <a href="https://twitter.com/ivelasq3/status/1027200743030149122?ref_src=twsrc%5Etfw">August 8, 2018</a>
</blockquote>
<script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</center>


</section>
 ]]></description>
  <category>community</category>
  <guid>https://ivelasq.rbind.io/blog/so-youre-getting-a-masters/index.html</guid>
  <pubDate>Sat, 04 Aug 2018 05:00:00 GMT</pubDate>
  <media:content url="https://ivelasq.rbind.io//blog/so-youre-getting-a-masters/thumbnail.jpg" medium="image" type="image/jpeg"/>
</item>
</channel>
</rss>
